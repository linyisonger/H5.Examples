<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/global.css">

    <style>
        .parks .park {
            display: flex;
            margin-bottom: 5px;
        }

        .parks .words {
            display: flex;
            flex-wrap: wrap;
        }

        .book>.name,
        .park>.name {
            padding: 4px 8px;
        }

        .parks .word {
            padding: 4px 8px;
            margin-right: 6px;
            cursor: pointer;
            box-sizing: border-box;
            border: 1px solid transparent;
        }

        .parks .word.selected {
            border: 1px dashed red;
        }

        .control-bar {
            display: flex;
        }

        .control-bar .form-item {
            display: flex;
            align-items: center;
            padding-left: 8px;
        }

        .control-bar .form-item-input {
            margin: 0 12px;
            display: flex;
            align-items: center;
        }

        .control-bar .form-item-text {
            margin-right: 12px;
        }

        .read-word-text {
            padding: 8px;
        }

        .read-word-text textarea {
            height: 120px;
            width: 265px;
            resize: none;
        }
    </style>
</head>

<body>

    <div class="read-word-text">
        <textarea></textarea>
    </div>
    <div class="control-bar">
        <div class="form-item">
            <div class="form-item-label">
                é—´éš”
            </div>
            <div class="form-item-input">
                <input class="read-interval" type="range" min="1" max="5" value="2">
            </div>
            <div class="form-item-text">
                2s
            </div>
        </div>
        <div class="form-item">
            <button class="read-words">æœ—è¯»</button>
            <button class="input-image">å›¾ç‰‡è¯†åˆ«</button>
        </div>
    </div>


    <script type="module">
        import Tesseract from "https://gcore.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.esm.min.js";
        const worker = await Tesseract.createWorker("chi_sim", 1, {
            corePath:
                "https://gcore.jsdelivr.net/npm/tesseract.js-core@5/tesseract-core-simd-lstm.wasm.js",
            workerPath:
                "https://gcore.jsdelivr.net/npm/tesseract.js@5/dist/worker.min.js",
            langPath:
                "https://gcore.jsdelivr.net/npm/@tesseract.js-data/chi_sim/4.0.0",
        });

        const inputImageDOM = document.querySelector('.input-image')
        inputImageDOM.addEventListener("click", () => {
            const fileInput = document.createElement('input');
            fileInput.setAttribute('type', 'file');
            fileInput.setAttribute('accept', '*');
            fileInput.addEventListener('change', async () => {
                const files = fileInput.files;
                let text = '';
                for (let i = 0; i < files.length; i++) {
                    const ret = await worker.recognize(files[i]);
                    text += ret.data.text.replace(/[^a-zA-Z\u4e00-\u9fa5 ]/g, '')
                    console.log(ret.data.text);
                }
                readWordTextDOM.value = text;
            });
            fileInput.click();
        })


        const bookWords = [
            {
                name: 'ä¹‰åŠ¡æ•™è‚²ï¼ˆå…­ä¸‰å­¦åˆ¶ï¼‰ä¸‰å¹´çº§ä¸Šå†Œ',
                parts: [
                    {
                        name: '1',
                        words: [
                            'ç©¿æˆ´',
                            'é²œè‰³',
                            'æœè£…',
                            'æ‰“æ‰®',
                            'æ•¬çˆ±',
                            'æ—©æ™¨',
                            'å›½æ——',
                            'æ ‘æž',
                            'å¥½å¥‡',
                            'å­”é›€',
                            'æ‹›å¼•',
                            'å®‰é™',
                            'æ•¬ç¤¼',
                            'ç²—å£®',
                            'æžå¹²',
                            'å½±å­'
                        ]
                    },
                    {
                        name: '2',
                        words: [
                            "é˜µé›¨",
                            "è’é‡Ž",
                            "è·³èˆž",
                            "ç‹‚æ¬¢",
                            "åŠŸè¯¾",
                            "æ”¾å‡",
                            "äº’ç›¸",
                            "ç‹‚é£Ž",
                            "æ€¥æ€¥å¿™å¿™",
                            "è‡ªç„¶",
                            "èƒ½å¤Ÿ",
                            "åŒè‡‚"
                        ]
                    },
                    {
                        name: '5',
                        words: ['æ°´æ³¥', 'æ”¾æ™´', 'æ˜Žæœ—', 'äº®æ™¶æ™¶', 'é‡‘é»„', 'é›¨ç ', 'é™¢å¢™', 'è½å¶', 'é—ªé—ªå‘å…‰', 'å°½å¤´', 'å¹³å±•', 'æŽ’åˆ—', 'è§„åˆ™', 'æ­Œå”±', 'è¿Ÿåˆ°']
                    },
                    {
                        name: '6',
                        words: 'æ¸…å‡‰ ç•™æ„ é¢œæ–™ æž«å¶ é‚®ç¥¨ æžœæ ‘ èŠèŠ± ä»™å­ æ°”å‘³ é¦™ç”œ é¦™å‘³ åŠ ç´§ è¿‡å†¬ ä¸°æ”¶'.split(' ')
                    },
                    {
                        name: '8',
                        words: 'ç«æŸ´ å›´è£™ å¯æ€œ å“ªæ€• æš–å’Œ ç®€ç›´ èœ¡çƒ› äº®å…‰ åœ°æ¿ çƒ›å…‰ æ¸©å’Œ èµ¶ç´§ ç—›è‹¦ æ¸…æ™¨'.split(' ')
                    },
                    {
                        name: '10',
                        words: 'æ—…è¡Œ è¦å¥½ å’±ä»¬ è‰å † ä½œå£° å·å· ç­”åº” åšæ¢¦ æ¥å¾—åŠ æ•‘å‘½ æ‹¼å‘½ å¤§åƒä¸€æƒŠ æ¶ˆåŒ– å½“ç„¶ å‡ ä¹Ž çŸ¥è§‰ çœ¼æ³ª'.split(' ')
                    },
                    {
                        name: '12',
                        words: 'å˜æˆ é—¨æ¿ å‡†å¤‡ æš´é£Žé›¨ å®‰å¿ƒ ç¡è§‰ ä¸»äºº å¢™å£ æ¯é¸¡ æ³¨æ„ èœ˜è›› æ¼‚äº® å› æ­¤'.split(' ')
                    },
                    {
                        name: '15',
                        words: 'é›¨ç‚¹ èˆ¹å¤« ç”¨åŠ› èˆ¹å¤´ ç¾½æ¯› æ¯äº² å¤–ç¥–çˆ¶ ç¿ ç»¿ é™æ‚„æ‚„ ç¿ é¸Ÿ æ•é±¼'.split(' ')
                    },
                    {
                        name: '16',
                        words: 'çª—å‰ è’²å…¬è‹± ç››å¼€ çŽ©è€ ä¸€æœ¬æ­£ç» ç»’æ¯› åˆæ‹¢ æ‰‹æŽŒ æœ‰è¶£ å‡è£… å“ˆæ¬  é’“é±¼ è§‚å¯Ÿ å–œçˆ±'.split(' ')
                    }
                ]
            }
        ]

        const readWordTextDOM = document.querySelector('.read-word-text > textarea')



        /**
         * åˆ›å»ºðŸ“•å…ƒç´ 
         * @author 	 linyisonger
         * @date 	 2025-04-10
         */
        function createBookDOM() {
            let bookWordsDOM = document.createElement('div')
            bookWordsDOM.className = 'book-words'

            for (const book of bookWords) {
                let bookDOM = document.createElement('div')
                let bookNameDOM = document.createElement('div')
                let bookPartsDOM = document.createElement('div')

                bookDOM.className = 'book'
                bookNameDOM.className = 'name'
                bookPartsDOM.className = 'parks'

                bookNameDOM.textContent = book.name

                for (const part of book.parts) {
                    let partDOM = document.createElement('div')
                    let partNameDOM = document.createElement('div')
                    let partWordsDOM = document.createElement('div')

                    partDOM.className = 'park'
                    partNameDOM.className = 'name'
                    partWordsDOM.className = 'words'

                    partNameDOM.textContent = part.name;

                    for (const words of part.words) {
                        let workDOM = document.createElement('div')
                        workDOM.className = 'word'
                        workDOM.textContent = words
                        partWordsDOM.appendChild(workDOM)

                        workDOM.addEventListener('click', (e) => {
                            e.target.classList.toggle('selected')

                            let wordsSelectedDOMList = document.querySelectorAll('.book-words  .word.selected')
                            let wordsSelected = []
                            wordsSelectedDOMList.forEach(item => {
                                wordsSelected.push(item.textContent)
                            })
                            readWordTextDOM.value = wordsSelected.join(' ');
                        })
                    }

                    partDOM.appendChild(partNameDOM)
                    partDOM.appendChild(partWordsDOM)
                    bookPartsDOM.appendChild(partDOM)
                }

                bookDOM.appendChild(bookNameDOM)
                bookDOM.appendChild(bookPartsDOM)
                bookWordsDOM.appendChild(bookDOM)
            }

            document.body.prepend(bookWordsDOM);
        }

        createBookDOM();


        const synth = window.speechSynthesis;
        let voices;
        function loadVoices() {
            voices = synth.getVoices();
        }

        // in Google Chrome the voices are not ready on page load
        if ("onvoiceschanged" in synth) {
            synth.onvoiceschanged = loadVoices;
        } else {
            loadVoices();
        }

        let readWordsDOM = document.querySelector('.read-words')
        let readIntervalDOM = document.querySelector('.read-interval')
        readWordsDOM.addEventListener('click', readWord)
        readIntervalDOM.addEventListener('change', (e) => {
            let textDOM = e.target.parentElement.parentElement.querySelector('.form-item-text')
            textDOM.textContent = e.target.value + 's';
        })
        async function readWord() {
            let wordsSelected = readWordTextDOM.value.split(' ')
            for (let i = 0; i < wordsSelected.length; i++) {
                const words = wordsSelected[i];
                const utterThis = new SpeechSynthesisUtterance(words);
                utterThis.voice = voices[0];
                synth.speak(utterThis);
                await new Promise(r => setTimeout(r, +readIntervalDOM.value * 1000))
            }

        }

    </script>
</body>

</html>