<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/global.css">
    <link rel="stylesheet" href="./assets/fontawesome/css/all.min.css">

    <style>
        .map-container {
            background-image: url('./assets/monopoly/map.jpg');
            width: 1225px;
            height: 837px;
            position: relative;
        }

        .map-element {
            position: absolute;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .map-element .player {
            width: 36px;
            height: 36px;
            margin-right: 5px;
            border-radius: 50%;
            background-repeat: no-repeat;
            background-size: contain;
            border: 4px solid var(--border-color);
            z-index: 1;
        }

        .map-element .corona {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            pointer-events: none;
            border: 4px solid var(--border-color);
        }

        .map-element .corona i {
            opacity: 0;
            padding: 5px;
        }

        .map-element .corona .mortgaged {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(30deg) scale(1.4);
            font-weight: bold;
            text-shadow: 2px 2px red;
        }

        .map-element .corona[level='1'] i:nth-of-type(1) {
            opacity: 1;
            color: green;
        }

        .map-element .corona[level='2'] i {
            opacity: 1;
            color: green;
        }

        .map-element .corona[level='3'] i:nth-of-type(1) {
            opacity: 1;
            color: red;
        }

        .map-mask,
        .commentary-seat {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, .8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .map-mask .game-start .players {
            display: flex;
        }

        .map-mask .game-start .player {
            margin-left: 20px;
            text-align: center;
            padding: 20px;
            background: #fff;
            user-select: none;
        }

        .map-mask .game-start .player.active {
            background: #caf09f;
        }

        .map-mask .game-start .player img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            pointer-events: none;
        }

        .game-start .btns {
            display: flex;
        }

        .game-start .start-btn,
        .game-start .rule-btn {
            padding: 10px 20px;
            margin: 20px auto;
            background-color: #70d1cc;
            user-select: none;
        }

        [class$='-btn']:active {
            opacity: .7;
        }

        .game-rule {
            position: relative;
        }

        .game-rule .fa-times {
            position: absolute;
            right: 0;
            width: 100px;
            height: 100px;
            font-size: 30px;
            color: #f57373;
            text-align: center;
            line-height: 100px;
        }

        .commentary-seat {
            display: none;
            left: 171px;
            top: 171px;
            right: 171px;
            bottom: 171px;
            justify-content: start;
            align-items: start;
        }

        .commentary-seat .player-list {
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            padding-left: 20px;
        }

        .commentary-seat .player-list .player {
            display: flex;
            margin-bottom: 20px;
            position: relative;
        }

        .commentary-seat .player .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .commentary-seat .player .fund {
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            color: black;
            text-shadow: 2px 2px gold;
        }

        .commentary-seat .inventory {
            display: flex;
            align-items: center;
        }

        .commentary-seat .player .bankruptcy {
            position: absolute;
            left: 0;
            top: 0;
            background-color: rgba(59, 59, 59, 0.5);
            border-radius: 50%;
            height: 100%;
            width: 50px;
            color: #f24;
            text-align: center;
            line-height: 50px;
            font-size: 14px;
            font-weight: bold;
            transform: rotate(30deg);
        }

        .commentary-seat .player .card {
            margin-left: 10px;
            background: var(--bg-color);
            padding: 5px 5px;
            border: 1px solid #ddd;
        }

        .commentary-seat .player .avatar.active {
            border: 4px solid var(--border-color);
            box-sizing: border-box;
        }

        .commentary-seat .dice {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .commentary-seat .dice img {
            pointer-events: none;
        }

        .commentary-seat .log-list {
            position: absolute;
            left: 0;
            bottom: 0;
            max-height: 180px;
            width: 300px;
            padding-left: 20px;
            padding-bottom: 20px;
            overflow-y: auto;
        }

        .chance-container,
        .destiny-container,
        .business-container,
        .destiny-select,
        .pause-user-select,
        .game-over-container,
        .bank-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, .8);
        }

        .game-over-container {
            padding-top: 150px;
            text-align: center;
            font-weight: 700;
            font-size: 30px;
        }

        .game-over-container .reset-btn {
            padding: 10px 20px;
            background-color: #44a0c4;
            width: 200px;
            margin: 80px auto 0;
            font-size: 20px;
            color: #fff;
        }

        .chance-container .result,
        .destiny-container .result {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .chance-container .loading,
        .destiny-container .loading {
            width: 100%;
            height: 100%;
            transform: rotateY(0deg);
            animation-name: rotating;
            animation-duration: 1s;
            animation-iteration-count: infinite;
        }

        .pause-user-select {
            padding: 100px 0;
            text-align: center;
            vertical-align: middle;
        }

        .pause-user-select .select-btn {
            display: inline-block;
            width: 120px;
            height: 120px;
            border: 2px solid #ddd;
            margin-right: 20px;
            user-select: none;
        }

        .pause-user-select .select-btn:active {
            background-color: #caf09f;
        }

        .pause-user-select .select-btn img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding-top: 20px;
        }

        .chance-container img,
        .destiny-container img {
            position: absolute;
            left: 50%;
            top: 50%;
            height: 442px;
            width: 248px;
            transform: translate(-50%, -50%) rotate(90deg);
        }

        .destiny-select .select-btn:first-child {
            position: absolute;
            left: 30%;
            top: 50%;
            height: 100%;
        }

        .destiny-select .select-btn:last-child {
            position: absolute;
            left: 70%;
            top: 50%;
            height: 100%;
        }

        .destiny-select img {
            height: 221px;
            width: 124px;
            transform: translate(-50%, -50%) rotate(90deg);
        }

        .chance-container .result-close-btn,
        .destiny-container .result-close-btn {
            width: 40px;
            height: 40px;
            position: absolute;
            left: 50%;
            top: 400px;
            background: #f24;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #fff;
        }

        .business-container {
            white-space: nowrap;
            display: flex;
            width: 100%;
        }

        .business-container .info,
        .business-container .operate {
            display: flex;
        }

        .business-container .info {
            padding: 20px;
            margin-left: 300px;
        }

        .business-container .operate {
            flex-direction: column;
            padding-top: 100px;
            flex: 1;
        }

        .business-container .operate .h2 {
            font-size: 28px;
            font-weight: bold;
            color: #555;
            text-align: center;
        }

        .business-container .info img {
            width: 250px;
            height: 426px;
        }

        .business-container .buy-land-btn,
        .business-container .buy-house-btn,
        .business-container .buy-hotel-btn,
        .business-container .free-buy-house-btn,
        .business-container .pass-btn,
        .business-container .redeem-btn {
            padding: 10px 20px;
            background-color: #44a0c4;
            width: 200px;
            margin: 20px auto 0;
        }

        .pass-btn {
            background-color: #949494;
        }

        .bank-container h2 {
            text-align: center;
        }

        .bank-container .desc {
            padding: 0 100px;
        }

        .bank-container .land-list {
            max-height: 270px;
            overflow: auto;
            margin: 20px 100px;
            padding: 0px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .bank-container .land-item {
            position: relative;
            margin-bottom: 20px;
            display: flex;
            width: 48%;
            box-sizing: border-box;
            background-color: #e4e3e3;
        }

        .bank-container .land-item .info {
            display: flex;
            align-items: center;
            flex: 1;
            justify-content: space-between;
            padding: 20px;
        }

        .bank-container .land-item .mortgaged {
            position: absolute;
            background-color: rgb(233, 162, 9);
            font-size: 14px;
            left: 0;
            top: 0;
        }

        .bank-container .land-item .mortgage-btn {
            background-color: #44a0c4;
            width: 60px;
            line-height: 60px;
            text-align: center;
        }

        .bank-container .cancel-btn {
            position: absolute;
            right: 100px;
            bottom: 20px;
            background-color: #44a0c4;
            width: 200px;
            padding: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        @keyframes rotating {
            0% {
                transform: rotateY(0deg);

            }

            50% {
                transform: rotateY(180deg);
            }

            100% {
                transform: rotateY(0deg);

            }
        }
    </style>
</head>

<body>
    <div class="map-container">
        <div class="map-mask">
            <div class="game-start">
                <div class="players select">
                    <div class="player active">
                        <img src="./assets/monopoly/black.jpg" alt="å°é»‘">
                        <div class="name">å°é»‘</div>
                        <div class="color" hidden>black</div>
                    </div>
                    <div class="player active">
                        <img src="./assets/monopoly/red.jpg" alt="å°çº¢">
                        <div class="name">å°çº¢</div>
                        <div class="color" hidden>red</div>
                    </div>
                    <div class="player">
                        <img src="./assets/monopoly/yellow.jpg" alt="å°é»„">
                        <div class="name">å°é»„</div>
                        <div class="color" hidden>yellow</div>
                    </div>
                    <div class="player">
                        <img src="./assets/monopoly/blue.jpg" alt="å°è“">
                        <div class="name">å°è“</div>
                        <div class="color" hidden>blue</div>
                    </div>
                </div>
                <div class="btns">
                    <div class="start-btn">å¼€å§‹æ¸¸æˆ</div>
                    <div class="rule-btn">è§„åˆ™æŸ¥çœ‹</div>
                </div>
            </div>
            <div class="game-rule" hidden>
                <img src="./assets/monopoly/rule.jpg" alt="æ¸¸æˆè§„åˆ™">
                <i class="fas fa-times rule-close-btn"></i>
            </div>
        </div>
        <div class="commentary-seat">
            <div class="player-list"> </div>
            <div class="dice">
                <img src="./assets/monopoly/1.png" alt="1">
                <img src="./assets/monopoly/2.png" alt="2" hidden>
                <img src="./assets/monopoly/3.png" alt="3" hidden>
                <img src="./assets/monopoly/4.png" alt="4" hidden>
                <img src="./assets/monopoly/5.png" alt="5" hidden>
                <img src="./assets/monopoly/6.png" alt="6" hidden>
            </div>
            <div class="log-list"></div>
            <div class="chance-container" hidden>
                <div class="loading">
                    <img src="./assets/monopoly/chance.jpg">
                </div>
                <div class="result" hidden>
                    <img src="./assets/monopoly/chance.jpg">
                    <div class="result-close-btn">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </div>
            <div class="destiny-container" hidden>
                <div class="loading">
                    <img src="./assets/monopoly/destiny.jpg">
                </div>
                <div class="result" hidden>
                    <img src="./assets/monopoly/destiny.jpg">
                    <div class="result-close-btn">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </div>
            <div class="business-container" style="display: none;">
                <div class="info">
                    <img src="./assets/monopoly/land1.jpg" alt="åœ°äº§">
                </div>
                <div class="operate">
                    <div class="h2">è¯·é€‰æ‹©æ‚¨çš„æ“ä½œ</div>
                    <div class="buy-land-btn">è´­ä¹°åœŸåœ°</div>
                    <div class="buy-house-btn">è´­ä¹°æˆ¿å­</div>
                    <div class="free-buy-house-btn">å…è´¹å‡çº§</div>
                    <div class="redeem-btn">èµå›</div>
                    <div class="pass-btn">è·¯è¿‡</div>
                </div>
            </div>
            <div class="destiny-select" hidden>
                <div class="select-btn chance">
                    <img src="./assets/monopoly/chance.jpg">
                </div>
                <div class="select-btn destiny">
                    <img src="./assets/monopoly/destiny.jpg">
                </div>
            </div>
            <div class="pause-user-select" hidden></div>

            <div class="bank-container" hidden>
                <h2>é“¶è¡Œ</h2>
                <div class="desc">
                    æˆ‘ä»¬æ˜¯ä¸€ä¸ªå¾ˆå…¬æ­£çš„æœºæ„å“¦ğŸ˜€~ æ‚¨å·²ç»æ²¡æœ‰ğŸ’´ç¥¨å­å•¦ï¼Œéœ€è¦æŠµæŠ¼ä¸€äº›åœŸåœ°(èµå›æ—¶æ”¶å–10%çš„æ‰‹ç»­è´¹ğŸ’´)ï¼Œä¸ç„¶æ‚¨å°±è¦è¢«æ·˜æ±°å–½
                </div>
                <div class="land-list">
                    <div class="land-item">
                        <div class="info">
                            <div class="name">åŠ æ‹¿å¤§</div>
                            <div class="money">2600å…ƒ</div>
                        </div>
                        <div class="mortgage-btn">æŠµæŠ¼</div>
                        <div class="mortgaged">å·²æŠµæŠ¼</div>
                    </div>
                </div>
                <div class="cancel-btn">æ”¾å¼ƒæŠµæŠ¼(æ¸¸æˆç»“æŸ)</div>
            </div>

            <div class="game-over-container" hidden>
                <div class="h1">æ­å–œå°çº¢è·å¾—æ¸¸æˆèƒœåˆ©</div>
                <div class="reset-btn">é‡æ–°å¼€å§‹</div>
            </div>
        </div>
    </div>

    <script type="module">
        // é»˜è®¤åœ°å›¾äº‹ä»¶
        class MapFunction {
            constructor({
                pass,
                stop
            } = {}) {
                this.pass = pass ?? function (player, score) {
                    console.log('ç»è¿‡', player, score);
                }
                this.stop = stop ?? function (player, score) {
                    console.log('åœç•™', player, score);
                }
            }
        }
        // åœ°å›¾åœŸåœ°äº‹ä»¶
        class MapLandFunction extends MapFunction {
            constructor({
                id,
                landSrc,
                pass,
                stop,
                toll,
                money,
                holder,
                upgrade,
                level,
                maxLevel,
                name,
                mortgaged
            } = {}) {
                super({ pass, stop });
                this.landSrc = landSrc ?? ''
                this.toll = toll
                this.money = money
                this.holder = holder
                this.upgrade = upgrade
                this.level = level
                this.maxLevel = maxLevel
                this.name = name
                this.id = id
                this.mortgaged = mortgaged
                let corona = document.createElement('div')
                let mortgagedDom = document.createElement('div')

                corona.classList.add('corona')
                mortgagedDom.hidden = true
                mortgagedDom.textContent = 'å·²æŠµæŠ¼'
                mortgagedDom.classList.add('mortgaged')
                corona.appendChild(mortgagedDom)
                Object.defineProperty(this, 'mortgaged', {
                    get() {
                        return mortgaged
                    },
                    set(val) {
                        if (val) {
                            log(`ç©å®¶${holder.name} å°†${name}çš„åœŸåœ°ä½¿ç”¨æƒæŠµæŠ¼ç»™é“¶è¡Œ`)
                            mortgagedDom.hidden = false
                        }
                        else {
                            log(`ç©å®¶${holder.name} å°†${name}çš„åœŸåœ°ä½¿ç”¨æƒèµå›`)
                            mortgagedDom.hidden = true
                        }
                        mortgaged = val
                    }
                })


                Object.defineProperty(this, 'holder', {
                    get() {
                        return holder
                    },
                    set(val) {
                        if (val !== null) {
                            log(`ç©å®¶${val.name} è´­ä¹°äº†${name}çš„åœŸåœ°ä½¿ç”¨æƒ èŠ±è´¹${money}å…ƒ`)
                            corona.setAttribute('style', `--border-color:${val.color}`)
                            for (let i = 0; i < 2; i++) {
                                let house = document.createElement('i')
                                house.classList.add('fas', 'fa-home')
                                corona.appendChild(house)
                            }
                            mapElementList[id].appendChild(corona)
                        }
                        else {
                            corona.remove()
                        }
                        holder = val
                    }
                })

                Object.defineProperty(this, 'level', {
                    get() {
                        return level
                    },
                    set(val) {
                        if (val !== 0) {
                            log(`ç©å®¶${holder.name} åœ¨${name}åœŸåœ°å‡çº§äº†æˆ¿å±‹`)
                            // ä¿©ç»¿ ä¸€çº¢
                            corona.setAttribute('level', val)
                        }
                        level = val
                    }
                })

            }
        }
        // æœºä¼šäº‹ä»¶
        class ChanceFunction {
            constructor({
                name,
                /** ä¿¡æ¯ */
                info,
                /** å¥–ç½š */
                award,
                /** ç»“æœå›¾ */
                resultSrc,
                /** ç»“æœäº‹ä»¶ */
                resultFunc,
                /** å…³é—­äº‹ä»¶ */
                closeFunc
            } = {}) {
                this.name = name ?? ''
                this.info = info ?? ''
                this.award = award ?? ''
                this.resultSrc = resultSrc ?? ''
                this.resultFunc = resultFunc ?? function () { }
                this.closeFunc = closeFunc ?? function () { }
                this.container = document.querySelector('.chance-container');
                this.loading = this.container.querySelector('.loading')
                this.result = this.container.querySelector('.result')
                this.closeBtn = this.result.querySelector('.result-close-btn')
                this.closeBtn.addEventListener('click', () => {
                    this.container.hidden = true;
                    this.closeFunc()
                })
                let that = this;
                this.run = function (player) {
                    this.container.hidden = false;
                    this.result.hidden = true;
                    setTimeout(() => {
                        this.resultFunc.bind(that, player)()
                        this.result.querySelector('img').src = this.resultSrc
                        this.result.hidden = false;
                    }, 1500)
                }
            }

        }
        // å‘½è¿äº‹ä»¶
        class DestinyFunction {
            constructor({
                name,
                /** ä¿¡æ¯ */
                info,
                /** å¥–ç½š */
                award,
                /** ç»“æœå›¾ */
                resultSrc,
                /** ç»“æœäº‹ä»¶ */
                resultFunc,
                /** å…³é—­äº‹ä»¶ */
                closeFunc
            } = {}) {
                this.name = name ?? ''
                this.info = info ?? ''
                this.award = award ?? ''
                this.resultSrc = resultSrc ?? ''
                this.resultFunc = resultFunc ?? function () { }
                this.closeFunc = closeFunc ?? function () { }
                this.container = document.querySelector('.destiny-container');
                this.loading = this.container.querySelector('.loading')
                this.result = this.container.querySelector('.result')
                this.closeBtn = this.result.querySelector('.result-close-btn')
                this.closeBtn.addEventListener('click', () => {
                    this.container.hidden = true;
                    this.closeFunc()
                })
                let that = this;
                this.run = function (player) {
                    this.container.hidden = false;
                    this.result.hidden = true;
                    setTimeout(() => {
                        this.resultFunc.bind(that, player)()
                        this.result.querySelector('img').src = this.resultSrc
                        this.result.hidden = false;
                    }, 1500)
                }
            }
        }
        // ç©å®¶èƒŒåŒ…
        class Knapsack extends Array {
            constructor(player) {
                super()
                this.player = player
            }
            push(...items) {
                super.push(...items)
                this.render(...items)
            }
            splice(start, deleteCount, ...items) {
                let inventory = this.player.inventory
                let deleteList = this.slice(start - 1, start + deleteCount);
                for (let i = 0; i < deleteList.length; i++) {
                    const element = deleteList[i];
                    console.log(inventory.querySelector(`.card[title=${element.name}]`));
                    inventory.querySelector(`.card[title=${element.name}]`).remove()
                }
                super.splice(start, deleteCount, ...items)
                this.render(...items)
            }
            render(...items) {
                let inventory = this.player.inventory
                for (let i = 0; i < items.length; i++) {
                    const name = items[i].name;
                    let card = document.createElement('div')
                    card.classList.add('card')
                    card.textContent = name[0]
                    card.setAttribute('title', name)
                    switch (name) {
                        case "å‡ºç‹±è®¸å¯è¯":
                            card.setAttribute('style', `--bg-color:rgb(242,199,6)`)
                            break;
                        case "å…è´¹å‡çº§å¡":
                            card.setAttribute('style', `--bg-color:rgb(206,54,43)`)
                            break;
                    }
                    inventory.appendChild(card)
                }
            }
        }
        // ä¸‰æ–¹åº“  ä»…ä½¿ç”¨éšæœºæ¨¡å—
        import { Randoms } from "https://gcore.jsdelivr.net/npm/@3r/tool/lib/randoms.js";

        // é…ç½®
        const config = {
            // åˆå§‹èµ„é‡‘
            money: 5000, // (5000 + 2000 + 1000 + 500 + 200 + 100) * 2
            // æ‰‹ç»­è´¹ + æœ¬é‡‘
            commission: 1.1
        }

        // åœ°å›¾å®¹å™¨
        let mapContainer = document.querySelector('.map-container')
        // åœ°å›¾é®ç½©
        let mapMask = document.querySelector('.map-mask')
        // å¼€å§‹æ¸¸æˆ
        let gameStart = document.querySelector('.game-start')
        // è§‚ä¼—å¸­
        let commentarySeat = document.querySelector('.commentary-seat')
        // æ¸¸æˆè§„åˆ™
        let gameRule = document.querySelector('.game-rule')
        // è§„åˆ™æŒ‰é’®
        let ruleBtn = document.querySelector('.rule-btn')
        // å¼€å§‹æŒ‰é’®
        let startBtn = document.querySelector('.start-btn')
        // è§„åˆ™å…³é—­æŒ‰é’®
        let ruleCloseBtn = document.querySelector('.rule-close-btn')
        // å¼€å§‹æ¸¸æˆå‰é€‰æ‹©ç©å®¶
        let selectPlayers = document.querySelectorAll('.players.select .player')
        // ğŸ²
        let dice = commentarySeat.querySelector('.dice')
        // æ—¥å¿—
        let logList = commentarySeat.querySelector('.log-list')

        // ç©å®¶ä¿¡æ¯åˆ—è¡¨
        let playerInfoList = []
        // åœ°å›¾å…ƒç´ åˆ—è¡¨
        let mapElementList = []
        // åœ°å›¾æ–¹æ³•åˆ—è¡¨
        let mapFunctionList = []
        // æœºä¼šäº‹ä»¶åˆ—è¡¨
        let chanceFunctionList = []
        // å‘½è¿äº‹ä»¶åˆ—è¡¨
        let destinyFunctionList = []
        // ğŸ²æ˜¯å¦è½¬åŠ¨ä¸­
        let diceTurn = false;
        // ğŸ™‹â€å“ªä½ç©å®¶æ“ä½œ
        let dicePlayerIndex = 0

        // åˆå§‹åŒ–
        function init() {
            // æ ‡è®°åœ°å›¾å…ƒç´ ä¿¡æ¯åˆ—è¡¨
            let mapElementInfoList = [
                {
                    top: '667px',
                    left: '1056px',
                    width: '169px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '945px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '834px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '723px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '612px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '501px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '390px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '279px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '168px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '0',
                    width: '166px',
                    height: '167px',
                },
                {
                    top: '568px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '469px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '370px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '272px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '173px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '0px',
                    left: '0',
                    width: '171px',
                    height: '171px',
                },
                {
                    top: '7px',
                    left: '173px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '284px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '394px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '505px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '615px',
                    width: '105px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '723px',
                    width: '107px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '832px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '943px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '6px',
                    left: '1054px',
                    width: '170px',
                    height: '166px',
                },
                {
                    top: '175px',
                    left: '1054px',
                    width: '170px',
                    height: '98px',
                },
                {
                    top: '275px',
                    left: '1054px',
                    width: '170px',
                    height: '93px',
                },
                {
                    top: '370px',
                    left: '1054px',
                    width: '170px',
                    height: '98px',
                },
                {
                    top: '470px',
                    left: '1054px',
                    width: '170px',
                    height: '95px',
                },
                {
                    top: '567px',
                    left: '1054px',
                    width: '170px',
                    height: '98px',
                },
            ]
            for (let i = 0; i < mapElementInfoList.length; i++) {
                const info = mapElementInfoList[i]
                const element = document.createElement('div')
                element.setAttribute('style', `top:${info.top};left:${info.left};width:${info.width};height:${info.height}`)
                element.classList.add('map-element')
                // å‚¨å­˜åˆ—è¡¨ä¸­
                mapElementList.push(element)
                // å¡å…¥é¡µé¢æ¸²æŸ“
                mapContainer.appendChild(element)

            }


            // äº¤æ˜“å®¹å™¨
            let businessContainer = document.querySelector('.business-container');

            // äº¤æ˜“é¡µé¢è·¯è¿‡æ“ä½œ
            let businessContainerPassBtn = businessContainer.querySelector('.pass-btn');
            businessContainerPassBtn.addEventListener("click", () => {
                businessContainer.setAttribute('style', 'display:none')
                nextDicePlayer()
            })

            // å½“å‰äº¤æ˜“çš„åœ°çš®
            let currentBusinessLand = null
            // è´­ä¹°åœ°çš®
            let businessContainerBuyLandBtn = businessContainer.querySelector('.buy-land-btn');
            businessContainerBuyLandBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                if (currentPlayer.money < currentBusinessLand.money) {
                    alert('ä½™é¢ä¸è¶³æ— æ³•è´­ä¹°')
                }
                else {
                    currentPlayer.money -= currentBusinessLand.money;
                    currentBusinessLand.holder = currentPlayer;
                    businessContainer.setAttribute('style', 'display:none')
                    nextDicePlayer()
                }
            })
            // ä¹°ğŸ 
            let businessContainerBuyHouseBtn = businessContainer.querySelector('.buy-house-btn');
            businessContainerBuyHouseBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                if (currentPlayer.money < currentBusinessLand.upgrade) {
                    alert('ä½™é¢ä¸è¶³æ— æ³•å‡çº§')
                }
                else {
                    currentPlayer.money -= currentBusinessLand.upgrade;
                    currentBusinessLand.level++;
                    businessContainer.setAttribute('style', 'display:none')
                    nextDicePlayer()
                }
            })
            // 0å…ƒè´­ğŸ 
            let businessContainerFreeBuyHouseBtn = businessContainer.querySelector('.free-buy-house-btn')
            businessContainerFreeBuyHouseBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                let idx = currentPlayer.knapsack.findIndex(item => item.name === 'å…è´¹å‡çº§å¡')
                currentPlayer.knapsack.splice(idx, 1)
                currentBusinessLand.level++;
                businessContainer.setAttribute('style', 'display:none')
                nextDicePlayer()
            })
            // èµå› 
            let businessContainerRedeemBtn = businessContainer.querySelector('.redeem-btn')
            businessContainerRedeemBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                let levelMoney = currentBusinessLand.level * currentBusinessLand.upgrade
                let totalMoney = currentBusinessLand.money + (isNaN(levelMoney) ? 0 : levelMoney)
                totalMoney = ~~(totalMoney * config.commission)
                if (currentPlayer.money < totalMoney) {
                    alert('ä½™é¢ä¸è¶³æ— æ³•èµå›')
                }
                else {
                    businessContainer.setAttribute('style', 'display:none')
                    currentBusinessLand.mortgaged = false
                    nextDicePlayer()
                }
            })

            // åœ¨å›½å®¶æ­¢æ­¥
            let countryStop = function (player, score) {
                let img = businessContainer.querySelector('.info img')
                img.src = this.landSrc;
                businessContainerBuyLandBtn.hidden = true;
                businessContainerBuyHouseBtn.hidden = true;
                businessContainerFreeBuyHouseBtn.hidden = true;
                businessContainerRedeemBtn.hidden = true;
                if (!this.holder || this.holder === player) {
                    currentBusinessLand = this;
                    if (this.mortgaged) {
                        console.log(currentBusinessLand);
                        businessContainerRedeemBtn.hidden = false;
                        let levelMoney = currentBusinessLand.level * currentBusinessLand.upgrade
                        let totalMoney = currentBusinessLand.money + (isNaN(levelMoney) ? 0 : levelMoney)
                        totalMoney = ~~(totalMoney * config.commission)
                        businessContainerRedeemBtn.textContent = `èµå›åœŸåœ°(${totalMoney}å…ƒ)`
                    }
                    else if (this.level === 3) {
                        nextDicePlayer()
                    }
                    else if (this.holder === player) {
                        let upgradeText = this.level === 2 ? 'å‡çº§æ—…é¦†' : 'è´­ä¹°æˆ¿å±‹'
                        let idx = player.knapsack.findIndex(item => item.name === 'å…è´¹å‡çº§å¡')
                        if (idx > -1) {
                            businessContainerFreeBuyHouseBtn.hidden = false;
                        }
                        log(`ç©å®¶${player.name} åœ¨${this.name}åœŸåœ°${upgradeText}`)
                        businessContainerBuyHouseBtn.textContent = `${upgradeText}(${this.upgrade}å…ƒ)`
                        businessContainerBuyHouseBtn.hidden = false;
                    }
                    else {
                        businessContainerBuyLandBtn.textContent = `è´­ä¹°åœŸåœ°(${this.money}å…ƒ)`
                        businessContainerBuyLandBtn.hidden = false;
                    }
                    if (this.level < 3) businessContainer.setAttribute('style', 'display:flex')
                }
                else if (!this.mortgaged) {
                    let toll = this.toll[this.level]
                    player.money -= toll;
                    this.holder.money += toll
                    log(`ç©å®¶${player.name}åœç•™${this.name} ç»™ç©å®¶${this.holder.name} æ”¯ä»˜è¿‡è·¯è´¹${toll}å…ƒ`)
                    nextDicePlayer()
                }
                else {
                    nextDicePlayer()
                }
            }
            // åœ¨æ°´ç”µå‚æ­¢æ­¥
            let hydropowerStop = function (player, score) {
                let img = businessContainer.querySelector('.info img')
                img.src = this.landSrc;
                businessContainerBuyLandBtn.hidden = true;
                businessContainerBuyHouseBtn.hidden = true;
                businessContainerFreeBuyHouseBtn.hidden = true;
                businessContainerRedeemBtn.hidden = true;

                if (this.mortgaged) {
                    businessContainerRedeemBtn.hidden = false;
                    let totalMoney = currentBusinessLand.money
                    totalMoney = ~~(totalMoney * config.commission)
                    businessContainerRedeemBtn.textContent = `èµå›åœŸåœ°(${totalMoney}å…ƒ)`
                }
                else if (!this.holder) {
                    currentBusinessLand = this;
                    businessContainerBuyLandBtn.textContent = `è´­ä¹°åœŸåœ°(${this.money}å…ƒ)`
                    businessContainerBuyLandBtn.hidden = false;
                    businessContainer.setAttribute('style', 'display:flex')
                }
                else if (this.holder === player) {
                    nextDicePlayer()
                }
                else if (!this.mortgaged) {
                    let level = mapFunctionList[5].holder === mapFunctionList[28].holder ? 1 : 0
                    let toll = this.toll[level] * score
                    player.money -= toll;
                    this.holder.money += toll
                    log(`ç©å®¶${player.name}åœç•™${this.name} ç»™ç©å®¶${this.holder.name} æ”¯ä»˜è¿‡è·¯è´¹${toll}å…ƒ`)
                    nextDicePlayer()
                }
                else {
                    nextDicePlayer()
                }
            }
            // åœ¨æœºåœºæ­¢æ­¥
            let airfieldStop = function (player, score) {
                let img = businessContainer.querySelector('.info img')
                img.src = this.landSrc;
                businessContainerBuyLandBtn.hidden = true;
                businessContainerBuyHouseBtn.hidden = true;
                businessContainerFreeBuyHouseBtn.hidden = true;
                businessContainerRedeemBtn.hidden = true;
                if (this.mortgaged) {
                    businessContainerRedeemBtn.hidden = false;
                    let totalMoney = currentBusinessLand.money
                    totalMoney = ~~(totalMoney * config.commission)
                    businessContainerRedeemBtn.textContent = `èµå›åœŸåœ°(${totalMoney}å…ƒ)`
                }
                else if (!this.holder) {
                    currentBusinessLand = this;
                    businessContainerBuyLandBtn.textContent = `è´­ä¹°åœŸåœ°(${this.money}å…ƒ)`
                    businessContainerBuyLandBtn.hidden = false;
                    businessContainer.setAttribute('style', 'display:flex')
                }
                else if (this.holder === player) {
                    nextDicePlayer()
                }
                else if (!this.mortgaged) {
                    let level = mapFunctionList[7].holder === mapFunctionList[21].holder ? 1 : 0
                    let toll = this.toll[level]
                    player.money -= toll;
                    this.holder.money += toll
                    log(`ç©å®¶${player.name}åœç•™${this.name} ç»™ç©å®¶${this.holder.name} æ”¯ä»˜è¿‡è·¯è´¹${toll}å…ƒ`)
                    nextDicePlayer()
                }
                else {
                    nextDicePlayer()
                }
            }
            // ğŸ‘®â€â™€ï¸æ¬¢è¿å›å®¶~
            let goToPrison = function (player, score) {
                log(`ç©å®¶${player.name}å…¥ç‹± æš‚åœä¸€å›åˆ`)
                player.moveScore += (mapElementList.length - player.moveScore % mapElementList.length + 9)
                let idx = player.knapsack.findIndex(item => item.name === 'å‡ºç‹±è®¸å¯è¯');
                if (idx > -1) {
                    log(`ç©å®¶${player.name} ä½¿ç”¨å‡ºç‹±è®¸å¯è¯ æ— éœ€æš‚åœ`)
                    player.knapsack.splice(idx, 1)
                }
                else player.pause = true;
                let target = player.moveScore % mapElementList.length
                mapElementList[target].appendChild(player.chessPiece)
                mapFunctionList[target]['stop'](player, score)
            }
            // æœºä¼šåœ°å›¾äº‹ä»¶
            let chanceMapFunction = new MapFunction({
                stop: (player, score) => {
                    let target = Randoms.getRandomInt(0, chanceFunctionList.length)
                    chanceFunctionList[target].run(player)
                }
            })
            // å‘½è¿åœ°å›¾äº‹ä»¶
            let destinyMapFunction = new MapFunction({
                stop: (player, score) => {
                    let target = Randoms.getRandomInt(0, destinyFunctionList.length)
                    destinyFunctionList[target].run(player)
                }
            })
            // åœ°å›¾äº‹ä»¶åˆ—è¡¨
            mapFunctionList = [
                new MapFunction({
                    pass: (player, score) => {
                        log(`ç©å®¶${player.name}ç»è¿‡èµ·ç‚¹ å¥–åŠ±1000å…ƒ`)
                        player.money += 1000;
                    },
                    stop: nextDicePlayer
                }),
                new MapLandFunction({
                    id: 1,
                    name: 'ä¸­å›½',
                    money: 4000,
                    landSrc: './assets/monopoly/land4.jpg',
                    holder: null,
                    level: 0,
                    toll: [500, 2000, 5500, 11500],
                    upgrade: 2000,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 2,
                    name: 'æ³°å›½',
                    money: 1000,
                    landSrc: './assets/monopoly/land16.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300, 900, 2000],
                    upgrade: 500,
                    stop: countryStop
                }),
                chanceMapFunction,
                new MapLandFunction({
                    id: 4,
                    name: 'å°å°¼',
                    money: 1600,
                    landSrc: './assets/monopoly/land7.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 600, 1800, 5000],
                    upgrade: 1000,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 5,
                    name: 'è‡ªæ¥æ°´å‚',
                    money: 1200,
                    landSrc: './assets/monopoly/land14.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300],
                    stop: hydropowerStop
                }),
                destinyMapFunction,
                new MapLandFunction({
                    id: 7,
                    name: 'ä¸Šæµ·æµ¦ä¸œå›½é™…æœºåœº',
                    money: 2000,
                    landSrc: './assets/monopoly/land18.jpg',
                    holder: null,
                    level: 0,
                    toll: [3000, 5000],
                    stop: airfieldStop
                }),
                new MapLandFunction({
                    id: 8,
                    name: 'æ—¥æœ¬',
                    money: 2000,
                    landSrc: './assets/monopoly/land13.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 800, 2200, 6000],
                    upgrade: 1000,
                    stop: countryStop
                }),
                new MapFunction({
                    stop: nextDicePlayer
                }),
                new MapLandFunction({
                    id: 10,
                    name: 'è¥¿ç­ç‰™',
                    money: 2200,
                    landSrc: './assets/monopoly/land10.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 900, 2500, 7000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                chanceMapFunction,
                new MapLandFunction({
                    id: 12,
                    name: 'å·´è¥¿',
                    money: 2400,
                    landSrc: './assets/monopoly/land12.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 1000, 3000, 7500],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapFunction({
                    stop: (player, score) => {
                        log(`ç©å®¶${player.name}éœ€è¦ç¼´çº³700å…ƒæ‰€å¾—ç¨`)
                        player.money -= 700;
                        nextDicePlayer()
                    }
                }),
                new MapLandFunction({
                    id: 14,
                    name: 'åŠ æ‹¿å¤§',
                    money: 2600,
                    landSrc: './assets/monopoly/land6.jpg',
                    holder: null,
                    level: 0,
                    toll: [300, 1100, 3300, 8000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapFunction({
                    stop: (player, score) => {
                        log(`ç©å®¶${player.name}åœç•™å…è´¹åœè½¦åœº æš‚åœä¸€å›åˆ`)
                        player.pause = true;
                        nextDicePlayer()
                    }
                }),
                new MapLandFunction({
                    id: 16,
                    name: 'åœŸè€³å…¶',
                    money: 2200,
                    landSrc: './assets/monopoly/land3.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 900, 2500, 7000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 17,
                    name: 'ç¾å›½',
                    money: 2400,
                    landSrc: './assets/monopoly/land8.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 1000, 3000, 7500],
                    upgrade: 1500,
                    stop: countryStop
                }),
                destinyMapFunction,
                new MapLandFunction({
                    id: 19,
                    name: 'è‹±å›½',
                    money: 3000,
                    landSrc: './assets/monopoly/land9.jpg',
                    holder: null,
                    level: 0,
                    toll: [300, 1300, 3900, 9000],
                    upgrade: 2000,
                    stop: countryStop,
                }),
                new MapLandFunction({
                    id: 20,
                    name: 'å¾·å›½',
                    money: 3600,
                    landSrc: './assets/monopoly/land17.jpg',
                    holder: null,
                    level: 0,
                    toll: [400, 1800, 5000, 11000],
                    upgrade: 2000,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 21,
                    name: 'ä¼¦æ•¦å¸Œæ€ç½—å›½é™…æœºåœº',
                    money: 2000,
                    landSrc: './assets/monopoly/land5.jpg',
                    holder: null,
                    level: 0,
                    toll: [3000, 5000],
                    stop: airfieldStop
                }),
                chanceMapFunction,
                new MapFunction({
                    stop: (player, score) => {
                        log(`ç©å®¶${player.name}éœ€è¦ç¼´çº³500å…ƒç­¾è¯è´¹`)
                        player.money -= 500;
                        nextDicePlayer()
                    }
                }),
                new MapFunction({
                    stop: goToPrison
                }),
                new MapLandFunction({
                    id: 25,
                    name: 'ä¿„ç½—æ–¯',
                    money: 3200,
                    landSrc: './assets/monopoly/land11.jpg',
                    holder: null,
                    level: 0,
                    toll: [300, 1500, 4500, 10000],
                    upgrade: 2000,
                    stop: countryStop
                }),
                destinyMapFunction,
                new MapLandFunction({
                    id: 27,
                    name: 'æ³•å›½',
                    money: 2200,
                    landSrc: './assets/monopoly/land15.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 900, 2500, 7000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 28,
                    name: 'ç”µåŠ›å…¬å¸',
                    money: 1200,
                    landSrc: './assets/monopoly/land2.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300],
                    stop: hydropowerStop
                }),
                new MapLandFunction({
                    id: 29,
                    name: 'å°åº¦',
                    money: 1000,
                    landSrc: './assets/monopoly/land1.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300, 900, 2700],
                    upgrade: 500,
                    stop: countryStop
                })
            ]
            // å‘½è¿é€‰æ‹©
            let destinySelect = commentarySeat.querySelector('.destiny-select')
            let selectChance = destinySelect.querySelector('.select-btn.chance')
            let selectDestiny = destinySelect.querySelector('.select-btn.destiny')
            selectChance.addEventListener('click', function () {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                chanceMapFunction.stop(currentPlayer)
                destinySelect.hidden = true;
            })
            selectDestiny.addEventListener('click', function () {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                destinyMapFunction.stop(currentPlayer)
                destinySelect.hidden = true;
            })

            // æš‚åœç©å®¶é€‰æ‹©
            let pauseUserSelect = commentarySeat.querySelector('.pause-user-select')
            function pauseUserSelectOpen() {
                pauseUserSelect.hidden = false;
                pauseUserSelect.innerHTML = ''
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                playerInfoList.filter(player => !player.isBankruptcy).forEach((player => {
                    let info = document.createElement('div')
                    info.classList.add('select-btn')
                    let avatar = document.createElement('img')
                    avatar.src = player.avater
                    let name = document.createElement('div')
                    name.textContent = player.name
                    info.appendChild(avatar)
                    info.appendChild(name)
                    pauseUserSelect.appendChild(info)

                    info.addEventListener('click', function () {
                        log(`ç©å®¶${currentPlayer.name} æŒ‡å®š ç©å®¶${player.name} æš‚åœä¸€å›åˆ`)
                        player.pause = true;
                        pauseUserSelect.hidden = true;
                        nextDicePlayer()
                    })
                }))
            }

            // ä¸ªäºº
            let moneyResultFunc = function (player) {
                log(`${player.name} ${this.info}`)
                player.money += this.award;
                nextDicePlayer()
            }
            // ç¾¤ä½“
            let moneyAndOtherPlayersResultFunc = function (player) {
                log(`${player.name} ${this.info}`)
                let other = playerInfoList.filter(p => p != player && !p.isBankruptcy)
                player.money += other.length * this.award;
                other.map(p => p.money -= this.award)
                nextDicePlayer()
            }
            // æœºä¼šäº‹ä»¶åˆ—è¡¨
            chanceFunctionList = [
                new ChanceFunction({
                    info: 'åˆ°æ³°å›½æŒ‰æ‘©å­¦é™¢ å­¦ä¹ æ­£ç»Ÿæ³°å¼æŒ‰æ‘© ä»˜å­¦è´¹500å…ƒ',
                    award: -500,
                    resultSrc: './assets/monopoly/chance1.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'åœ¨çº½çº¦æ—¶ä»£å¹¿åœº æ‰®æ¼”è¡—å¤´è‰º æ‰“èµ500å…ƒ',
                    award: 500,
                    resultSrc: './assets/monopoly/chance2.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'ç ´åè‹±å›½å¤§è‹±åšç‰©é¦† çç¨€è‰ºæœ¯å“ ç½šæ¬¾1000å…ƒ',
                    award: -1000,
                    resultSrc: './assets/monopoly/chance3.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'æˆç«‹çˆ±å¿ƒæ…ˆå–„åŸºé‡‘ä¼š å¸®åŠ©å¼±åŠ¿ç¾¤ä½“ å¥–åŠ±1200å…ƒ',
                    award: 1200,
                    resultSrc: './assets/monopoly/chance4.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'è·è˜ä¸ºæ³•å›½è“å¸¦å¨è‰ºå­¦é™¢ é¦–å¸­æ•™å¸ˆ å¥–åŠ±é‡‘800å…ƒ',
                    award: 800,
                    resultSrc: './assets/monopoly/chance5.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'æˆåŠŸç™»ä¸Šä¸–ç•Œæœ€é«˜å³° ã€Œç ç©†æœ—ç›å³°ã€ æ¯ä½ç©å®¶ç»™ä½ å¥–åŠ±é‡‘300å…ƒ',
                    award: 300,
                    resultSrc: './assets/monopoly/chance6.jpg',
                    resultFunc: moneyAndOtherPlayersResultFunc
                }),
                new ChanceFunction({
                    info: 'å‚åŠ å·´è¥¿ç‹‚æ¬¢èŠ‚æ¸¸è¡Œ äººæ½®ä¼—å¤šï¼Œé­é‡æ‰’æ‰‹é›†å›¢ æŸå¤±700å…ƒ',
                    award: -700,
                    resultSrc: './assets/monopoly/chance7.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'è€ƒå¤æ–°å‘ç° åœ¨åŸƒåŠæŒ–æ˜å‡ºç¨€ä¸–çå® å¥–é‡‘800å…ƒ',
                    award: 800,
                    resultSrc: './assets/monopoly/chance8.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'å‚åŠ åŒ—äº¬æ•…å®«å¿—æ„¿è€…æœåŠ¡é˜Ÿï¼Œç²¾ç¥å¯å˜‰ å…¨ä½“ç©å®¶ä¸ºä½ é¼“æŒ10ç§’é’Ÿ',
                    resultSrc: './assets/monopoly/chance9.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        nextDicePlayer()
                    }
                }),
                new ChanceFunction({
                    info: 'æ‹›å¾…æœ‹å‹å»çœ‹ ä¸–ç•Œæ¯è¶³çƒèµ› ä»˜ç»™æ¯ä½ç©å®¶200å…ƒ',
                    award: -200,
                    resultSrc: './assets/monopoly/chance10.jpg',
                    resultFunc: moneyAndOtherPlayersResultFunc
                }),
                new ChanceFunction({
                    name: 'å…è´¹å‡çº§å¡',
                    info: 'æŠ•èµ„å°å°¼å·´å˜å²›åº¦å‡æ‘ å¯åœ¨è‡ªå·±åœŸåœ°ä¸Šä»»é€‰ä¸€å¤„å…è´¹å‡çº§ä¸€æ ‹æˆ¿å±‹',
                    resultSrc: './assets/monopoly/chance11.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        player.knapsack.push(this)
                        nextDicePlayer()
                    }
                }),
                new ChanceFunction({
                    info: 'æ­ä¹˜è±ªåæ¸¸è½®ç¯æ¸¸ä¸–ç•Œ è´¹ç”¨900å…ƒ',
                    award: -900,
                    resultSrc: './assets/monopoly/chance12.jpg',
                    resultFunc: moneyResultFunc
                }),
            ]
            // å‘½è¿äº‹ä»¶åˆ—è¡¨
            destinyFunctionList = [
                new DestinyFunction({
                    info: 'çœ¼å…‰ç²¾å‡† æŠ•èµ„è‚¡ç¥¨è·åˆ© å¾—300å…ƒ',
                    award: 300,
                    resultSrc: './assets/monopoly/destiny1.jpg',
                    resultFunc: moneyResultFunc
                }),
                new DestinyFunction({
                    info: 'åœ¨éæ´²è‚¯å°¼äºšé‡ç”ŸåŠ¨ç‰©å›­åŒº ä¹±å–‚é£ŸåŠ¨ç‰© ç½šæ¬¾800å…ƒ',
                    award: -800,
                    resultSrc: './assets/monopoly/destiny2.jpg',
                    resultFunc: moneyResultFunc
                }),
                new DestinyFunction({
                    info: 'å‚åŠ æŠ½å¥–å¤§èµ› å¯ä»»æ„é€‰æ‹©å†ç¿»ä¸€å¼ å‘½è¿å¡æˆ–æœºä¼šå¡',
                    resultSrc: './assets/monopoly/destiny3.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        this.container.hidden = true;
                        destinySelect.hidden = false;
                    }
                }),
                new DestinyFunction({
                    info: 'å…¥é€‰å›½å®¶é˜Ÿ ä»£è¡¨å‚åŠ å¥¥è¿ä¼šæ¯”èµ› è¯·æ¯ä½ç©å®¶èµç¾ä½ 1ä¸ªä¼˜ç‚¹',
                    resultSrc: './assets/monopoly/destiny4.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        nextDicePlayer()
                    }
                }),
                new DestinyFunction({
                    name: 'å‡ºç‹±è®¸å¯è¯',
                    info: 'è·å¾—å‡ºç‹±è®¸å¯è¯',
                    resultSrc: './assets/monopoly/destiny5.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        player.knapsack.push(this)
                        nextDicePlayer()
                    }
                }),
                new DestinyFunction({
                    info: 'æŠ•ç¨¿ä¸Šæµ·å¤–æ»©å¤œæ™¯ç…§ç‰‡ è·å¾—ä¸–ç•Œæ‘„å½±å¤§èµ›å† å†› å¥–é‡‘1000å…ƒ',
                    award: 1000,
                    resultSrc: './assets/monopoly/destiny6.jpg',
                    resultFunc: moneyResultFunc
                }),
                new DestinyFunction({
                    info: 'èµ°è·¯ç©æ‰‹æœº ä¸å¹¸è¢«æ±½è½¦æ’æ–­è…¿ ä¸‹å›åˆæš‚åœä¸€æ¬¡',
                    resultSrc: './assets/monopoly/destiny7.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        player.pause = true;
                        nextDicePlayer()
                    }
                }),
                new DestinyFunction({
                    info: 'èµ°ç§æ¯’å“ ç«‹åˆ»åç‰¢ è‹¥ç»è¿‡èµ·ç‚¹â€œç”±æ­¤å»â€ ä¸å¾—é¢†å–1000å…ƒ',
                    resultSrc: './assets/monopoly/destiny8.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        goToPrison(player, 1)
                    }
                }),
                new DestinyFunction({
                    info: 'æ­ä¹˜çƒ­æ°”çƒ æ¸¸è§ˆæ¾³æ´²é»„é‡‘æµ·å²¸ å¯é‡æ–°æ·éª°å†ç©ä¸€æ¬¡',
                    resultSrc: './assets/monopoly/destiny9.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                    }
                }),
                new DestinyFunction({
                    info: 'åœ¨å†°å²›çœ‹åŒ—æå…‰ é˜²å¯’è®¾å¤‡ä¸è¶³å†»ä¼¤ å¯æŒ‡å®šä»»ä¸€ç©å®¶ ä¸‹å›åˆæš‚åœä¸€æ¬¡',
                    resultSrc: './assets/monopoly/destiny10.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        this.container.hidden = false;
                        pauseUserSelectOpen()
                    }
                }),
                new DestinyFunction({
                    info: 'å—é‚€å‚åŠ æˆ›çº³ç”µå½±èŠ‚ å¼€å¹•å…¸ç¤¼ èŠ±ç½®è£…è´¹600å…ƒ',
                    award: -600,
                    resultSrc: './assets/monopoly/destiny11.jpg',
                    resultFunc: moneyResultFunc
                }),

                new DestinyFunction({
                    info: 'ä¸å¹¸é­é‡åœ°éœ‡ æˆ¿å±‹å€’å¡Œ ä»˜ä¿®ç¼®è´¹1200å…ƒ',
                    award: -1200,
                    resultSrc: './assets/monopoly/destiny12.jpg',
                    resultFunc: moneyResultFunc
                }),
            ]
            // è§„åˆ™æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            ruleBtn.addEventListener("click", () => {
                gameStart.hidden = true;
                gameRule.hidden = false
            })
            // è§„åˆ™å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            ruleCloseBtn.addEventListener('click', () => {
                gameStart.hidden = false;
                gameRule.hidden = true
            })
            // é€‰æ‹©ç©å®¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            selectPlayers.forEach(player => {
                player.addEventListener('click', function () {
                    if (player.classList.contains('active')) {
                        // å½“äººæ•°å°äºä¸¤ä¸ªä¸ç§»é™¤æ ‡ç­¾
                        if (document.querySelectorAll('.players .player.active').length > 2) {
                            player.classList.remove('active')
                        }
                    }
                    else {
                        player.classList.add('active')
                    }
                })
            })
            // å¼€å§‹æ¸¸æˆç‚¹å‡»äº‹ä»¶
            startBtn.addEventListener("click", () => {
                mapMask.setAttribute('style', 'display:none')
                commentarySeat.setAttribute('style', 'display:flex')
                let selected = document.querySelectorAll('.players .player.active')
                let playerList = commentarySeat.querySelector('.player-list')
                selected.forEach(function (player, index) {
                    let chessPiece = document.createElement('div')
                    let information = document.createElement('div')
                    let color = player.querySelector('.color').textContent;
                    let src = player.querySelector('img').src
                    let money = config.money
                    let isBankruptcy = false
                    chessPiece.classList.add('player')
                    information.classList.add('player')

                    chessPiece.setAttribute('style', `background-image:url(${src});--border-color:${color}`)
                    // æ–°å»ºå¤´åƒ
                    let infoAvatar = document.createElement('img')
                    infoAvatar.setAttribute("src", src)
                    infoAvatar.classList.add('avatar')
                    infoAvatar.setAttribute('style', `--border-color:${color}`)
                    if (dicePlayerIndex === index) infoAvatar.classList.add('active')
                    // æ–°å»ºèµ„é‡‘æ 
                    let fund = document.createElement('div')
                    fund.classList.add('fund')
                    fund.textContent = money
                    // æ–°å»ºç‰©å“æ 
                    let inventory = document.createElement('div')
                    inventory.classList.add('inventory')
                    // æ–°å»ºå·²ç ´äº§
                    let bankruptcy = document.createElement('div')
                    bankruptcy.classList.add('bankruptcy')
                    bankruptcy.textContent = 'å·²ç ´äº§'
                    bankruptcy.hidden = !isBankruptcy

                    information.appendChild(infoAvatar)
                    information.appendChild(fund)
                    information.appendChild(inventory)
                    information.appendChild(bankruptcy)
                    playerList.appendChild(information)
                    // ç©å®¶æ£‹å­åˆå§‹ä½ç½®
                    mapElementList[0].appendChild(chessPiece)
                    // ç©å®¶ä¿¡æ¯
                    const playerInfo = {
                        avater: src,
                        name: player.querySelector('.name').textContent,
                        color,
                        moveScore: 0,
                        pause: false,
                        money,
                        knapsack: null,
                        isBankruptcy,
                        information,
                        fund,
                        chessPiece,
                        inventory,
                        bankruptcy,
                    }
                    playerInfo.knapsack = new Knapsack(playerInfo)
                    // ç»‘å®šé‡‘é’±
                    Object.defineProperty(playerInfo, 'money', {
                        get() {
                            return money
                        },
                        set(val) {
                            money = val
                            fund.textContent = money
                        }
                    })
                    // ç»‘å®šæ˜¯å¦ç ´äº§
                    Object.defineProperty(playerInfo, 'isBankruptcy', {
                        get() {
                            return isBankruptcy
                        },
                        set(val) {
                            isBankruptcy = val
                            bankruptcy.hidden = !val
                        }
                    })

                    playerInfoList.push(playerInfo)
                })

                log('æ¸¸æˆå¼€å§‹')
                log(`è¯·ç©å®¶${playerInfoList[dicePlayerIndex].name}å¼€å§‹æ·è‰²å­`)
            })
            // ğŸ²
            dice.addEventListener('click', diceClick)
            // é‡æ–°å¼€å§‹
            document.querySelector('.game-over-container .reset-btn').addEventListener('click', () => {
                location.reload()
            })

            // é“¶è¡Œ
            let bankContainer = document.querySelector('.bank-container')
            let mortgageCancelBtn = bankContainer.querySelector('.cancel-btn')

            // å–æ¶ˆ
            mortgageCancelBtn.addEventListener('click', () => {
                bankContainer.hidden = true;
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                landConfiscate(currentPlayer)
                nextDicePlayer()
            })

            log('æ¸¸æˆåˆå§‹åŒ–å®Œæˆ')
        }

        // ç©å®¶ç§»åŠ¨
        async function moving(player, score) {
            let current = player.moveScore % mapElementList.length
            let wait = () => new Promise((resolve) => {
                setTimeout(resolve, 100)
            })
            for (let i = 0; i < score; i++) {
                await wait();
                player.moveScore++;
                let target = player.moveScore % mapElementList.length
                mapElementList[target].appendChild(player.chessPiece)
                let funcName = i === score - 1 ? 'stop' : 'pass';
                mapFunctionList[target][funcName](player, score)
            }
        }

        // éª°å­ğŸ²
        async function diceClick() {
            if (diceTurn) return;
            diceTurn = true
            let target = Randoms.getRandomInt(1, 7);
            let length = target // 18 + target;
            let diceChildren = dice.children
            let wait = () => new Promise((resolve) => {
                setTimeout(resolve, 100)
            })
            for (let i = 0; i < length; i++) {
                await wait();
                dice.querySelector('img:not([hidden])').hidden = true
                diceChildren.item(i % 6).hidden = false
            }
            let playerInfo = playerInfoList[dicePlayerIndex % playerInfoList.length]
            log(`ç©å®¶${playerInfo.name}æ·è‰²å­æ•°ä¸º${target}`)
            await moving(playerInfo, target)
            diceTurn = false
        }

        // ä¸‹ä¸€ä¸ªæ‘‡éª°å­äºº
        function nextDicePlayer() {
            checkGameOver();
            // å¤„ç†å½“å‰äºº
            let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
            if (currentPlayer.money < 0 && !currentPlayer.isBankruptcy) {
                startMortgage(currentPlayer)
                return
            }
            dicePlayerIndex++;
            let nextPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
            if (nextPlayer.pause) {
                nextPlayer.pause = false;
                return nextDicePlayer()
            }
            // ç ´äº§
            if (nextPlayer.isBankruptcy) {
                return nextDicePlayer()
            }
            commentarySeat.querySelector('.player-list .avatar.active').classList.remove('active')
            nextPlayer.information.querySelector('.avatar').classList.add('active')
            log(`è¯·ç©å®¶${nextPlayer.name}å¼€å§‹æ·è‰²å­`)
        }

        // æ‰“å°æ—¥å¿—
        function log(str) {
            let element = document.createElement('div')
            element.textContent = str
            logList.appendChild(element)
            logList.scrollTo({ top: 100000000 })
        }

        // å¼€å§‹æŠµæŠ¼
        function startMortgage(player) {
            console.log(player);
            // åœŸåœ°å¯æŠµæŠ¼åˆ—è¡¨
            let bankContainer = document.querySelector('.bank-container')
            bankContainer.hidden = false;
            let landList = bankContainer.querySelector('.land-list')
            landList.innerHTML = ``
            let playerLandList = mapFunctionList.filter(map => map instanceof MapLandFunction && map.holder === player);
            let landMonery = playerLandList.filter(map => !map.mortgaged).reduce((total, map) => {
                let levelMoney = map.level * map.upgrade
                let totalMoney = map.money + (isNaN(levelMoney) ? 0 : levelMoney)
                total += totalMoney;
                return total;
            }, 0)
            // ç ´äº§
            if (player.money + landMonery < 0) {
                player.isBankruptcy = true;
                bankContainer.hidden = true;
                landConfiscate(player)
                nextDicePlayer()
            }
            else {
                playerLandList.forEach(map => {
                    let landItem = document.createElement('div')
                    let levelMoney = map.level * map.upgrade
                    let totalMoney = map.money + (isNaN(levelMoney) ? 0 : levelMoney)
                    landItem.innerHTML = `
                            <div class="info">
                                <div class="name">${map.name}</div>
                                <div class="money">${totalMoney}å…ƒ</div>
                            </div>
                            <div class="mortgage-btn" ${map.mortgaged ? "hidden" : ""}>æŠµæŠ¼</div>
                            <div class="mortgaged" ${!map.mortgaged ? "hidden" : ""}>å·²æŠµæŠ¼</div>
                        `
                    landItem.classList.add('land-item')
                    let mortgageBtn = landItem.querySelector('.mortgage-btn')
                    let mortgaged = landItem.querySelector('.mortgaged')
                    mortgageBtn.onclick = function () {
                        map.mortgaged = true;
                        mortgageBtn.hidden = true;
                        mortgaged.hidden = false;
                        console.log(player);
                        player.money += totalMoney

                        if (player.money >= 0) {
                            bankContainer.hidden = true;
                            nextDicePlayer()
                        }
                    }
                    landList.appendChild(landItem)
                })
            }
        }

        // åœŸåœ°å……å…¬
        function landConfiscate(player) {
            mapFunctionList.forEach(map => {
                if (map instanceof MapLandFunction && map.holder === player) {
                    map.mortgaged = false;
                    map.level = 0;
                    map.holder = null;
                }
            })
        }

        // æ£€æŸ¥
        function checkGameOver() {
            let survivors = playerInfoList.filter(player => player.isBankruptcy === false)
            if (survivors.length === 1) {
                let gameOver = document.querySelector('.game-over-container')
                gameOver.hidden = false;
                gameOver.querySelector('.h1').textContent = `æ­å–œ${survivors[0].name}è·å¾—äº†æ¸¸æˆçš„èƒœåˆ©âœŒ`
            }
        }
        // æ‰§è¡Œåˆå§‹åŒ–
        init();
    </script>
</body>

</html>