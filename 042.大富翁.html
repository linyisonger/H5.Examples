<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/global.css">
    <link rel="stylesheet" href="./assets/fontawesome/css/all.min.css">

    <style>
        .map-container {
            background-image: url('./assets/monopoly/map.jpg');
            width: 1225px;
            height: 837px;
            position: relative;
        }

        .map-element {
            position: absolute;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .map-element .player {
            width: 36px;
            height: 36px;
            margin-right: 5px;
            border-radius: 50%;
            background-repeat: no-repeat;
            background-size: contain;
            border: 4px solid var(--border-color);
        }

        .map-element .corona {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            pointer-events: none;
            border: 4px solid var(--border-color);
        }

        .map-element .corona i {
            opacity: 0;
            padding: 5px;
        }

        .map-element .corona[level='1'] i:first-child {
            opacity: 1;
            color: green;
        }

        .map-element .corona[level='2'] i {
            opacity: 1;
            color: green;
        }

        .map-element .corona[level='3'] i:first-child {
            opacity: 1;
            color: red;
        }

        .map-mask,
        .commentary-seat {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, .8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .map-mask .game-start .players {
            display: flex;
        }

        .map-mask .game-start .player {
            margin-left: 20px;
            text-align: center;
            padding: 20px;
            background: #fff;
            user-select: none;
        }

        .map-mask .game-start .player.active {
            background: #caf09f;
        }

        .map-mask .game-start .player img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            pointer-events: none;
        }

        .game-start .btns {
            display: flex;
        }

        .game-start .start-btn,
        .game-start .rule-btn {
            padding: 10px 20px;
            margin: 20px auto;
            background-color: #70d1cc;
            user-select: none;
        }

        [class$='-btn']:active {
            opacity: .7;
        }

        .game-rule {
            position: relative;
        }

        .game-rule .fa-times {
            position: absolute;
            right: 0;
            width: 100px;
            height: 100px;
            font-size: 30px;
            color: #f57373;
            text-align: center;
            line-height: 100px;
        }

        .commentary-seat {
            display: none;
            left: 171px;
            top: 171px;
            right: 171px;
            bottom: 171px;
            justify-content: start;
            align-items: start;
        }

        .commentary-seat .player-list {
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            padding-left: 20px;
        }

        .commentary-seat .player-list .player {
            display: flex;
            margin-bottom: 20px;
            position: relative;
        }

        .commentary-seat .player .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .commentary-seat .player .fund {
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            color: black;
            text-shadow: 2px 2px gold;
        }

        .commentary-seat .inventory {
            display: flex;
            align-items: center;
        }

        .commentary-seat .player .bankruptcy {
            position: absolute;
            left: 0;
            top: 0;
            background-color: rgba(59, 59, 59, 0.5);
            border-radius: 50%;
            height: 100%;
            width: 50px;
            color: #f24;
            text-align: center;
            line-height: 50px;
            font-size: 14px;
            font-weight: bold;
            transform: rotate(30deg);
        }

        .commentary-seat .player .card {
            margin-left: 10px;
            background: var(--bg-color);
            padding: 5px 5px;
            border: 1px solid #ddd;
        }

        .commentary-seat .player .avatar.active {
            border: 4px solid var(--border-color);
            box-sizing: border-box;
        }

        .commentary-seat .dice {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .commentary-seat .dice img {
            pointer-events: none;
        }

        .commentary-seat .log-list {
            position: absolute;
            left: 0;
            bottom: 0;
            max-height: 180px;
            width: 300px;
            padding-left: 20px;
            padding-bottom: 20px;
            overflow-y: auto;
        }

        .chance-container,
        .destiny-container,
        .business-container,
        .destiny-select,
        .pause-user-select {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, .8);
        }

        .chance-container .result,
        .destiny-container .result {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .chance-container .loading,
        .destiny-container .loading {
            width: 100%;
            height: 100%;
            transform: rotateY(0deg);
            animation-name: rotating;
            animation-duration: 1s;
            animation-iteration-count: infinite;
        }

        .pause-user-select {
            padding: 100px 0;
            text-align: center;
            vertical-align: middle;
        }

        .pause-user-select .select-btn {
            display: inline-block;
            width: 120px;
            height: 120px;
            border: 2px solid #ddd;
            margin-right: 20px;
            user-select: none;
        }

        .pause-user-select .select-btn:active {
            background-color: #caf09f;
        }

        .pause-user-select .select-btn img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding-top: 20px;
        }

        .chance-container img,
        .destiny-container img {
            position: absolute;
            left: 50%;
            top: 50%;
            height: 442px;
            width: 248px;
            transform: translate(-50%, -50%) rotate(90deg);
        }

        .destiny-select .select-btn:first-child {
            position: absolute;
            left: 30%;
            top: 50%;
            height: 100%;
        }

        .destiny-select .select-btn:last-child {
            position: absolute;
            left: 70%;
            top: 50%;
            height: 100%;
        }

        .destiny-select img {
            height: 221px;
            width: 124px;
            transform: translate(-50%, -50%) rotate(90deg);
        }

        .chance-container .result-close-btn,
        .destiny-container .result-close-btn {
            width: 40px;
            height: 40px;
            position: absolute;
            left: 50%;
            top: 400px;
            background: #f24;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #fff;
        }

        .business-container {
            white-space: nowrap;
            display: flex;
            width: 100%;
        }

        .business-container .info,
        .business-container .operate {
            display: flex;
        }

        .business-container .info {
            padding: 20px;
            margin-left: 300px;
        }

        .business-container .operate {
            flex-direction: column;
            padding-top: 100px;
            flex: 1;
        }

        .business-container .operate .h2 {
            font-size: 28px;
            font-weight: bold;
            color: #555;
            text-align: center;
        }

        .business-container .info img {
            width: 250px;
            height: 426px;
        }

        .business-container .buy-land-btn,
        .business-container .buy-house-btn,
        .business-container .buy-hotel-btn,
        .business-container .free-buy-house-btn,
        .business-container .pass-btn {
            padding: 10px 20px;
            background-color: #44a0c4;
            width: 200px;
            margin: 20px auto 0;
        }

        .pass-btn {
            background-color: #949494;
        }


        @keyframes rotating {
            0% {
                transform: rotateY(0deg);

            }

            50% {
                transform: rotateY(180deg);
            }

            100% {
                transform: rotateY(0deg);

            }
        }
    </style>
</head>

<body>
    <div class="map-container">
        <div class="map-mask">
            <div class="game-start">
                <div class="players select">
                    <div class="player active">
                        <img src="./assets/monopoly/black.jpg" alt="Â∞èÈªë">
                        <div class="name">Â∞èÈªë</div>
                        <div class="color" hidden>black</div>
                    </div>
                    <div class="player active">
                        <img src="./assets/monopoly/red.jpg" alt="Â∞èÁ∫¢">
                        <div class="name">Â∞èÁ∫¢</div>
                        <div class="color" hidden>red</div>
                    </div>
                    <div class="player active">
                        <img src="./assets/monopoly/yellow.jpg" alt="Â∞èÈªÑ">
                        <div class="name">Â∞èÈªÑ</div>
                        <div class="color" hidden>yellow</div>
                    </div>
                    <div class="player active">
                        <img src="./assets/monopoly/blue.jpg" alt="Â∞èËìù">
                        <div class="name">Â∞èËìù</div>
                        <div class="color" hidden>blue</div>
                    </div>
                </div>
                <div class="btns">
                    <div class="start-btn">ÂºÄÂßãÊ∏∏Êàè</div>
                    <div class="rule-btn">ËßÑÂàôÊü•Áúã</div>
                </div>
            </div>
            <div class="game-rule" hidden>
                <img src="./assets/monopoly/rule.jpg" alt="Ê∏∏ÊàèËßÑÂàô">
                <i class="fas fa-times rule-close-btn"></i>
            </div>
        </div>
        <div class="commentary-seat">
            <div class="player-list"> </div>
            <div class="dice">
                <img src="./assets/monopoly/1.png" alt="1">
                <img src="./assets/monopoly/2.png" alt="2" hidden>
                <img src="./assets/monopoly/3.png" alt="3" hidden>
                <img src="./assets/monopoly/4.png" alt="4" hidden>
                <img src="./assets/monopoly/5.png" alt="5" hidden>
                <img src="./assets/monopoly/6.png" alt="6" hidden>
            </div>
            <div class="log-list"></div>
            <div class="chance-container" hidden>
                <div class="loading">
                    <img src="./assets/monopoly/chance.jpg">
                </div>
                <div class="result" hidden>
                    <img src="./assets/monopoly/chance.jpg">
                    <div class="result-close-btn">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </div>
            <div class="destiny-container" hidden>
                <div class="loading">
                    <img src="./assets/monopoly/destiny.jpg">
                </div>
                <div class="result" hidden>
                    <img src="./assets/monopoly/destiny.jpg">
                    <div class="result-close-btn">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </div>
            <div class="business-container" style="display: none;">
                <div class="info">
                    <img src="./assets/monopoly/land1.jpg" alt="Âú∞‰∫ß">
                </div>
                <div class="operate">
                    <div class="h2">ËØ∑ÈÄâÊã©ÊÇ®ÁöÑÊìç‰Ωú</div>
                    <div class="buy-land-btn">Ë¥≠‰π∞ÂúüÂú∞</div>
                    <div class="buy-house-btn">Ë¥≠‰π∞ÊàøÂ≠ê</div>
                    <div class="free-buy-house-btn">ÂÖçË¥πÂçáÁ∫ß</div>
                    <div class="pass-btn">Ë∑ØËøá</div>
                </div>
            </div>
            <div class="destiny-select" hidden>
                <div class="select-btn chance">
                    <img src="./assets/monopoly/chance.jpg">
                </div>
                <div class="select-btn destiny">
                    <img src="./assets/monopoly/destiny.jpg">
                </div>
            </div>
            <div class="pause-user-select" hidden></div>

            <!-- <div class="bank-container">
            </div> -->
        </div>
    </div>

    <script type="module">
        // ÈªòËÆ§Âú∞Âõæ‰∫ã‰ª∂
        class MapFunction {
            constructor({
                pass,
                stop
            } = {}) {
                this.pass = pass ?? function (player, score) {
                    console.log('ÁªèËøá', player, score);
                }
                this.stop = stop ?? function (player, score) {
                    console.log('ÂÅúÁïô', player, score);
                }
            }
        }
        // Âú∞ÂõæÂúüÂú∞‰∫ã‰ª∂
        class MapLandFunction extends MapFunction {
            constructor({
                id,
                landSrc,
                pass,
                stop,
                toll,
                money,
                holder,
                upgrade,
                level,
                maxLevel,
                name
            } = {}) {
                super({ pass, stop });
                this.landSrc = landSrc ?? ''
                this.toll = toll
                this.money = money
                this.holder = holder
                this.upgrade = upgrade
                this.level = level
                this.maxLevel = maxLevel
                this.name = name
                this.id = id

                let corona = document.createElement('div')
                corona.classList.add('corona')
                Object.defineProperty(this, 'holder', {
                    get() {
                        return holder
                    },
                    set(val) {
                        log(`Áé©ÂÆ∂${val.name} Ë¥≠‰π∞‰∫Ü${name}ÁöÑÂúüÂú∞‰ΩøÁî®ÊùÉ Ëä±Ë¥π${money}ÂÖÉ`)
                        corona.setAttribute('style', `--border-color:${val.color}`)
                        for (let i = 0; i < 2; i++) {
                            let house = document.createElement('i')
                            house.classList.add('fas', 'fa-home')
                            corona.appendChild(house)
                        }
                        mapElementList[id].appendChild(corona)
                        holder = val
                    }
                })

                Object.defineProperty(this, 'level', {
                    get() {
                        return level
                    },
                    set(val) {
                        log(`Áé©ÂÆ∂${holder.name} Âú®${name}ÂúüÂú∞ÂçáÁ∫ß‰∫ÜÊàøÂ±ã`)
                        // ‰ø©Áªø ‰∏ÄÁ∫¢
                        corona.setAttribute('level', val)
                        level = val
                    }
                })

            }
        }
        // Êú∫‰ºö‰∫ã‰ª∂
        class ChanceFunction {
            constructor({
                name,
                /** ‰ø°ÊÅØ */
                info,
                /** Â•ñÁΩö */
                award,
                /** ÁªìÊûúÂõæ */
                resultSrc,
                /** ÁªìÊûú‰∫ã‰ª∂ */
                resultFunc,
                /** ÂÖ≥Èó≠‰∫ã‰ª∂ */
                closeFunc
            } = {}) {
                this.name = name ?? ''
                this.info = info ?? ''
                this.award = award ?? ''
                this.resultSrc = resultSrc ?? ''
                this.resultFunc = resultFunc ?? function () { }
                this.closeFunc = closeFunc ?? function () { }
                this.container = document.querySelector('.chance-container');
                this.loading = this.container.querySelector('.loading')
                this.result = this.container.querySelector('.result')
                this.closeBtn = this.result.querySelector('.result-close-btn')
                this.closeBtn.addEventListener('click', () => {
                    this.container.hidden = true;
                    this.closeFunc()
                })
                let that = this;
                this.run = function (player) {
                    this.container.hidden = false;
                    this.result.hidden = true;
                    setTimeout(() => {
                        this.resultFunc.bind(that, player)()
                        this.result.querySelector('img').src = this.resultSrc
                        this.result.hidden = false;
                    }, 1500)
                }
            }

        }
        // ÂëΩËøê‰∫ã‰ª∂
        class DestinyFunction {
            constructor({
                name,
                /** ‰ø°ÊÅØ */
                info,
                /** Â•ñÁΩö */
                award,
                /** ÁªìÊûúÂõæ */
                resultSrc,
                /** ÁªìÊûú‰∫ã‰ª∂ */
                resultFunc,
                /** ÂÖ≥Èó≠‰∫ã‰ª∂ */
                closeFunc
            } = {}) {
                this.name = name ?? ''
                this.info = info ?? ''
                this.award = award ?? ''
                this.resultSrc = resultSrc ?? ''
                this.resultFunc = resultFunc ?? function () { }
                this.closeFunc = closeFunc ?? function () { }
                this.container = document.querySelector('.destiny-container');
                this.loading = this.container.querySelector('.loading')
                this.result = this.container.querySelector('.result')
                this.closeBtn = this.result.querySelector('.result-close-btn')
                this.closeBtn.addEventListener('click', () => {
                    this.container.hidden = true;
                    this.closeFunc()
                })
                let that = this;
                this.run = function (player) {
                    this.container.hidden = false;
                    this.result.hidden = true;
                    setTimeout(() => {
                        this.resultFunc.bind(that, player)()
                        this.result.querySelector('img').src = this.resultSrc
                        this.result.hidden = false;
                    }, 1500)
                }
            }
        }
        // Áé©ÂÆ∂ËÉåÂåÖ
        class Knapsack extends Array {
            constructor(player) {
                super()
                this.player = player
            }
            push(...items) {
                super.push(...items)
                this.render(...items)
            }
            splice(start, deleteCount, ...items) {
                let inventory = this.player.inventory
                let deleteList = this.slice(start - 1, start + deleteCount);
                for (let i = 0; i < deleteList.length; i++) {
                    const element = deleteList[i];
                    inventory.querySelector(`.card[alt=${element.name}]`).remove()
                }
                super.splice(start, deleteCount, ...items)
                this.render(...items)
            }
            render(...items) {
                let inventory = this.player.inventory
                for (let i = 0; i < items.length; i++) {
                    const name = items[i].name;
                    let card = document.createElement('div')
                    card.classList.add('card')
                    card.textContent = name[0]
                    card.setAttribute('alt', name)
                    switch (name) {
                        case "Âá∫Áã±ËÆ∏ÂèØËØÅ":
                            card.setAttribute('style', `--bg-color:rgb(242,199,6)`)
                            break;
                        case "ÂÖçË¥πÂçáÁ∫ßÂç°":
                            card.setAttribute('style', `--bg-color:rgb(206,54,43)`)
                            break;
                    }
                    inventory.appendChild(card)
                }
            }
        }
        // ‰∏âÊñπÂ∫ì  ‰ªÖ‰ΩøÁî®ÈöèÊú∫Ê®°Âùó
        import { Randoms } from "https://unpkg.com/@3r/tool/lib/randoms";

        // ÈÖçÁΩÆ
        const config = {
            // ÂàùÂßãËµÑÈáë
            money: 5000 // (5000 + 2000 + 1000 + 500 + 200 + 100) * 2
        }



        // Âú∞ÂõæÂÆπÂô®
        let mapContainer = document.querySelector('.map-container')
        // Âú∞ÂõæÈÅÆÁΩ©
        let mapMask = document.querySelector('.map-mask')
        // ÂºÄÂßãÊ∏∏Êàè
        let gameStart = document.querySelector('.game-start')
        // ËßÇ‰ºóÂ∏≠
        let commentarySeat = document.querySelector('.commentary-seat')
        // Ê∏∏ÊàèËßÑÂàô
        let gameRule = document.querySelector('.game-rule')
        // ËßÑÂàôÊåâÈíÆ
        let ruleBtn = document.querySelector('.rule-btn')
        // ÂºÄÂßãÊåâÈíÆ
        let startBtn = document.querySelector('.start-btn')
        // ËßÑÂàôÂÖ≥Èó≠ÊåâÈíÆ
        let ruleCloseBtn = document.querySelector('.rule-close-btn')
        // ÂºÄÂßãÊ∏∏ÊàèÂâçÈÄâÊã©Áé©ÂÆ∂
        let selectPlayers = document.querySelectorAll('.players.select .player')
        // üé≤
        let dice = commentarySeat.querySelector('.dice')
        // Êó•Âøó
        let logList = commentarySeat.querySelector('.log-list')

        // Áé©ÂÆ∂‰ø°ÊÅØÂàóË°®
        let playerInfoList = []
        // Âú∞ÂõæÂÖÉÁ¥†ÂàóË°®
        let mapElementList = []
        // Âú∞ÂõæÊñπÊ≥ïÂàóË°®
        let mapFunctionList = []
        // Êú∫‰ºö‰∫ã‰ª∂ÂàóË°®
        let chanceFunctionList = []
        // ÂëΩËøê‰∫ã‰ª∂ÂàóË°®
        let destinyFunctionList = []
        // üé≤ÊòØÂê¶ËΩ¨Âä®‰∏≠
        let diceTurn = false;
        // üôã‚ÄçÂì™‰ΩçÁé©ÂÆ∂Êìç‰Ωú
        let dicePlayerIndex = 0

        // ÂàùÂßãÂåñ
        function init() {
            // Ê†áËÆ∞Âú∞ÂõæÂÖÉÁ¥†‰ø°ÊÅØÂàóË°®
            let mapElementInfoList = [
                {
                    top: '667px',
                    left: '1056px',
                    width: '169px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '945px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '834px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '723px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '612px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '501px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '390px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '279px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '168px',
                    width: '109px',
                    height: '167px',
                },
                {
                    top: '667px',
                    left: '0',
                    width: '166px',
                    height: '167px',
                },
                {
                    top: '568px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '469px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '370px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '272px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '173px',
                    left: '0',
                    width: '168px',
                    height: '96px'
                },
                {
                    top: '0px',
                    left: '0',
                    width: '171px',
                    height: '171px',
                },
                {
                    top: '7px',
                    left: '173px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '284px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '394px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '505px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '615px',
                    width: '105px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '723px',
                    width: '107px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '832px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '7px',
                    left: '943px',
                    width: '109px',
                    height: '166px',
                },
                {
                    top: '6px',
                    left: '1054px',
                    width: '170px',
                    height: '166px',
                },
                {
                    top: '175px',
                    left: '1054px',
                    width: '170px',
                    height: '98px',
                },
                {
                    top: '275px',
                    left: '1054px',
                    width: '170px',
                    height: '93px',
                },
                {
                    top: '370px',
                    left: '1054px',
                    width: '170px',
                    height: '98px',
                },
                {
                    top: '470px',
                    left: '1054px',
                    width: '170px',
                    height: '95px',
                },
                {
                    top: '567px',
                    left: '1054px',
                    width: '170px',
                    height: '98px',
                },
            ]
            for (let i = 0; i < mapElementInfoList.length; i++) {
                const info = mapElementInfoList[i]
                const element = document.createElement('div')
                element.setAttribute('style', `top:${info.top};left:${info.left};width:${info.width};height:${info.height}`)
                element.classList.add('map-element')
                // ÂÇ®Â≠òÂàóË°®‰∏≠
                mapElementList.push(element)
                // Â°ûÂÖ•È°µÈù¢Ê∏≤Êüì
                mapContainer.appendChild(element)

            }


            // ‰∫§ÊòìÂÆπÂô®
            let businessContainer = document.querySelector('.business-container');

            // ‰∫§ÊòìÈ°µÈù¢Ë∑ØËøáÊìç‰Ωú
            let businessContainerPassBtn = businessContainer.querySelector('.pass-btn');
            businessContainerPassBtn.addEventListener("click", () => {
                businessContainer.setAttribute('style', 'display:none')
                nextDicePlayer()
            })

            // ÂΩìÂâç‰∫§ÊòìÁöÑÂú∞ÁöÆ
            let currentBusinessLand = null
            // Ë¥≠‰π∞Âú∞ÁöÆ
            let businessContainerBuyLandBtn = businessContainer.querySelector('.buy-land-btn');
            businessContainerBuyLandBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                if (currentPlayer.money < currentBusinessLand.money) {
                    alert('‰ΩôÈ¢ù‰∏çË∂≥Êó†Ê≥ïË¥≠‰π∞')
                }
                else {
                    currentPlayer.money -= currentBusinessLand.money;
                    currentBusinessLand.holder = currentPlayer;
                    businessContainer.setAttribute('style', 'display:none')
                    nextDicePlayer()
                }
            })
            // ‰π∞üè†
            let businessContainerBuyHouseBtn = businessContainer.querySelector('.buy-house-btn');
            businessContainerBuyHouseBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                if (currentPlayer.money < currentBusinessLand.money) {
                    alert('‰ΩôÈ¢ù‰∏çË∂≥Êó†Ê≥ïÂçáÁ∫ß')
                }
                else {
                    currentPlayer.money -= currentBusinessLand.upgrade;
                    currentBusinessLand.level++;
                    businessContainer.setAttribute('style', 'display:none')
                    nextDicePlayer()
                }
            })
            // 0ÂÖÉË¥≠üè†
            let businessContainerFreeBuyHouseBtn = businessContainer.querySelector('.free-buy-house-btn')
            businessContainerFreeBuyHouseBtn.addEventListener('click', () => {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                let idx = currentPlayer.knapsack.findIndex(item => item.name === 'ÂÖçË¥πÂçáÁ∫ßÂç°')
                currentPlayer.knapsack.splice(idx, 1)
                currentBusinessLand.level++;
                businessContainer.setAttribute('style', 'display:none')
                nextDicePlayer()
            })
            // Âú®ÂõΩÂÆ∂Ê≠¢Ê≠•
            let countryStop = function (player, score) {
                let img = businessContainer.querySelector('.info img')
                img.src = this.landSrc;
                businessContainerBuyLandBtn.hidden = true;
                businessContainerBuyHouseBtn.hidden = true;
                businessContainerFreeBuyHouseBtn.hidden = true;
                if (!this.holder || this.holder === player) {
                    currentBusinessLand = this;
                    if (this.level === 3) {
                        nextDicePlayer()
                    }
                    else if (this.holder === player) {
                        let upgradeText = this.level === 2 ? 'ÂçáÁ∫ßÊóÖÈ¶Ü' : 'Ë¥≠‰π∞ÊàøÂ±ã'
                        let idx = player.knapsack.findIndex(item => item.name === 'ÂÖçË¥πÂçáÁ∫ßÂç°')
                        if (idx > -1) {
                            console.log(idx);
                            businessContainerFreeBuyHouseBtn.hidden = false;
                        }
                        log(`Áé©ÂÆ∂${player.name} Âú®${this.name}ÂúüÂú∞${upgradeText}`)
                        businessContainerBuyHouseBtn.textContent = `${upgradeText}(${this.upgrade}ÂÖÉ)`
                        businessContainerBuyHouseBtn.hidden = false;
                    }
                    else {
                        businessContainerBuyLandBtn.textContent = `Ë¥≠‰π∞ÂúüÂú∞(${this.money}ÂÖÉ)`
                        businessContainerBuyLandBtn.hidden = false;
                    }
                    if (this.level < 3) businessContainer.setAttribute('style', 'display:flex')
                }
                else {
                    let toll = this.toll[this.level]
                    player.money -= toll;
                    this.holder.money += toll
                    log(`Áé©ÂÆ∂${player.name}ÂÅúÁïô${this.name} ÁªôÁé©ÂÆ∂${this.holder.name} ÊîØ‰ªòËøáË∑ØË¥π${toll}ÂÖÉ`)
                    nextDicePlayer()
                }
            }
            // Âú®Ê∞¥ÁîµÂéÇÊ≠¢Ê≠•
            let hydropowerStop = function (player, score) {
                let img = businessContainer.querySelector('.info img')
                img.src = this.landSrc;
                businessContainerBuyLandBtn.hidden = true;
                businessContainerBuyHouseBtn.hidden = true;
                businessContainerFreeBuyHouseBtn.hidden = true;
                if (!this.holder) {
                    currentBusinessLand = this;
                    businessContainerBuyLandBtn.textContent = `Ë¥≠‰π∞ÂúüÂú∞(${this.money}ÂÖÉ)`
                    businessContainerBuyLandBtn.hidden = false;
                    businessContainer.setAttribute('style', 'display:flex')
                }
                else if (this.holder === player) {
                    nextDicePlayer()
                }
                else {
                    let level = mapFunctionList[5].holder === mapFunctionList[28].holder ? 1 : 0
                    let toll = this.toll[level] * score
                    player.money -= toll;
                    this.holder.money += toll
                    log(`Áé©ÂÆ∂${player.name}ÂÅúÁïô${this.name} ÁªôÁé©ÂÆ∂${this.holder.name} ÊîØ‰ªòËøáË∑ØË¥π${toll}ÂÖÉ`)
                    nextDicePlayer()
                }
            }
            // Âú®Êú∫Âú∫Ê≠¢Ê≠•
            let airfieldStop = function (player, score) {
                let img = businessContainer.querySelector('.info img')
                img.src = this.landSrc;
                businessContainerBuyLandBtn.hidden = true;
                businessContainerBuyHouseBtn.hidden = true;
                businessContainerFreeBuyHouseBtn.hidden = true;
                if (!this.holder) {
                    currentBusinessLand = this;
                    businessContainerBuyLandBtn.textContent = `Ë¥≠‰π∞ÂúüÂú∞(${this.money}ÂÖÉ)`
                    businessContainerBuyLandBtn.hidden = false;
                    businessContainer.setAttribute('style', 'display:flex')
                }
                else if (this.holder === player) {
                    nextDicePlayer()
                }
                else {
                    let level = mapFunctionList[7].holder === mapFunctionList[21].holder ? 1 : 0
                    let toll = this.toll[level]
                    player.money -= toll;
                    this.holder.money += toll
                    log(`Áé©ÂÆ∂${player.name}ÂÅúÁïô${this.name} ÁªôÁé©ÂÆ∂${this.holder.name} ÊîØ‰ªòËøáË∑ØË¥π${toll}ÂÖÉ`)
                    nextDicePlayer()
                }
            }
            // üëÆ‚Äç‚ôÄÔ∏èÊ¨¢ËøéÂõûÂÆ∂~
            let goToPrison = function (player, score) {
                log(`Áé©ÂÆ∂${player.name}ÂÖ•Áã± ÊöÇÂÅú‰∏ÄÂõûÂêà`)
                player.moveScore += (mapElementList.length - player.moveScore % mapElementList.length + 9)
                let idx = player.knapsack.findIndex(item => item.name === 'Âá∫Áã±ËÆ∏ÂèØËØÅ');
                if (idx > -1) {
                    log(`Áé©ÂÆ∂${player.name} ‰ΩøÁî®Âá∫Áã±ËÆ∏ÂèØËØÅ Êó†ÈúÄÊöÇÂÅú`)
                    player.knapsack.splice(idx, 1)
                }
                else player.pause = true;
                let target = player.moveScore % mapElementList.length
                mapElementList[target].appendChild(player.chessPiece)
                mapFunctionList[target]['stop'](player, score)
            }
            // Êú∫‰ºöÂú∞Âõæ‰∫ã‰ª∂
            let chanceMapFunction = new MapFunction({
                stop: (player, score) => {
                    let target = 10 //Randoms.getRandomInt(0, chanceFunctionList.length)
                    chanceFunctionList[target].run(player)
                }
            })
            // ÂëΩËøêÂú∞Âõæ‰∫ã‰ª∂
            let destinyMapFunction = new MapFunction({
                stop: (player, score) => {
                    let target = Randoms.getRandomInt(0, destinyFunctionList.length)
                    destinyFunctionList[target].run(player)
                }
            })
            // Âú∞Âõæ‰∫ã‰ª∂ÂàóË°®
            mapFunctionList = [
                new MapFunction({
                    pass: (player, score) => {
                        log(`Áé©ÂÆ∂${player.name}ÁªèËøáËµ∑ÁÇπ Â•ñÂä±1000ÂÖÉ`)
                        player.money += 1000;
                    },
                    stop: nextDicePlayer
                }),
                new MapLandFunction({
                    id: 1,
                    name: '‰∏≠ÂõΩ',
                    money: 4000,
                    landSrc: './assets/monopoly/land4.jpg',
                    holder: null,
                    level: 0,
                    toll: [500, 2000, 5500, 11500],
                    upgrade: 2000,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 2,
                    name: 'Ê≥∞ÂõΩ',
                    money: 1000,
                    landSrc: './assets/monopoly/land16.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300, 900, 2000],
                    upgrade: 500,
                    stop: countryStop
                }),
                chanceMapFunction,
                new MapLandFunction({
                    id: 4,
                    name: 'Âç∞Â∞º',
                    money: 1600,
                    landSrc: './assets/monopoly/land7.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 600, 1800, 5000],
                    upgrade: 1000,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 5,
                    name: 'Ëá™Êù•Ê∞¥ÂéÇ',
                    money: 1200,
                    landSrc: './assets/monopoly/land14.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300],
                    stop: hydropowerStop
                }),
                destinyMapFunction,
                new MapLandFunction({
                    id: 7,
                    name: '‰∏äÊµ∑Êµ¶‰∏úÂõΩÈôÖÊú∫Âú∫',
                    money: 2000,
                    landSrc: './assets/monopoly/land18.jpg',
                    holder: null,
                    level: 0,
                    toll: [3000, 5000],
                    stop: airfieldStop
                }),
                new MapLandFunction({
                    id: 8,
                    name: 'Êó•Êú¨',
                    money: 2000,
                    landSrc: './assets/monopoly/land13.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 800, 2200, 6000],
                    upgrade: 1000,
                    stop: countryStop
                }),
                new MapFunction({
                    stop: nextDicePlayer
                }),
                new MapLandFunction({
                    id: 10,
                    name: 'Ë•øÁè≠Áâô',
                    money: 2200,
                    landSrc: './assets/monopoly/land10.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 900, 2500, 7000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                chanceMapFunction,
                new MapLandFunction({
                    id: 12,
                    name: 'Â∑¥Ë•ø',
                    money: 2400,
                    landSrc: './assets/monopoly/land12.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 1000, 3000, 7500],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapFunction({
                    stop: (player, score) => {
                        log(`Áé©ÂÆ∂${player.name}ÈúÄË¶ÅÁº¥Á∫≥700ÂÖÉÊâÄÂæóÁ®é`)
                        player.money -= 700;
                        nextDicePlayer()
                    }
                }),
                new MapLandFunction({
                    id: 14,
                    name: 'Âä†ÊãøÂ§ß',
                    money: 2600,
                    landSrc: './assets/monopoly/land6.jpg',
                    holder: null,
                    level: 0,
                    toll: [300, 1100, 3300, 8000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapFunction({
                    stop: (player, score) => {
                        log(`Áé©ÂÆ∂${player.name}ÂÅúÁïôÂÖçË¥πÂÅúËΩ¶Âú∫ ÊöÇÂÅú‰∏ÄÂõûÂêà`)
                        player.pause = true;
                        nextDicePlayer()
                    }
                }),
                new MapLandFunction({
                    id: 16,
                    name: 'ÂúüËÄ≥ÂÖ∂',
                    money: 2200,
                    landSrc: './assets/monopoly/land3.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 900, 2500, 7000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 17,
                    name: 'ÁæéÂõΩ',
                    money: 2400,
                    landSrc: './assets/monopoly/land8.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 1000, 3000, 7500],
                    upgrade: 1500,
                    stop: countryStop
                }),
                destinyMapFunction,
                new MapLandFunction({
                    id: 19,
                    name: 'Ëã±ÂõΩ',
                    money: 3000,
                    landSrc: './assets/monopoly/land9.jpg',
                    holder: null,
                    level: 0,
                    toll: [300, 1300, 3900, 9000],
                    upgrade: 2000,
                    stop: countryStop,
                }),
                new MapLandFunction({
                    id: 20,
                    name: 'Âæ∑ÂõΩ',
                    money: 3600,
                    landSrc: './assets/monopoly/land17.jpg',
                    holder: null,
                    level: 0,
                    toll: [400, 1800, 5000, 11000],
                    upgrade: 2000,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 21,
                    name: '‰º¶Êï¶Â∏åÊÄùÁΩóÂõΩÈôÖÊú∫Âú∫',
                    money: 2000,
                    landSrc: './assets/monopoly/land5.jpg',
                    holder: null,
                    level: 0,
                    toll: [3000, 5000],
                    stop: airfieldStop
                }),
                chanceMapFunction,
                new MapFunction({
                    stop: (player, score) => {
                        log(`Áé©ÂÆ∂${player.name}ÈúÄË¶ÅÁº¥Á∫≥500ÂÖÉÁ≠æËØÅË¥π`)
                        player.money -= 500;
                        nextDicePlayer()
                    }
                }),
                new MapFunction({
                    stop: goToPrison
                }),
                new MapLandFunction({
                    id: 25,
                    name: '‰øÑÁΩóÊñØ',
                    money: 3200,
                    landSrc: './assets/monopoly/land11.jpg',
                    holder: null,
                    level: 0,
                    toll: [300, 1500, 4500, 10000],
                    upgrade: 2000,
                    stop: countryStop
                }),
                destinyMapFunction,
                new MapLandFunction({
                    id: 27,
                    name: 'Ê≥ïÂõΩ',
                    money: 2200,
                    landSrc: './assets/monopoly/land15.jpg',
                    holder: null,
                    level: 0,
                    toll: [200, 900, 2500, 7000],
                    upgrade: 1500,
                    stop: countryStop
                }),
                new MapLandFunction({
                    id: 28,
                    name: 'ÁîµÂäõÂÖ¨Âè∏',
                    money: 1200,
                    landSrc: './assets/monopoly/land2.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300],
                    stop: hydropowerStop
                }),
                new MapLandFunction({
                    id: 29,
                    name: 'Âç∞Â∫¶',
                    money: 1000,
                    landSrc: './assets/monopoly/land1.jpg',
                    holder: null,
                    level: 0,
                    toll: [100, 300, 900, 2700],
                    upgrade: 500,
                    stop: countryStop
                })
            ]
            // ÂëΩËøêÈÄâÊã©
            let destinySelect = commentarySeat.querySelector('.destiny-select')
            let selectChance = destinySelect.querySelector('.select-btn.chance')
            let selectDestiny = destinySelect.querySelector('.select-btn.destiny')
            selectChance.addEventListener('click', function () {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                chanceMapFunction.stop(currentPlayer)
                destinySelect.hidden = true;
            })
            selectDestiny.addEventListener('click', function () {
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                destinyMapFunction.stop(currentPlayer)
                destinySelect.hidden = true;
            })

            // ÊöÇÂÅúÁé©ÂÆ∂ÈÄâÊã©
            let pauseUserSelect = commentarySeat.querySelector('.pause-user-select')
            function pauseUserSelectOpen() {
                pauseUserSelect.hidden = false;
                let currentPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
                playerInfoList.forEach((player => {
                    let info = document.createElement('div')
                    info.classList.add('select-btn')
                    let avatar = document.createElement('img')
                    avatar.src = player.avater
                    let name = document.createElement('div')
                    name.textContent = player.name
                    info.appendChild(avatar)
                    info.appendChild(name)
                    pauseUserSelect.appendChild(info)

                    info.addEventListener('click', function () {
                        log(`Áé©ÂÆ∂${currentPlayer.name} ÊåáÂÆö Áé©ÂÆ∂${player.name} ÊöÇÂÅú‰∏ÄÂõûÂêà`)
                        player.pause = true;
                        pauseUserSelect.hidden = true;
                        nextDicePlayer()
                    })
                }))
            }

            // ‰∏™‰∫∫
            let moneyResultFunc = function (player) {
                log(`${player.name} ${this.info}`)
                player.money += this.award;
                nextDicePlayer()
            }
            // Áæ§‰Ωì
            let moneyAndOtherPlayersResultFunc = function (player) {
                log(`${player.name} ${this.info}`)
                let other = playerInfoList.filter(p => p != player)
                player.money += other.length * this.award;
                other.map(p => p.money -= this.award)
                nextDicePlayer()
            }
            // Êú∫‰ºö‰∫ã‰ª∂ÂàóË°®
            chanceFunctionList = [
                new ChanceFunction({
                    info: 'Âà∞Ê≥∞ÂõΩÊåâÊë©Â≠¶Èô¢ Â≠¶‰π†Ê≠£ÁªüÊ≥∞ÂºèÊåâÊë© ‰ªòÂ≠¶Ë¥π500ÂÖÉ',
                    award: -500,
                    resultSrc: './assets/monopoly/chance1.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'Âú®Á∫ΩÁ∫¶Êó∂‰ª£ÂπøÂú∫ ÊâÆÊºîË°óÂ§¥Ëâ∫ ÊâìËµè500ÂÖÉ',
                    award: 500,
                    resultSrc: './assets/monopoly/chance2.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'Á†¥ÂùèËã±ÂõΩÂ§ßËã±ÂçöÁâ©È¶Ü ÁèçÁ®ÄËâ∫ÊúØÂìÅ ÁΩöÊ¨æ1000ÂÖÉ',
                    award: -1000,
                    resultSrc: './assets/monopoly/chance3.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'ÊàêÁ´ãÁà±ÂøÉÊÖàÂñÑÂü∫Èáë‰ºö Â∏ÆÂä©Âº±ÂäøÁæ§‰Ωì Â•ñÂä±1200ÂÖÉ',
                    award: 1200,
                    resultSrc: './assets/monopoly/chance4.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'Ëé∑ËÅò‰∏∫Ê≥ïÂõΩËìùÂ∏¶Âé®Ëâ∫Â≠¶Èô¢ È¶ñÂ∏≠ÊïôÂ∏à Â•ñÂä±Èáë800ÂÖÉ',
                    award: 800,
                    resultSrc: './assets/monopoly/chance5.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'ÊàêÂäüÁôª‰∏ä‰∏ñÁïåÊúÄÈ´òÂ≥∞ „ÄåÁè†Á©ÜÊúóÁéõÂ≥∞„Äç ÊØè‰ΩçÁé©ÂÆ∂Áªô‰Ω†Â•ñÂä±Èáë300ÂÖÉ',
                    award: 300,
                    resultSrc: './assets/monopoly/chance6.jpg',
                    resultFunc: moneyAndOtherPlayersResultFunc
                }),
                new ChanceFunction({
                    info: 'ÂèÇÂä†Â∑¥Ë•øÁãÇÊ¨¢ËäÇÊ∏∏Ë°å ‰∫∫ÊΩÆ‰ºóÂ§öÔºåÈÅ≠ÈÅáÊâíÊâãÈõÜÂõ¢ ÊçüÂ§±700ÂÖÉ',
                    award: -700,
                    resultSrc: './assets/monopoly/chance7.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'ËÄÉÂè§Êñ∞ÂèëÁé∞ Âú®ÂüÉÂèäÊåñÊéòÂá∫Á®Ä‰∏ñÁèçÂÆù Â•ñÈáë800ÂÖÉ',
                    award: 800,
                    resultSrc: './assets/monopoly/chance8.jpg',
                    resultFunc: moneyResultFunc
                }),
                new ChanceFunction({
                    info: 'ÂèÇÂä†Âåó‰∫¨ÊïÖÂÆ´ÂøóÊÑøËÄÖÊúçÂä°ÈòüÔºåÁ≤æÁ•ûÂèØÂòâ ÂÖ®‰ΩìÁé©ÂÆ∂‰∏∫‰Ω†ÈºìÊéå10ÁßíÈíü',
                    resultSrc: './assets/monopoly/chance9.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        nextDicePlayer()
                    }
                }),
                new ChanceFunction({
                    info: 'ÊãõÂæÖÊúãÂèãÂéªÁúã ‰∏ñÁïåÊùØË∂≥ÁêÉËµõ ‰ªòÁªôÊØè‰ΩçÁé©ÂÆ∂200ÂÖÉ',
                    award: -200,
                    resultSrc: './assets/monopoly/chance10.jpg',
                    resultFunc: moneyAndOtherPlayersResultFunc
                }),
                new ChanceFunction({
                    name: 'ÂÖçË¥πÂçáÁ∫ßÂç°',
                    info: 'ÊäïËµÑÂç∞Â∞ºÂ∑¥ÂéòÂ≤õÂ∫¶ÂÅáÊùë ÂèØÂú®Ëá™Â∑±ÂúüÂú∞‰∏ä‰ªªÈÄâ‰∏ÄÂ§ÑÂÖçË¥πÂçáÁ∫ß‰∏ÄÊ†ãÊàøÂ±ã',
                    resultSrc: './assets/monopoly/chance11.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        player.knapsack.push(this)
                        nextDicePlayer()
                    }
                }),
                new ChanceFunction({
                    info: 'Êê≠‰πòË±™ÂçéÊ∏∏ËΩÆÁéØÊ∏∏‰∏ñÁïå Ë¥πÁî®900ÂÖÉ',
                    award: -900,
                    resultSrc: './assets/monopoly/chance12.jpg',
                    resultFunc: moneyResultFunc
                }),
            ]
            // ÂëΩËøê‰∫ã‰ª∂ÂàóË°®
            destinyFunctionList = [
                new DestinyFunction({
                    info: 'ÁúºÂÖâÁ≤æÂáÜ ÊäïËµÑËÇ°Á•®Ëé∑Âà© Âæó300ÂÖÉ',
                    award: 300,
                    resultSrc: './assets/monopoly/destiny1.jpg',
                    resultFunc: moneyResultFunc
                }),
                new DestinyFunction({
                    info: 'Âú®ÈùûÊ¥≤ËÇØÂ∞º‰∫öÈáéÁîüÂä®Áâ©Âõ≠Âå∫ ‰π±ÂñÇÈ£üÂä®Áâ© ÁΩöÊ¨æ800ÂÖÉ',
                    award: -800,
                    resultSrc: './assets/monopoly/destiny2.jpg',
                    resultFunc: moneyResultFunc
                }),
                new DestinyFunction({
                    info: 'ÂèÇÂä†ÊäΩÂ•ñÂ§ßËµõ ÂèØ‰ªªÊÑèÈÄâÊã©ÂÜçÁøª‰∏ÄÂº†ÂëΩËøêÂç°ÊàñÊú∫‰ºöÂç°',
                    resultSrc: './assets/monopoly/destiny3.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        this.container.hidden = true;
                        destinySelect.hidden = false;
                    }
                }),
                new DestinyFunction({
                    info: 'ÂÖ•ÈÄâÂõΩÂÆ∂Èòü ‰ª£Ë°®ÂèÇÂä†Â••Ëøê‰ºöÊØîËµõ ËØ∑ÊØè‰ΩçÁé©ÂÆ∂ËµûÁæé‰Ω†1‰∏™‰ºòÁÇπ',
                    resultSrc: './assets/monopoly/destiny4.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        nextDicePlayer()
                    }
                }),
                new DestinyFunction({
                    name: 'Âá∫Áã±ËÆ∏ÂèØËØÅ',
                    info: 'Ëé∑ÂæóÂá∫Áã±ËÆ∏ÂèØËØÅ',
                    resultSrc: './assets/monopoly/destiny5.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        player.knapsack.push(this)
                        nextDicePlayer()
                    }
                }),
                new DestinyFunction({
                    info: 'ÊäïÁ®ø‰∏äÊµ∑Â§ñÊª©Â§úÊôØÁÖßÁâá Ëé∑Âæó‰∏ñÁïåÊëÑÂΩ±Â§ßËµõÂÜ†ÂÜõ Â•ñÈáë1000ÂÖÉ',
                    award: 1000,
                    resultSrc: './assets/monopoly/destiny6.jpg',
                    resultFunc: moneyResultFunc
                }),
                new DestinyFunction({
                    info: 'Ëµ∞Ë∑ØÁé©ÊâãÊú∫ ‰∏çÂπ∏Ë¢´Ê±ΩËΩ¶ÊíûÊñ≠ËÖø ‰∏ãÂõûÂêàÊöÇÂÅú‰∏ÄÊ¨°',
                    resultSrc: './assets/monopoly/destiny7.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        player.pause = true;
                        nextDicePlayer()
                    }
                }),
                new DestinyFunction({
                    info: 'Ëµ∞ÁßÅÊØíÂìÅ Á´ãÂàªÂùêÁâ¢ Ëã•ÁªèËøáËµ∑ÁÇπ‚ÄúÁî±Ê≠§Âéª‚Äù ‰∏çÂæóÈ¢ÜÂèñ1000ÂÖÉ',
                    resultSrc: './assets/monopoly/destiny8.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        goToPrison(player, 1)
                    }
                }),
                new DestinyFunction({
                    info: 'Êê≠‰πòÁÉ≠Ê∞îÁêÉ Ê∏∏ËßàÊæ≥Ê¥≤ÈªÑÈáëÊµ∑Â≤∏ ÂèØÈáçÊñ∞Êé∑È™∞ÂÜçÁé©‰∏ÄÊ¨°',
                    resultSrc: './assets/monopoly/destiny9.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                    }
                }),
                new DestinyFunction({
                    info: 'Âú®ÂÜ∞Â≤õÁúãÂåóÊûÅÂÖâ Èò≤ÂØíËÆæÂ§á‰∏çË∂≥ÂÜª‰º§ ÂèØÊåáÂÆö‰ªª‰∏ÄÁé©ÂÆ∂ ‰∏ãÂõûÂêàÊöÇÂÅú‰∏ÄÊ¨°',
                    resultSrc: './assets/monopoly/destiny10.jpg',
                    resultFunc: function (player) {
                        log(`${player.name} ${this.info}`)
                        this.container.hidden = false;
                        pauseUserSelectOpen()
                    }
                }),
                new DestinyFunction({
                    info: 'ÂèóÈÇÄÂèÇÂä†ÊàõÁ∫≥ÁîµÂΩ±ËäÇ ÂºÄÂπïÂÖ∏Á§º Ëä±ÁΩÆË£ÖË¥π600ÂÖÉ',
                    award: -600,
                    resultSrc: './assets/monopoly/destiny11.jpg',
                    resultFunc: moneyResultFunc
                }),

                new DestinyFunction({
                    info: '‰∏çÂπ∏ÈÅ≠ÈÅáÂú∞Èúá ÊàøÂ±ãÂÄíÂ°å ‰ªò‰øÆÁºÆË¥π1200ÂÖÉ',
                    award: -1200,
                    resultSrc: './assets/monopoly/destiny12.jpg',
                    resultFunc: moneyResultFunc
                }),
            ]
            // ËßÑÂàôÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            ruleBtn.addEventListener("click", () => {
                gameStart.hidden = true;
                gameRule.hidden = false
            })
            // ËßÑÂàôÂÖ≥Èó≠ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            ruleCloseBtn.addEventListener('click', () => {
                gameStart.hidden = false;
                gameRule.hidden = true
            })
            // ÈÄâÊã©Áé©ÂÆ∂ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            selectPlayers.forEach(player => {
                player.addEventListener('click', function () {
                    if (player.classList.contains('active')) {
                        // ÂΩì‰∫∫Êï∞Â∞è‰∫é‰∏§‰∏™‰∏çÁßªÈô§Ê†áÁ≠æ
                        if (document.querySelectorAll('.players .player.active').length > 2) {
                            player.classList.remove('active')
                        }
                    }
                    else {
                        player.classList.add('active')
                    }
                })
            })
            // ÂºÄÂßãÊ∏∏ÊàèÁÇπÂáª‰∫ã‰ª∂
            startBtn.addEventListener("click", () => {
                mapMask.setAttribute('style', 'display:none')
                commentarySeat.setAttribute('style', 'display:flex')
                let selected = document.querySelectorAll('.players .player.active')
                let playerList = commentarySeat.querySelector('.player-list')
                selected.forEach(function (player, index) {
                    let chessPiece = document.createElement('div')
                    let information = document.createElement('div')
                    let color = player.querySelector('.color').textContent;
                    let src = player.querySelector('img').src
                    let money = config.money
                    let isBankruptcy = false
                    chessPiece.classList.add('player')
                    information.classList.add('player')

                    chessPiece.setAttribute('style', `background-image:url(${src});--border-color:${color}`)
                    // Êñ∞Âª∫Â§¥ÂÉè
                    let infoAvatar = document.createElement('img')
                    infoAvatar.setAttribute("src", src)
                    infoAvatar.classList.add('avatar')
                    infoAvatar.setAttribute('style', `--border-color:${color}`)
                    if (dicePlayerIndex === index) infoAvatar.classList.add('active')
                    // Êñ∞Âª∫ËµÑÈáëÊ†è
                    let fund = document.createElement('div')
                    fund.classList.add('fund')
                    fund.textContent = money
                    // Êñ∞Âª∫Áâ©ÂìÅÊ†è
                    let inventory = document.createElement('div')
                    inventory.classList.add('inventory')
                    // Êñ∞Âª∫Â∑≤Á†¥‰∫ß
                    let bankruptcy = document.createElement('div')
                    bankruptcy.classList.add('bankruptcy')
                    bankruptcy.textContent = 'Â∑≤Á†¥‰∫ß'
                    bankruptcy.hidden = !isBankruptcy

                    information.appendChild(infoAvatar)
                    information.appendChild(fund)
                    information.appendChild(inventory)
                    information.appendChild(bankruptcy)
                    playerList.appendChild(information)
                    // Áé©ÂÆ∂Ê£ãÂ≠êÂàùÂßã‰ΩçÁΩÆ
                    mapElementList[0].appendChild(chessPiece)
                    // Áé©ÂÆ∂‰ø°ÊÅØ
                    const playerInfo = {
                        avater: src,
                        name: player.querySelector('.name').textContent,
                        color,
                        moveScore: 0,
                        pause: false,
                        money,
                        knapsack: null,
                        isBankruptcy,
                        information,
                        fund,
                        chessPiece,
                        inventory,
                        bankruptcy,
                    }
                    playerInfo.knapsack = new Knapsack(playerInfo)
                    // ÁªëÂÆöÈáëÈí±
                    Object.defineProperty(playerInfo, 'money', {
                        get() {
                            return money
                        },
                        set(val) {
                            money = val
                            fund.textContent = money
                            // ËøõÂÖ•Á†¥‰∫ßÊµÅÁ®ã
                            if (money < 0) {
                                playerInfo.isBankruptcy = true;
                                // ÂúüÂú∞ÂÖÖÂÖ¨
                                // ÈáçÊñ∞Á´û‰ª∑

                            }
                        }
                    })
                    // ÁªëÂÆöÊòØÂê¶Á†¥‰∫ß
                    Object.defineProperty(playerInfo, 'isBankruptcy', {
                        get() {
                            return isBankruptcy
                        },
                        set(val) {
                            isBankruptcy = val
                            bankruptcy.hidden = !val
                        }
                    })

                    playerInfoList.push(playerInfo)
                })

                log('Ê∏∏ÊàèÂºÄÂßã')
                log(`ËØ∑Áé©ÂÆ∂${playerInfoList[dicePlayerIndex].name}ÂºÄÂßãÊé∑Ëâ≤Â≠ê`)
            })
            // üé≤
            dice.addEventListener('click', diceClick)
            log('Ê∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê')
            // Ê®°ÊãüÂºÄÂßã
            startBtn.click()
            // diceClick();
            // pauseUserSelectOpen();
            // destinySelect.hidden = false;
            // chanceMapFunction.stop()
            // setTimeout(() => {
            //     businessContainerFreeBuyHouseBtn.click()
            // }, 8000)
        }

        // Áé©ÂÆ∂ÁßªÂä®
        async function moving(player, score) {
            let current = player.moveScore % mapElementList.length
            let wait = () => new Promise((resolve) => {
                setTimeout(resolve, 100)
            })
            for (let i = 0; i < score; i++) {
                await wait();
                player.moveScore++;
                let target = player.moveScore % mapElementList.length
                mapElementList[target].appendChild(player.chessPiece)
                let funcName = i === score - 1 ? 'stop' : 'pass';
                mapFunctionList[target][funcName](player, score)
            }
        }

        // È™∞Â≠êüé≤
        async function diceClick() {
            if (diceTurn) return;
            diceTurn = true
            let target = Randoms.getRandomInt(1, 7);
            let length = 18 + target;
            let diceChildren = dice.children
            let wait = () => new Promise((resolve) => {
                setTimeout(resolve, 100)
            })
            for (let i = 0; i < length; i++) {
                await wait();
                dice.querySelector('img:not([hidden])').hidden = true
                diceChildren.item(i % 6).hidden = false
            }
            let playerInfo = playerInfoList[dicePlayerIndex % playerInfoList.length]
            log(`Áé©ÂÆ∂${playerInfo.name}Êé∑Ëâ≤Â≠êÊï∞‰∏∫${target}`)
            await moving(playerInfo, target)
            diceTurn = false
        }

        // ‰∏ã‰∏Ä‰∏™ÊëáÈ™∞Â≠ê‰∫∫
        function nextDicePlayer() {
            dicePlayerIndex++;
            let nextPlayer = playerInfoList[dicePlayerIndex % playerInfoList.length];
            if (nextPlayer.pause) {
                nextPlayer.pause = false;
                return nextDicePlayer()
            }
            // Á†¥‰∫ß
            if (nextPlayer.isBankruptcy) {
                return nextDicePlayer()
            }
            commentarySeat.querySelector('.player-list .avatar.active').classList.remove('active')
            nextPlayer.information.querySelector('.avatar').classList.add('active')
            log(`ËØ∑Áé©ÂÆ∂${nextPlayer.name}ÂºÄÂßãÊé∑Ëâ≤Â≠ê`)
        }

        // ÊâìÂç∞Êó•Âøó
        function log(str) {
            let element = document.createElement('div')
            element.textContent = str
            logList.appendChild(element)
            logList.scrollTo({ top: 100000000 })
        }

        // ÊâßË°åÂàùÂßãÂåñ
        init();
    </script>
</body>

</html>