<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹</title>
    <style>
        body {
            margin: 0;
        }


        .gomoku-board {
            /* æ”¾ç½®æ‹–åŠ¨é¼ æ ‡è¿›è¡Œé€‰æ‹© */
            user-select: none;
            margin: 30px;
            --length: 400px;
            --lineColor: #ddd;
            position: relative;
            width: var(--length);
            height: var(--length);
        }

        .gomoku-board .rows,
        .gomoku-board .lines {
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            justify-content: space-between;
        }

        .gomoku-board .rows {
            flex-direction: column;
            height: var(--length);
        }

        .gomoku-board .lines {
            width: var(--length);
        }


        .gomoku-board .row {
            width: var(--length);
            height: 1px;
            background-color: var(--lineColor);
        }

        .gomoku-board .line {
            width: 1px;
            height: var(--length);
            background-color: var(--lineColor);
        }

        .gomoku-board .key-points {
            position: absolute;
            --margin: calc(var(--length) / 14 * 3);
            top: var(--margin);
            bottom: var(--margin);
            left: var(--margin);
            right: var(--margin);
        }

        .gomoku-board .key-points .point {
            --length: 8px;
            width: var(--length);
            height: var(--length);
            background: rgb(92, 92, 92);
            position: absolute;
            transform: translate(-50%, -50%);
        }

        .gomoku-board .key-points .point:nth-child(2) {
            left: 100%;
        }

        .gomoku-board .key-points .point:nth-child(3) {
            left: 100%;
            top: 100%;
        }

        .gomoku-board .key-points .point:nth-child(4) {
            top: 100%;
        }

        .gomoku-board .key-points .point:nth-child(5) {
            left: 50%;
            top: 50%;
        }


        .gomoku-board .x-axis,
        .gomoku-board .y-axis {
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            justify-content: space-between;
        }

        .gomoku-board .x-axis {
            flex-direction: column;
            --height: calc(var(--length) / 14 * 15);
            height: var(--height);
        }

        .gomoku-board .y-axis {
            --width: calc(var(--length) / 14 * 15);
            width: var(--width);
        }




        .gomoku-board .x-axis div {
            --width: calc(var(--height) / 15);
            transform: translate(calc(var(--width) * -1), -50%);
            width: var(--width);
            flex: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.6);
        }

        .gomoku-board .y-axis div {
            --height: calc(var(--width) / 15);
            transform: translate(-50%, calc(var(--height) * -1));
            height: var(--height);
            flex: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.6);
        }


        .gomoku-board .chessmans {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;

            --chessman-length: calc(var(--length) / 14 * .8);
        }

        .gomoku-board .chessmans div {
            pointer-events: none;
            width: var(--chessman-length);
            height: var(--chessman-length);
            border-radius: 50%;
            filter:
                drop-shadow(0 0 1px rgb(92, 92, 92));
            position: absolute;
            transform: translate(-50%, -50%);
            box-sizing: border-box;
        }

        .gomoku-board .chessmans div:nth-child(2n) {
            background-color: #fefefe;
        }

        .gomoku-board .chessmans div:nth-child(2n+1) {
            background-color: #333;
        }

        .gomoku-board .chessmans div:last-child::after {
            content: "";
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(calc(-50% + .5px), calc(-50% + .5px));
            height: calc(var(--chessman-length));
            width: calc(var(--chessman-length));
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAATklEQVQYlWP4//8/JhYU/I9NnImBBEA7xYwgtxCvWFAQVfW7d4xwtpAQihzIGSBJBBYSgikEG4aMQSZjsxFkIsIGuCj9wxnmdhhgYGAAAMNeSsbtJkooAAAAAElFTkSuQmCC") no-repeat;
            background-position: center;
        }



        .gameover {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.6);

            color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;

            display: none;
        }


        .operate {
            position: absolute;
            left: 0;
            right: 0;
            bottom: -70px;
            display: flex;
            user-select: none;
        }

        .operate div {
            width: 100px;
            height: 40px;
            background-color: #fff;
            color: #276787;
            border: 1px solid #276787;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            font-size: 12px;
            transition: all .5s;
        }

        .operate div:hover {

            background-color: #276787;
            color: white;
            border: 1px solid transparent;

        }

        .operate div:active {
            opacity: .4;
        }
    </style>
</head>

<body>
    <!-- äº”å­æ£‹ç›˜ -->
    <div class="gomoku-board">
        <!-- å¯ä»¥ä½¿ç”¨å¿«æ·è¾“å…¥ .row*15 .line*15 -->
        <!-- åˆ— -->
        <div class="lines">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
        </div>
        <!-- è¡Œ -->
        <div class="rows">
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
            <div class="row"></div>
        </div>
        <!-- å…³é”®ç‚¹ -->
        <div class="key-points">
            <div class="point"></div>
            <div class="point"></div>
            <div class="point"></div>
            <div class="point"></div>
            <div class="point"></div>
        </div>
        <!-- å¯ä»¥ä½¿ç”¨å¿«æ·è¾“å…¥ div{$}*15 -->
        <div class="x-axis">
            <div>1</div>
            <div>2</div>
            <div>3</div>
            <div>4</div>
            <div>5</div>
            <div>6</div>
            <div>7</div>
            <div>8</div>
            <div>9</div>
            <div>10</div>
            <div>11</div>
            <div>12</div>
            <div>13</div>
            <div>14</div>
            <div>15</div>
        </div>
        <!-- è¿™ä¸ªæ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆå¿«æ·çš„æ–¹æ³• ğŸ˜’ -->
        <div class="y-axis">
            <div>A</div>
            <div>B</div>
            <div>C</div>
            <div>D</div>
            <div>E</div>
            <div>F</div>
            <div>G</div>
            <div>H</div>
            <div>I</div>
            <div>J</div>
            <div>K</div>
            <div>L</div>
            <div>M</div>
            <div>N</div>
            <div>O</div>
        </div>
        <!-- æ£‹å­ æ–¹ä¾¿åˆ é™¤ -->
        <div class="chessmans"></div>
        <!-- æ¸¸æˆç»“æŸ -->
        <div class="gameover"></div>
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="operate">
            <div class="undo">æ‚”æ£‹</div>
            <div class="reset">é‡æ¥</div>
        </div>
    </div>
    <!-- ä»£ç é€»è¾‘ -->
    <script type="module">
        // éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒ å¯é€‰é“¾æ“ä½œç¬¦ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining
        // æ£‹å­çˆ¶èŠ‚ç‚¹çš„å…ƒç´ 
        let chessmansDom = document.getElementsByClassName('chessmans')[0];
        // æ‚”æ£‹å…ƒç´ èŠ‚ç‚¹
        let undoDom = document.getElementsByClassName('undo')[0];
        // é‡æ¥å…ƒç´ èŠ‚ç‚¹
        let resetDom = document.getElementsByClassName('reset')[0];
        // æ¸¸æˆç»“æŸå…ƒç´ èŠ‚ç‚¹
        let gameoverDom = document.getElementsByClassName('gameover')[0];
        // æ£‹ç›˜è¾¹é•¿  æœªäºˆcssè¿›è¡Œç»‘å®š
        let length = 400;
        // æ ¼å­è¾¹é•¿
        let girdLength = length / 14
        // é¢œè‰²å®šä¹‰
        let colorEnum = {
            None: 0,
            black: 1,
            white: 2
        }
        // æ¸¸æˆçŠ¶æ€æšä¸¾
        let gameStateEnum = {
            underway: 1, // è¿›è¡Œä¸­
            blackWin: 2, // é»‘å­èƒœ
            whiteWin: 4, // ç™½å­èƒœ
            draw: 8,     // å¹³å±€    ä¹Ÿå¯ä»¥ç†è§£ä¸ºç™½å­èƒœåˆ©
            gameOver: 14,// æ¸¸æˆç»“æŸ
        }
        // æ£‹å­å†å²
        let chessmanHistory = [];
        let chessmanDomHistory = [];
        // æ£‹å­ä½ç½®
        let chessmanPosition = initChessmanPosition();

        // æ¸¸æˆç»“æŸ
        let gameState = gameStateEnum.underway;


        // æ£‹å­çˆ¶çº§ç‚¹å‡»äº‹ä»¶
        // layerXã€layerY ç›¸å¯¹äºå¸¦æœ‰å®šä½çš„çˆ¶ç›’å­çš„x,yåæ ‡
        function chessmansClickFunc(e) {
            let { layerX, layerY } = e;
            let x = Math.abs(Math.round(layerX / girdLength));
            let y = Math.abs(Math.round(layerY / girdLength));
            putDown(x, y);
        }
        // è½å­
        function putDown(x, y) {
            // åŒ…å«æ­¤çŠ¶æ€ ä½è¿ç®—
            if ((gameState & gameStateEnum.gameOver) != 0) {
                console.log("æ¸¸æˆç»“æŸäº† ä¸èƒ½è½å­äº†");
                return;
            }

            if (chessmanPosition[x][y] != colorEnum.None) {
                console.log("è¯¥ä½ç½®å·²è½å­");
                return
            }
            let color = chessmanHistory.length % 2 == 0 ? colorEnum.black : colorEnum.white;
            chessmanPosition[x][y] = color;
            let chessmanDom = document.createElement('div')
            chessmanDom.style = `left:${x * girdLength}px;top:${y * girdLength}px`;
            chessmansDom.appendChild(chessmanDom)
            chessmanHistory.push({ x, y })
            chessmanDomHistory.push(chessmanDom);
            checkGameOver(x, y);

            // åŒ…å«æ­¤çŠ¶æ€ ä½è¿ç®—
            if ((gameState & gameStateEnum.gameOver) != 0) {
                let hint = gameState == gameStateEnum.draw ? 'å¹³å±€å•¦ï¼' : gameState == gameStateEnum.blackWin ? 'é»‘å­èƒœåˆ©ï¼' : "ç™½å­èƒœåˆ©ï¼"
                gameoverDom.textContent = hint;
                gameoverDom.setAttribute("style", 'display:flex')
            }
        }
        // æ£€æµ‹æ¸¸æˆç»“æŸ
        function checkGameOver(x, y) {
            // è¿æ¥å­ä¸å¤Ÿ
            if (chessmanHistory.length < 8) return;
            // è¿ç»­çš„ä¸ªæ•°
            let continuously = 1;
            // é¢œè‰²
            let color = chessmanPosition[x][y];
            // æ¨ªè½´ 
            for (let i = x - 1; i >= 0; i--) {
                if (color != chessmanPosition?.[i]?.[y]) break;
                continuously++;
            }
            for (let j = x + 1; j <= 14; j++) {
                if (color != chessmanPosition?.[j]?.[y]) break;
                continuously++;
            }
            if (continuously >= 5) {
                gameState = color == colorEnum.black ? gameStateEnum.blackWin : gameStateEnum.whiteWin;
                return;
            }
            continuously = 1;
            // çºµè½´ 
            for (let i = y - 1; i >= 0; i--) {
                if (color != chessmanPosition?.[x]?.[i]) break;
                continuously++;
            }
            for (let j = y + 1; j <= 14; j++) {
                if (color != chessmanPosition?.[x]?.[j]) break;
                continuously++;
            }
            if (continuously >= 5) {
                gameState = color == colorEnum.black ? gameStateEnum.blackWin : gameStateEnum.whiteWin;
                return;
            }
            continuously = 1;
            // 135Â°
            for (let i = x - 1, j = y - 1; i >= 0, j >= 0; i--, j--) {
                if (color != chessmanPosition?.[i]?.[j]) break;
                continuously++;
            }
            for (let i = x + 1, j = y + 1; i <= 14, j <= 14; i++, j++) {
                if (color != chessmanPosition?.[i]?.[j]) break;
                continuously++;
            }
            if (continuously >= 5) {
                gameState = color == colorEnum.black ? gameStateEnum.blackWin : gameStateEnum.whiteWin;
                return;
            }
            continuously = 1;
            // 45Â°
            for (let i = x + 1, j = y - 1; i <= 14, j >= 0; i++, j--) {
                if (color != chessmanPosition?.[i]?.[j]) break;
                continuously++;
            }
            for (let i = x - 1, j = y + 1; i >= 0, j <= 14; i--, j++) {
                if (color != chessmanPosition?.[i]?.[j]) break;
                continuously++;
            }
            if (continuously >= 5) {
                gameState = color == colorEnum.black ? gameStateEnum.blackWin : gameStateEnum.whiteWin;
                return;
            }
            gameState = chessmanHistory.length == 255 ? gameStateEnum.draw : gameStateEnum.underway;
        }
        // åˆå§‹æ£‹å­ä½ç½®ä¿¡æ¯
        function initChessmanPosition() {
            let temp = [];
            for (let i = 0; i < 15; i++) {
                let tempChild = [];
                for (let j = 0; j < 15; j++) {
                    tempChild.push(0);
                }
                temp.push(tempChild)
            }
            return temp
        }
        // æ‚”æ£‹æ“ä½œ
        function undoClickFunc() {
            // åŒ…å«æ­¤çŠ¶æ€ ä½è¿ç®—
            if ((gameState & gameStateEnum.gameOver) != 0) {
                console.log("éƒ½æ¸¸æˆç»“æŸäº†  è¿˜æ‚”ä»€ä¹ˆæ£‹");
                return;
            }
            if (chessmanHistory.length == 0) {
                console.log("æ²¡æœ‰è¿‡è½å­è®°å½•");
                return;
            }

            // pop() æ–¹æ³•ç”¨äºåˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›åˆ é™¤çš„å…ƒç´ ã€‚
            let lastPosition = chessmanHistory.pop();
            let lastDom = chessmanDomHistory.pop();
            chessmanPosition[lastPosition.x][lastPosition.y] = colorEnum.None;
            chessmansDom.removeChild(lastDom);
        }
        // é‡æ¥æ“ä½œ
        function resetClickFunc() {
            chessmanPosition = initChessmanPosition();
            chessmanHistory = [];
            chessmanDomHistory.forEach(chessmanDom => chessmanDom.remove());
            gameState = gameStateEnum.underway;
            gameoverDom.setAttribute("style", '')
        }

        chessmansDom.addEventListener('click', chessmansClickFunc)
        undoDom.addEventListener('click', undoClickFunc)
        resetDom.addEventListener('click', resetClickFunc)
    </script>
</body>

</html>