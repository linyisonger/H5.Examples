<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/global.css">


    <style>
        @font-face {
            font-family: "SourceHanSansCN-Light";
            src: url('./assets/SourceHanSansCN-Light.otf');
        }


        body {
            height: 100vh;
            font-family: "SourceHanSansCN-Light";
        }

        .flex-row-center {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .flex-column-center {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }


        .game-container {
            position: relative;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            user-select: none;
        }

        .game-btn-confirm {
            display: inline-flex;
            padding: 0 20px 3px;
            line-height: 40px;
            background: linear-gradient(to bottom, rgb(87, 196, 245), rgb(26, 147, 206));
            color: rgb(254, 252, 255);
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
            box-shadow: inset 0px -3px 0 rgb(19, 98, 139);
        }

        .game-btn-confirm:active {
            opacity: .7;
            box-shadow: inset 0px 0px 0 transparent;
        }

        object {
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="game-container"></div>
    <template id="log-template">
        <div class="log-header">
            <div class="log-header-title">
                Ê∏∏ÊàèÊó•Âøó
            </div>
            <div class="log-icon-close">
                <img src="./assets/monopoly-life/arrow.png" />
            </div>
        </div>
        <div class="log-body"></div>
        <style>
            :host {
                position: absolute;
                left: 0;
                bottom: 0;
                width: 400px;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 0 4px 0 0;
                transition: top .5s linear;
            }

            :host(.close) {
                bottom: calc(-30vh + 40px);
            }

            :host(.close) .log-icon-close {
                transform: rotate(180deg);
                top: 5px;
            }

            .log-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .log-body {
                margin: 0 10px 10px;
                height: calc(30vh - 50px);
                overflow-y: auto;
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
            }

            .log-icon-close {
                position: absolute;
                top: 10px;
                right: 20px;
            }

            .log-item-table {
                border-top: 1px solid #000;
                border-left: 1px solid #000;
                border-collapse: collapse;
            }

            .log-item-table td {
                border-right: 1px solid #000;
                border-bottom: 1px solid #000;
                text-align: center;
            }
        </style>
    </template>
    <template id="player-template">
        <style>
            :host {
                display: flex;
                position: absolute;
                top: 0px;
                right: 0;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 0 4px 0 0;
                padding: 10px;
                transition: top .5s linear;
            }

            :host(.close) {
                transform: 0;
            }

            .player-item {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                display: flex;
                padding: 10px 10px 10px 10px;
                width: 228px;
                align-items: center;
                box-sizing: border-box;
                position: relative;
            }

            .player-item+.player-item {
                margin-left: 10px;
            }

            .player-item.active .player-avatar::after {
                position: absolute;
                background-image: url('./assets/monopoly-life/dice.png');
                background-size: 20px 20px;
                background-repeat: no-repeat;
                width: 20px;
                height: 20px;
                right: 0;
                bottom: 0;
                content: "";
            }

            .player-item:hover .player-more {
                display: block;
            }

            .player-more {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 0 4px 0 0;
                padding: 10px;
            }

            .player-target-container,
            .player-exp-container,
            .player-cre-container {
                display: flex;
                flex-direction: column;
                padding: 5px 10px 0;
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
            }

            .player-exp-container,
            .player-cre-container {
                margin-top: 10px;
            }

            .player-target-body,
            .player-exp-body,
            .player-cre-body {
                display: flex;
                padding: 5px 0px
            }

            .player-exp-body .player-icon:not(.none),
            .player-cre-body .player-icon:not(.none) {
                border-radius: 4px;
                border: 1px solid rgb(66, 136, 167);
                color: rgb(66, 136, 167);
                padding: 0 4px;
            }

            .player-target-item {
                display: flex;
                flex: 1;
                justify-content: center;
            }

            .player-avatar {
                margin-right: 10px;
                width: 60px;
                height: 60px;
                background-size: contain;
                border-radius: 50%;
                position: relative;
            }

            .player-base-info {
                display: flex;
                flex-direction: column;
                flex: 1;
            }

            .player-base-info>div {
                display: flex;
                align-items: center;
                padding-left: 4px;
                background-color: rgb(207, 199, 190);
                border-radius: 4px;
                flex: 1;
                margin-top: 2px;
            }

            .player-repute,
            .player-happy,
            .player-chance,
            .player-experience {
                display: flex;
                flex: 1;
            }


            .player-icon {
                display: flex;
                align-items: center;
                margin-right: 5px;
            }
        </style>
    </template>
    <template id="player-template-player-item-internal">
        <div class="player-item">
            <div class="player-avatar"></div>
            <div class="player-base-info">
                <div class="player-riches">
                    <div class="player-icon">
                        <img src="./assets/monopoly-life/riches.png" />
                    </div>
                    <div class="player-value">0</div>
                </div>
                <div class="player-salary">
                    <div class="player-icon">
                        <img src="./assets/monopoly-life/salary.png" />
                    </div>
                    <div class="player-value">0</div>
                </div>
                <div>
                    <div class="player-repute">
                        <div class="player-icon">
                            <img src="./assets/monopoly-life/repute.png" />
                        </div>
                        <div class="player-value">0</div>
                    </div>
                    <div class="player-happy">
                        <div class="player-icon">
                            <img src="./assets/monopoly-life/happy.png" />
                        </div>
                        <div class="player-value">0</div>
                    </div>
                </div>
                <div>
                    <div class="player-chance">
                        <div class="player-icon">
                            <img src="./assets/monopoly-life/chance.png" width="20px" />
                        </div>
                        <div class="player-value">0</div>
                    </div>
                    <div class="player-experience">
                        <div class="player-icon">
                            <img src="./assets/monopoly-life/experience.png" width="20px" />
                        </div>
                        <div class="player-value">0</div>
                    </div>
                </div>
            </div>

            <div class="player-more">
                <div class="player-target-container">
                    <div class="player-target-title">
                        ÁõÆÊ†áÂÄº
                    </div>
                    <div class="player-target-body">
                        <div class="player-target-item target-riches">
                            <div class="player-icon">
                                <img src="./assets/monopoly-life/riches.png" />
                            </div>
                            <div class="player-value">60000</div>
                        </div>
                        <div class="player-target-item target-repute">
                            <div class="player-icon">
                                <img src="./assets/monopoly-life/repute.png" />
                            </div>
                            <div class="player-value">0</div>
                        </div>
                        <div class="player-target-item target-happy">
                            <div class="player-icon">
                                <img src="./assets/monopoly-life/happy.png" />
                            </div>
                            <div class="player-value">0</div>
                        </div>
                    </div>
                </div>
                <div class="player-exp-container">
                    <div class="player-exp-title">
                        ËÅå‰∏öÁªèÈ™å
                    </div>
                    <div class="player-exp-body">
                        <div class="player-icon none">
                            Êó†
                        </div>
                    </div>
                </div>
                <div class="player-cre-container">
                    <div class="player-cre-title">
                        Â§ßÂ≠¶Ëøõ‰øÆ
                    </div>
                    <div class="player-cre-body">
                        <div class="player-icon none">
                            Êó†
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <template id="dice-template">
        <div class="dice-header">
            <div class="dice-header-title">
                Êé∑È™∞Â≠ê
            </div>
        </div>
        <div class="dice-body">
            <div class="dice-item-container">
                <img class="dice-item" src="./assets/monopoly/1.png" />
                <img class="dice-item" src="./assets/monopoly/1.png" />
            </div>
            <div class="game-btn-confirm">ÂºÄÂßãËΩ¨Âä®</div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 300px;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
                transition: top .5s linear;
            }

            :host(.close) {
                top: -100%;
            }

            .dice-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .dice-body {
                margin: 0 10px 13px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
            }

            .dice-item {
                width: 50px;
                height: 50px;
                background-repeat: no-repeat;
                background-size: 100%;
            }

            .dice-item:nth-child(n+2) {
                margin-left: 20px;
            }

            .dice-item-container {
                display: flex;
                margin-top: 10px;
                margin-bottom: 10px;
            }

            .dice-item.hidden {
                display: none;
            }

            .game-btn-confirm {
                margin-bottom: 10px;
            }
        </style>
    </template>
    <template id="hospital-template">
        <div class="hospital-header">
            <div class="hospital-header-title">
                ÂåªÈô¢
            </div>
        </div>
        <div class="hospital-content">
            <div class="hospital-message">
                ‰∏çÂèØ‰ΩøÁî®Êú∫‰ºöÂç°ÊàñÁªèÈ™åÂç°Á¶ªÂºÄÊ≠§Ê†ºÔºåÈúÄÊé∑È™∞ÂÜ≥ÂÆöÂ¶Ç‰ΩïÁ¶ªÂºÄÂåªÈô¢Ôºö
            </div>
            <div class="hospital-list">
                <div class="hospital-item">
                    <img src="./assets/monopoly/1.png" />
                    <img src="./assets/monopoly/2.png" />
                    ÂÜç‰ºëÂÖª‰∏ÄÂõûÂêà
                </div>
                <div class="hospital-item">
                    <img src="./assets/monopoly/3.png" />
                    <img src="./assets/monopoly/4.png" />
                    <img src="./assets/monopoly/5.png" />
                    <img src="./assets/monopoly/6.png" />
                    ‰ªòËñ™Á∫ß‰∏ÄÂçäÁöÑÂåªËçØË¥πÁªôÊúâÂåªÂ≠¶Â≠¶‰ΩçÁöÑ‰∫∫‰∏ãÂõûÂêàÂá∫Èô¢
                </div>
                <div class="hospital-item">
                    (Ëã•Êó†‰∫∫ÊúâÂåªÂ≠¶Â≠¶‰ΩçÂàôÁªôÈì∂Ë°å)
                </div>
            </div>
            <div class="hospital-footer">
                <div class="hospital-dice">
                    <img src="./assets/monopoly/5.png" />
                </div>
                <div class="game-btn-confirm">ÂºÄÂßãËΩ¨Âä®</div>
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .hospital-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .hospital-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .hospital-content {
                margin: 0 10px 13px;
                padding: 10px;
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
            }

            .hospital-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            }

            .hospital-item img {
                height: 30px
            }

            .hospital-item img:last-child {
                margin-right: 10px;
            }

            .hospital-item:last-child {
                color: #a1a1a1;
                font-size: 14px;
            }

            .hospital-footer {
                display: flex;
                justify-content: space-between;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
            }

            .hospital-dice {
                display: flex;
                align-items: center;
            }
        </style>
    </template>
    <template id="park-template">
        <div class="park-header">
            <div class="park-header-title">
                ÂÖ¨Âõ≠ÊùøÂá≥
            </div>
        </div>
        <div class="park-content">
            <div class="park-message">
                ‰∏çÂèØ‰ΩøÁî®Êú∫‰ºöÂç°ÊàñÁªèÈ™åÂç°Á¶ªÂºÄÊ≠§Ê†ºÔºåÊäïÊé∑‰∏ÄÈ™∞ÔºåËã•ÁÇπÊï∞‰∏∫ÂèåÊï∞Ôºå‰∏ãÂõûÂêàÂç≥ÂèØÁ¶ªÂºÄÔºö
            </div>
            <div class="park-list">
                <div class="park-item">
                    <img src="./assets/monopoly/2.png" />
                    <img src="./assets/monopoly/4.png" />
                    <img src="./assets/monopoly/6.png" />
                    ‰∏ãÂõûÂêàÁ¶ªÂºÄ
                </div>
                <div class="park-item">
                    <img src="./assets/monopoly/1.png" />
                    <img src="./assets/monopoly/3.png" />
                    <img src="./assets/monopoly/5.png" />
                    ‰∏ãÂõûÂêàÁªßÁª≠
                </div>
            </div>
            <div class="park-footer">
                <div class="park-dice">
                    <img src="./assets/monopoly/5.png" />
                </div>
                <div class="game-btn-confirm">ÂºÄÂßãËΩ¨Âä®</div>
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 500px;
                padding: 0 10px 13px;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .park-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .park-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .park-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .park-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            }

            .park-item img {
                height: 30px
            }

            .park-item img:last-child {
                margin-right: 10px;
            }

            .park-footer {
                display: flex;
                justify-content: space-between;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
            }

            .park-dice {
                display: flex;
                align-items: center;
            }
        </style>
    </template>
    <template id="role-template">
        <div class="role-header">
            <div class="role-header-title">
                ËßíËâ≤ÈÄâÊã©
            </div>
        </div>
        <div class="role-body">
            <div class="role-item-container"></div>
            <div class="target-item-container"></div>
            <div class="target-hint">
                ËæìÂÖ•Ë¥¢ÂØå„ÄÅÂêçË™â„ÄÅÂø´‰πêÁöÑÈ¢ÑÂÆöÁõÆÊ†áÔºåË¥¢ÂØå1000ÂÖÉ‰∏∫1ÂàÜÔºå‰∏âÈ°πÁõÆÊ†áÂä†Ëµ∑Êù•ÂøÖÈ°ªÂàöÂ•Ω60ÂàÜ„ÄÇ
            </div>
            <div class="game-btn-confirm">Á°ÆËÆ§ÈÄâÊã©</div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 0 4px 0 0;
                transition: top .5s linear;
            }

            :host(.close) {
                top: -100%;
            }

            .role-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .role-body {
                margin: 0 10px 13px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                overflow-x: hidden;
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .role-item-container {
                display: flex;
                width: 100%;
                justify-content: space-between;
            }

            .role-item {
                display: flex;
                flex: 1;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                padding: 20px;
                margin: 20px 10px;
            }

            .role-item.active {
                background-color: #2776ec2f;
            }

            .role-item-name {
                margin-top: 10px;
                display: flex;
                justify-content: center;
            }

            .role-item-avatar {
                height: 60px;
                width: 60px;
                border-radius: 50%;
                background-size: contain;
            }

            .target-item-container {
                display: flex;
                width: 100%;
                padding-bottom: 20px;
            }

            .target-item {
                display: flex;
                flex-direction: column;
                flex: 1;
                align-items: center;
            }

            .target-item input {
                width: 70px;
                outline: none;
                border-top: 0;
                border-left: 0;
                border-right: 0;
                border-width: 1px;
                border-color: #2e2e2e;
                background-color: transparent;
                margin-left: 5px;
                text-align: center;
            }

            .target-item.error input {
                border-color: #cc0000;
            }

            .target-item.valid input {
                border-color: #00cc00;
            }


            .target-item-content {
                display: flex;
                align-items: center;
                margin-bottom: 5px;
            }

            .target-hint {
                width: 100%;
                font-size: 14px;
                margin-bottom: 20px;
                margin-left: 20px;
            }
        </style>
    </template>
    <template id="lottery-template">
        <div class="lottery-header">
            <div class="lottery-header-title">
                Ë¥≠‰π∞ÂΩ©Á•®
            </div>
        </div>
        <div class="lottery-content">
            <div class="lottery-message">
                ÊØè‰∫∫ÂèØËΩÆÊµÅÈÄâÊã©ÊòØÂê¶ÊâßË°å‰ª•‰∏ãÂä®‰ΩúÔºöÊé∑‰∏ÄÈ¢óÈ™∞Âπ∂Ê†πÊçÆÊé∑Âá∫ÁÇπÊï∞Â§±ÂéªÊàñËé∑ÂæóÈáëÈí±
            </div>
            <div class="lottery-list">
                <div class="lottery-item">
                    <div style="width:200px">
                        <img src="./assets/monopoly/1.png" />
                        <img src="./assets/monopoly/2.png" />
                        <img src="./assets/monopoly/3.png" />
                        <img src="./assets/monopoly/4.png" />
                    </div>
                    <div class="flex-row-center" style="color:red">
                        <img src="./assets/monopoly-life/riches.png" />-1000ÂÖÉ
                    </div>
                </div>
                <div class="lottery-item">
                    <div style="width:200px">
                        <img src="./assets/monopoly/5.png" />
                        <img src="./assets/monopoly/6.png" />
                    </div>
                    <div class="flex-row-center" style="color:green">
                        <img src="./assets/monopoly-life/riches.png" />+5000ÂÖÉ
                    </div>
                </div>
            </div>
            <div class="lottery-player-list">
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                padding: 0px 10px 13px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .lottery-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .lottery-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .lottery-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .lottery-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            }

            .lottery-item img {
                height: 30px
            }

            .lottery-item img:last-child {
                margin-right: 10px;
            }

            .lottery-footer {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .player-item {
                display: flex;
                align-items: center;
                box-sizing: border-box;
                position: relative;
            }

            .player-item .player-avatar {
                width: 40px;
                height: 40px;
                background-size: contain;
                border-radius: 50%;
                margin-right: 20px;
            }


            .player-operate {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
            }

            .operate-item .game-btn-confirm:last-child {
                background-color: #a1a1a1;
                margin-left: 10px;
            }

            .operate-item {
                display: flex;
                align-items: center;
            }

            .operate-dice {
                margin-right: 20px;
                display: flex;
                align-items: center;
            }
        </style>
    </template>
    <template id="lottery-template-player-operate-internal">
        <div class="player-operate">
            <div class="player-item">
                <div class="player-avatar">
                </div>
                <div class="player-name"></div>
            </div>
            <div class="operate-item">
                <div class="operate-dice">
                    <img src="./assets/monopoly/5.png" />
                </div>
                <div class="game-btn-confirm">Ë¥≠‰π∞</div>
                <div class="game-btn-confirm">ÊîæÂºÉ</div>
            </div>
        </div>
    </template>
    <template id="stock-template">
        <div class="stock-header">
            <div class="stock-header-title">
                ËÇ°Á•®Â∏ÇÂú∫
            </div>
        </div>

        <!-- <div class="logo">
            <img src="./assets/monopoly-life/stock.png" />
        </div> -->
        <div class="stock-content">
            <div class="stock-message">
                ÊØè‰∫∫ÂèØËΩÆÊµÅÈÄâÊã©ÊòØÂê¶ÊâßË°å‰ª•‰∏ãÂä®‰ΩúÔºö
            </div>
            <div class="stock-list">
                <span style="color: red;">-2000ÂÖÉ </span>Âπ∂‰∏î<span style="color: green;">+üé≤√ó1000ÂÖÉ</span>
            </div>
            <div class="stock-player-list">
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                padding-left: 10px;
                padding-right: 10px;
                padding-bottom: 10px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .stock-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .stock-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }


            .stock-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .stock-list {
                margin-bottom: 20px;
            }

            .stock-footer {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .player-item {
                display: flex;
                align-items: center;
                box-sizing: border-box;
                position: relative;
            }

            .player-item .player-avatar {
                width: 40px;
                height: 40px;
                background-size: contain;
                border-radius: 50%;
                margin-right: 20px;
            }


            .player-operate {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
            }

            .operate-item .game-btn-confirm:last-child {
                margin-left: 10px;
            }

            .operate-item {
                display: flex;
                align-items: center;
            }

            .operate-dice {
                margin-right: 20px;
                display: flex;
                align-items: center;
            }
        </style>
    </template>
    <template id="stock-template-player-operate-internal">
        <div class="player-operate">
            <div class="player-item">
                <div class="player-avatar">
                </div>
                <div class="player-name"></div>
            </div>
            <div class="operate-item">
                <div class="operate-dice">
                    <img src="./assets/monopoly/5.png" />
                </div>
                <div class="game-btn-confirm">Ë¥≠‰π∞</div>
                <div class="game-btn-confirm">ÊîæÂºÉ</div>
            </div>
        </div>
    </template>
    <template id="mall-template">
        <div class="mall-header">
            <div class="mall-header-title">
                ÂïÜÂú∫
            </div>
        </div>
        <div class="mall-content">
            <div class="mall-message">
                Â§ßËÇÜÈááË¥≠ÊâÄÊúâ‰∫∫ÈÉΩË¶ÅÊâßË°åÔºö
            </div>
            <div class="mall-list">
                <span style="color: red;">-üé≤√ó300ÂÖÉ</span>
            </div>
            <div class="mall-player-list">
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                padding-left: 10px;
                padding-right: 10px;
                padding-bottom: 10px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .mall-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .mall-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }


            .mall-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .mall-list {
                margin-bottom: 20px;
            }

            .mall-footer {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .player-item {
                display: flex;
                align-items: center;
                box-sizing: border-box;
                position: relative;
            }

            .player-item .player-avatar {
                width: 40px;
                height: 40px;
                background-size: contain;
                border-radius: 50%;
                margin-right: 20px;
            }


            .player-operate {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
            }

            .operate-item {
                display: flex;
                align-items: center;
            }

            .operate-dice {
                margin-right: 20px;
                display: flex;
                align-items: center;
            }
        </style>
    </template>
    <template id="mall-template-player-operate-internal">
        <div class="player-operate">
            <div class="player-item">
                <div class="player-avatar">
                </div>
                <div class="player-name"></div>
            </div>
            <div class="operate-item">
                <div class="operate-dice">
                    <img src="./assets/monopoly/5.png" />
                </div>
                <div class="game-btn-confirm">ÊäïÊé∑</div>
            </div>
        </div>
    </template>
    <template id="gallery-template">
        <div class="gallery-header">
            <div class="gallery-header-title">
                ÁîªÂªä
            </div>
        </div>
        <div class="gallery-content">
            <div class="gallery-message">
                ÊØè‰∫∫ÂèØËΩÆÊµÅÈÄâÊã©ÊòØÂê¶ÊâßË°å‰ª•‰∏ãÂä®‰ΩúÔºö
            </div>
            <div class="gallery-list">
                <div class="flex-row-center">
                    <div style="color: red;">-3000ÂÖÉ</div>Âπ∂‰∏î
                    <div class="flex-row-center" style="color: green;">+üé≤√ó<img
                            src="./assets/monopoly-life/happy.png" /></div>
                </div>
            </div>
            <div class="gallery-player-list">
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                padding-left: 10px;
                padding-right: 10px;
                padding-bottom: 10px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .gallery-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .gallery-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }


            .gallery-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .gallery-list {
                margin-bottom: 20px;
            }

            .gallery-footer {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .player-item {
                display: flex;
                align-items: center;
                box-sizing: border-box;
                position: relative;
            }

            .player-item .player-avatar {
                width: 40px;
                height: 40px;
                background-size: contain;
                border-radius: 50%;
                margin-right: 20px;
            }


            .player-operate {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
            }

            .operate-item .game-btn-confirm:last-child {
                margin-left: 10px;
            }

            .operate-item {
                display: flex;
                align-items: center;
            }

            .operate-dice {
                margin-right: 20px;
                display: flex;
                align-items: center;
            }
        </style>
    </template>
    <template id="gallery-template-player-operate-internal">
        <div class="player-operate">
            <div class="player-item">
                <div class="player-avatar">
                </div>
                <div class="player-name"></div>
            </div>
            <div class="operate-item">
                <div class="operate-dice">
                    <img src="./assets/monopoly/5.png" />
                </div>
                <div class="game-btn-confirm">ÊäïÊé∑</div>
                <div class="game-btn-confirm">ÊîæÂºÉ</div>
            </div>
        </div>
    </template>
    <template id="wishing-template">
        <div class="wishing-header">
            <div class="wishing-header-title">
                ËÆ∏ÊÑø‰∫ï
            </div>
        </div>
        <div class="wishing-content">
            <div class="wishing-message">
                ÊØè‰∫∫ÂèØËΩÆÊµÅÈÄâÊã©ÊòØÂê¶ÊâßË°å‰ª•‰∏ãÂä®‰ΩúÔºö
            </div>
            <div class="wishing-message">
                ‰ªòÂá∫Â∑¶ËæπÂàó‰∏æÁöÑ‰∏ÄÈ°πÔºåËé∑ÂæóÂè≥ËæπÂàó‰∏æÁöÑ‰∏ÄÈ°π
            </div>
            <div class="wishing-player-list">
            </div>
        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                /* width: 600px; */
                padding-left: 10px;
                padding-right: 10px;
                padding-bottom: 10px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .wishing-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .wishing-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }


            .wishing-message {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .wishing-list {
                margin-bottom: 20px;
            }

            .wishing-footer {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .wishing-player-list {
                display: flex;
            }

            .player-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                box-sizing: border-box;
                position: relative;
            }

            .player-item .player-avatar {
                width: 40px;
                height: 40px;
                background-size: contain;
                border-radius: 50%;
            }


            .player-operate {
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
                margin-right: 10px;
            }

            .player-operate:last-child {
                margin-right: 0;
            }

            .operate-item .game-btn-confirm:last-child {
                margin-left: 10px;
            }

            .operate-item {
                display: flex;
                align-items: center;
            }

            .operate-dice {
                margin-right: 20px;
                display: flex;
                align-items: center;
            }

            .select-list {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                width: 150px;
                margin: 10px 0;
            }

            .select-item {
                display: flex;
                width: calc(50% - 5px);
                background-color: rgb(233, 227, 220);
                justify-content: center;
                align-items: center;
                padding: 3px 0;
                margin-top: 4px;
            }

            .select-item img {
                width: 20px;
                height: 20px;
            }

            .select-item.active {
                background-color: rgb(232, 139, 26);
            }
        </style>
    </template>
    <template id="wishing-template-player-operate-internal">
        <div class="player-operate">
            <div class="player-item">
                <div class="player-avatar"></div>
                <div class="player-name"></div>
            </div>

            <div class="select-list">
                <div class="select-item left active" data-happy="-5">
                    -5<img src="./assets/monopoly-life/happy.png" />
                </div>
                <div class="select-item right active" data-happy="4">
                    +4<img src="./assets/monopoly-life/happy.png" />
                </div>
                <div class="select-item left" data-repute="-5">
                    -5<img src="./assets/monopoly-life/repute.png" />
                </div>
                <div class="select-item right" data-repute="4">
                    +4<img src="./assets/monopoly-life/repute.png" />
                </div>
                <div class="select-item left" data-riches="-5000">
                    -5000ÂÖÉ
                </div>
                <div class="select-item right" data-riches="4000">
                    +4000ÂÖÉ
                </div>
            </div>
            <div class="operate-item">
                <div class="game-btn-confirm">ËÆ∏ÊÑø</div>
                <div class="game-btn-confirm">ÊîæÂºÉ</div>
            </div>
        </div>
    </template>
    <template id="dialog-template">
        <div class="dialog-header">
            <div class="dialog-header-title">
                ÂØπËØùÊ°Ü
            </div>
        </div>
        <div class="dialog-body">
            <div class="dialog-body-content">
                ËØ∑ÈÄâÊã©‰Ω†ÊÉ≥Ë¶ÅÁöÑÈÄâÈ°π
            </div>
            <div class="dialog-body-options">
                <div class="dialog-body-option">
                    A
                </div>
                <div class="dialog-body-option">
                    B
                </div>
                <div class="dialog-body-option">
                    C
                </div>
            </div>
        </div>

        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
                width: 500px;
                transition: top .5s linear;
            }

            :host(.close) {
                top: -100%;
            }


            .dialog-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .dialog-body {
                margin: 0 10px 13px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                overflow-x: hidden;

                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .dialog-body-option {
                margin-top: 10px;
                display: flex;
                align-items: center;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
                cursor: pointer;
                justify-content: center;
            }

            .dialog-body-content img {
                width: 100%;
            }

            .rank {
                display: flex;
                flex-direction: column;
                padding: 10px;
            }

            .rank .rank-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            }

            .rank .rank-item-icon {
                position: relative;
            }

            .rank .player-avatar {
                width: 60px;
                height: 60px;
                border-radius: 50%;
            }

            .rank .rank-icon {
                width: 40px;
                height: 40px;
                position: absolute;
                left: -15px;
                top: -15px;
            }

            .rank .rank-item-content {
                flex: 1;
                padding-left: 10px;
            }

            .rank .rank-item-completion {
                font-weight: bold;
                padding: 0 10px;
            }

            .rank .player-name {
                font-weight: bold;
            }

            .rank .rank-item.hidden {
                display: none;
            }
        </style>
    </template>
    <template id="dialog-template-rank-internal">
        <div class="rank">
            <div class="rank-item">
                <div class="rank-item-icon">
                    <img src="./assets/monopoly/black.jpg" class="player-avatar">
                    <img src="./assets/monopoly-life/rank1.svg" class="rank-icon">
                </div>
                <div class="rank-item-content">
                    <div class="player-name">Â∞èÈªë</div>
                </div>
                <div class="rank-item-completion">
                    ÁõÆÊ†áÂÆåÊàêÂ∫¶: 100%
                </div>
            </div>
            <div class="rank-item">
                <div class="rank-item-icon">
                    <img src="./assets/monopoly/black.jpg" class="player-avatar">
                    <img src="./assets/monopoly-life/rank2.svg" class="rank-icon">
                </div>
                <div class="rank-item-content">
                    <div class="player-name">Â∞èÈªë</div>
                </div>
                <div class="rank-item-completion">
                    100%
                </div>
            </div>
            <div class="rank-item">
                <div class="rank-item-icon">
                    <img src="./assets/monopoly/black.jpg" class="player-avatar">
                    <img src="./assets/monopoly-life/rank3.svg" class="rank-icon">
                </div>
                <div class="rank-item-content">
                    <div class="player-name">Â∞èÈªë</div>
                </div>
                <div class="rank-item-completion">
                    100%
                </div>
            </div>
            <div class="rank-item">
                <div class="rank-item-icon">
                    <img src="./assets/monopoly/black.jpg" class="player-avatar">
                </div>
                <div class="rank-item-content">
                    <div class="player-name">Â∞èÈªë</div>
                </div>
                <div class="rank-item-completion">
                    100%
                </div>
            </div>
        </div>
    </template>
    <template id="chance-template">
        <div class="chance-header">
            <div class="chance-header-title">
                Êú∫‰ºö
            </div>
        </div>
        <div class="chance-body">
            <div class="chance-body-content">
                ÊÅ≠ÂñúËé∑Âæó‰ª•‰∏ãÂ•ñÂä±
            </div>
            <div class="chance-body-card-list">
                <div class="chance-body-card">
                    <img src="./assets/monopoly-life/chance.png">
                    <div>xxxxx</div>
                </div>
                <div class="chance-body-card">
                    <img src="./assets/monopoly-life/chance.png">
                    <div>xxxxx</div>
                </div>
            </div>
            <div class="chance-footer">
                <div class="game-btn-confirm">ÂÖ≥Èó≠</div>
            </div>
        </div>

        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
                width: 500px;
            }

            :host(.close) {
                top: -100%;
            }


            .chance-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .chance-body {
                margin: 0 10px 13px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                overflow-x: hidden;

                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .chance-body-content img {
                width: 100%;
            }

            .chance-body-card {
                display: flex;
                align-items: center;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
                width: calc(100% - 20px);
                margin-top: 10px;
            }

            .chance-body-card>img {
                width: 40px;
                margin-right: 10px;
            }

            .chance-footer {
                margin-top: 10px;
                display: flex;
                justify-content: center;
            }
        </style>
    </template>
    <template id="card-holder-template">
        <div class="card-holder-header">
            <div class="card-holder-header-title">
                Âç°ÂåÖ
            </div>
        </div>
        <div class="card-holder-body">
            <div class="card-holder-body-content">
                ÈÄâÊã©‰∏ÄÂº†Âç°Áâá‰ΩøÁî®
            </div>
            <div class="card-holder-body-card-list">
                <div class="card-holder-body-card">
                    <img src="./assets/monopoly-life/chance.png">
                    <div>xxxxx</div>
                    <div class="game-btn-confirm">‰ΩøÁî®</div>
                </div>
            </div>
            <div class="card-holder-footer">
                <div class="game-btn-confirm">ÂÖ≥Èó≠</div>
            </div>
        </div>

        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
                width: 500px;
            }

            :host(.close) {
                top: -100%;
            }


            .card-holder-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .card-holder-body {
                margin: 0 10px 13px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                overflow-x: hidden;

                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .card-holder-body-card-list {
                max-height: 400px;
                overflow-y: auto;
            }

            .card-holder-body-content img {
                width: 100%;
            }

            .card-holder-body-card {
                display: flex;
                align-items: center;
                background-color: rgb(207, 199, 190);
                padding: 10px;
                border-radius: 4px;
                width: calc(100% - 20px);
                margin-top: 10px;
            }

            .card-holder-body-card>img {
                width: 40px;
                margin-right: 10px;
            }

            .card-holder-body-card>div:not(.game-btn-confirm) {
                flex: 1;
                margin-right: 10px;
            }

            .card-holder-footer {
                margin-top: 10px;
                display: flex;
                justify-content: center;
            }
        </style>
    </template>
    <template id="travel-mode-template">
        <div class="travel-mode-header">
            <div class="travel-mode-header-title">
                Âá∫Ë°åÊñπÂºè
            </div>
        </div>
        <div class="travel-mode-content">
            <div class="travel-mode-message">
                ËØ∑ÈÄâÊã©‰Ω†ÁöÑÊñπÂºèÔºö
            </div>

            <div class="travel-mode-btn-list">
                <div class="travel-mode-btn">
                    <div class="travel-mode-btn-icon">
                        <img src="./assets/monopoly-life/dice.png">
                    </div>
                    <div class="travel-mode-btn-text">Êé∑È™∞Â≠ê</div>
                </div>


                <div class="travel-mode-btn">
                    <div class="travel-mode-btn-icon">
                        <img src="./assets/monopoly-life/chance.png">
                        <img src="./assets/monopoly-life/experience.png">
                    </div>
                    <div class="travel-mode-btn-text">ÈÅìÂÖ∑Âç°</div>
                </div>
            </div>

        </div>
        <style>
            :host {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                /* width: 600px; */
                padding-left: 10px;
                padding-right: 10px;
                padding-bottom: 10px;
                transition: top .5s linear;
                background-color: rgb(66, 136, 167);
                box-shadow: inset 0px -3px 0 rgb(4, 70, 98);
                border-radius: 4px;
            }

            :host(.close) {
                top: -100%;
            }

            .travel-mode-header-title {
                line-height: 40px;
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                color: rgb(252, 255, 254);
                text-shadow: 0px 2px 0 rgb(78, 75, 67);
            }

            .travel-mode-content {
                background-color: rgb(233, 227, 220);
                border-radius: 4px;
                padding: 10px;
            }

            .travel-mode-btn-list {
                display: flex;
            }

            .travel-mode-btn {
                padding: 20px;
                margin: 10px;
                display: flex;
                align-items: center;
                flex-direction: column;
                background-color: rgb(207, 199, 190);
            }

            .travel-mode-btn:active {
                opacity: .7;
            }

            .travel-mode-btn:first-child .travel-mode-btn-icon {
                text-align: center;
            }

            .travel-mode-btn-icon {
                width: 60px;
                height: 50px;
                position: relative;
            }


            .travel-mode-btn-icon img {
                width: 50px;
            }

            .travel-mode-btn-icon img+img {
                position: absolute;
                width: 50px;
                bottom: 0;
                left: 10px;
            }
        </style>
    </template>
    <template id="map-template">
        <div class="map-container"></div>
        <style>
            :host {
                position: absolute;
                left: 0;
                top: 0;
                background-size: contain;
            }

            :host(.anim) {
                transition: all .2s linear;
            }

            .station-item {
                position: absolute;
                border: 2px solid #00cc00;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .player-item {
                display: inline-flex;
            }

            .player-avatar {
                margin: 10px;
                width: 60px;
                height: 60px;
                background-size: contain;
                border-radius: 50%;
            }

            .player-item.active .player-avatar {
                border-width: 5px;
                border-style: solid;
            }
        </style>
    </template>
    <script type="module">
        import { cloneDeep } from "https://gcore.jsdelivr.net/npm/@3r/tool/lib/common.js";
        import { Maths } from "https://gcore.jsdelivr.net/npm/@3r/tool/lib/maths.js";
        import { Randoms } from "https://gcore.jsdelivr.net/npm/@3r/tool/lib/randoms.js";

        // Â¢ûÂä†ÁßªÈô§ÊñπÊ≥ï
        Array.prototype.remove = function (obj) {
            let removeIndex = this.findIndex(o => o == obj)
            return this.splice(removeIndex, 1)
        }

        /** Ëé∑ÂèñÊï∞Â≠ó
         * @param {string} str 
         */
        function getNumber(str) {
            return +str.match(/[-\d]{0,}/)[0]
        }

        /** Âä†ËΩΩÂõæ
         * @param {string} src
         * @returns {Promise<HTMLImageElement>}
         */
        function loadImage(src) {
            return new Promise((resolve) => {
                let image = new Image()
                image.src = src;
                image.onload = (ev) => {
                    resolve(image)
                }
            })
        }

        /** ÊãñÊãΩÂÖÉÁ¥†
         * @param {HTMLImageElement} dom
         * @param {{minX:number,maxX:number,minY:number,maxY:number}} options
         */
        function dragging(dom, options) {
            // ÂºÄÂßãÂùêÊ†á‰ΩçÁΩÆ
            let startX = 0;
            let startY = 0;
            let startLeft = 0;
            let startTop = 0;
            let isMove = false;

            dom.classList.add('anim')

            dom.addEventListener("mousedown", ev => {
                // ÁßªÈô§Âä®ÁîªÊ†áÁ≠æ
                dom.classList.remove('anim')

                startX = ev.x;
                startY = ev.y;
                startLeft = getNumber(dom.style.left);
                startTop = getNumber(dom.style.top);
                isMove = true;
            })

            dom.addEventListener("mousemove", ev => {
                if (!isMove) return;
                let left = startLeft + ev.x - startX;
                let top = startTop + ev.y - startY;
                left = Maths.inRange(left, options.minX, options.maxX)
                top = Maths.inRange(top, options.minY, options.maxY)
                dom.style.left = left + 'px';
                dom.style.top = top + 'px';
            })

            dom.addEventListener("mouseup", ev => {
                // Â¢ûÂä†Âä®ÁîªÊ†áÁ≠æ
                dom.classList.add('anim')
                isMove = false;
            })

            let screenWidth = document.body.clientWidth
            let screenHeight = document.body.clientHeight

            /**
             * @param {HTMLDivElement} target
             */
            const lookAt = async function (target) {
                let left = - (target.offsetLeft + target.offsetWidth / 2 - screenWidth / 2)
                let top = - (target.offsetTop + target.offsetHeight / 2 - screenHeight / 2)
                left = Maths.inRange(left, options.minX, options.maxX)
                top = Maths.inRange(top, options.minY, options.maxY)
                dom.style.left = left + 'px';
                dom.style.top = top + 'px';
            }

            return {
                lookAt
            }
        }

        /** Á≠âÂæÖÂ§ö‰πÖ 
         */
        function wait(ms) {
            return new Promise((resolve) => {
                setTimeout(resolve, ms)
            })
        }

        /** Ê®°ÊùøÂä†ËΩΩ
         * @param {string} selectors 
         * @param {boolean} isInternal ÊòØÂê¶ÊòØÂÜÖÈÉ®Ê®°Êùø
         */
        function templateLoad(selectors, isInternal = false) {
            let template = document.querySelector(selectors)
            /** @type {HTMLDivElement}*/
            let clone = document.importNode(template.content, true);
            if (isInternal) return clone
            let container = document.createElement('div')
            container.id = Randoms.uuid();
            let shadowRoot = container.attachShadow({ mode: "open" });
            shadowRoot.appendChild(clone)
            // Âä†ËΩΩÂÖ®Â±ÄÊ†∑Âºè
            const globalStyleSheets = new CSSStyleSheet()
            for (let i = 0; i < document.styleSheets.length; i++) {
                const styleSheet = document.styleSheets.item(i);
                const rules = styleSheet.rules
                for (let j = 0; j < rules.length; j++) {
                    const rule = rules.item(j);
                    globalStyleSheets.insertRule(rule.cssText)
                }
            }
            shadowRoot.adoptedStyleSheets = [globalStyleSheets]
            // ‰ªÖËæìÂá∫ÂÆø‰∏ªËäÇÁÇπ
            // ÂΩ±Â≠êËäÇÁÇπÂèØ‰ª•ÈÄöËøá container.shadowRoot.querySelector ËøõË°åÊü•ËØ¢
            return container
        }

        /**
         * ËßÇÂØüÂèòÈáè
         */
        function observeVariable(func) {
            let variable = {}
            let variableProxy = new Proxy(variable, {
                get(variable, prop) {
                    return variable[prop]
                },
                async set(variable, prop, value) {
                    variable[prop] = value;
                    await func?.(variable, prop, value)
                },
            })
            return variableProxy
        }


        /** Áé©ÂÆ∂Ë°åÂä®ÁæéÂâß */
        const PlayerActionEnum = {
            /** ÈªòËÆ§ */
            NONE: 0,
            /** ÂÜçÊ¨° */
            AGAIN: 1,
            /** ÊöÇÂÅú */
            PAUSE: -1
        }

        /** Âç°ÁâáÁ±ªÂûã */
        const ChanceCardType = {
            /** Êú∫‰ºö */
            CHANCE: 1,
            /** ÁªèÈ™å */
            EXPERIENCE: 2,
        }

        /** ËØÅ‰π¶Á±ªÂûã */
        const CredentialType = {
            /** ÊôÆÈÄö */
            NORMAL: 1,
            /** ÂåªÂ≠¶ */
            MEDICINE: 2,
            /** Ê≥ïÂæã */
            LAW: 3,
            /** Â∑•Á®ã */
            ENGINEERING: 4,
            /** ÁßëÂ≠¶ */
            SCIENCE: 5
        }

        /** ‰ΩçÁΩÆÁ±ªÂûãÊûö‰∏æ */
        const PositionTypeEnum = {
            /** ÁéØÈÅì */
            LOOP: 1,
            /** ÂÜú‰∏ö */
            AGRICULTURE: 2,
            /** Â§ßÂ≠¶ */
            UNIVERSITY: 3,
            /** ‰ºÅ‰∏ö */
            ENTERPRISE: 4,
            /** Ëà™Ë°å */
            VOYAGE: 5,
            /** ÂÖ¨Áõä */
            WELFARE: 6,
            /** ÂΩ±ËßÜ */
            MOVIES: 7,
            /** ÈááÁüø */
            MINING: 8,
            /** Â§™Á©∫ */
            SPACE: 9
        }

        /** ÁªèÈ™åÁ±ªÂûã */
        const ExperienceType = {
            /** ÂÜú‰∏ö */
            AGRICULTURE: 2,
            /** ‰ºÅ‰∏ö */
            ENTERPRISE: 4,
            /** Ëà™Ë°å */
            VOYAGE: 5,
            /** ÂÖ¨Áõä */
            WELFARE: 6,
            /** ÂΩ±ËßÜ */
            MOVIES: 7,
            /** ÈááÁüø */
            MINING: 8,
            /** Â§™Á©∫ */
            SPACE: 9
        }
        /** ËØÅ‰π¶ÂØπÂ∫îÁªèÈ™å */
        const CredentialToExperience = {
            [CredentialType.NORMAL]: ExperienceType.ENTERPRISE,
            [CredentialType.SCIENCE]: ExperienceType.SPACE,
            [CredentialType.LAW]: ExperienceType.WELFARE,
            [CredentialType.ENGINEERING]: ExperienceType.MINING,
        }

        /** ÂõæÁâáÈÖçÁΩÆ */
        const ICON_CONFIG = {
            RICHES: `<img src="./assets/monopoly-life/riches.png" />`,
            SALARY: `<img src="./assets/monopoly-life/salary.png" />`,
            REPUTE: `<img src="./assets/monopoly-life/repute.png" />`,
            HAPPY: `<img src="./assets/monopoly-life/happy.png" /> `,
            ARROW: `<img src="./assets/monopoly-life/arrow.png" />`,
            EXPERIENCE: `<img src="./assets/monopoly-life/experience.png"/>`,
            CHANCE: `<img src="./assets/monopoly-life/chance.png"/>`,
        }

        class Credential {
            name = ""
            type = CredentialType.NORMAL
            /**
             * @param {Credential} cre
             */
            constructor(cre) {
                for (const key in cre) {
                    this[key] = cre[key]
                }
            }
        }

        class Experience {
            name = ""
            type = ExperienceType.AGRICULTURE
            /**
             * @param {Experience} exp
             */
            constructor(exp) {
                for (const key in exp) {
                    this[key] = exp[key]
                }
            }
        }

        class Role {
            id = Randoms.uuid()
            name = ''
            avatar = ''
            color = ''
            targetRiches = 0
            targetRepute = 0;
            targetHapply = 0
            /**
             * @param {Role} role
             */
            constructor(role) {
                for (const key in role) {
                    this[key] = role[key]
                }
            }
        }

        class Player extends Role {
            /** Ë¥¢ÂØå */
            riches = 5000
            /** Ëñ™Ê∞¥ */
            salary = 2000
            /** Â£∞Êúõ */
            repute = 0;
            /** Âπ∏Á¶è */
            happy = 0;

            /** ‰ΩçÁΩÆ */
            position = 0;
            /** ‰ΩçÁΩÆÁ±ªÂûã */
            positionType = PositionTypeEnum.LOOP
            /** ÂéÜÂè≤ËÆ∞ÂΩï */
            // history = []
            /** Ë°åÂä®Áä∂ÊÄÅ */
            actionState = PlayerActionEnum.NONE
            /** Ê∏∏ÊàèËÉúÂà© */
            win = false

            /** @type {ChanceCard[]} */
            cardHolder = []
            /** @type {Credential[]} */
            credentials = []
            /** @type {Experience[]} */
            experiences = []
            /**
             * @param {Player} player
             */
            constructor(player) {
                super(player)
                for (const key in player) {
                    this[key] = player[key]
                }
            }
        }

        class PlayerChanged {
            /** Ë¥¢ÂØå */
            riches = 0
            /** Ëñ™Ê∞¥ */
            salary = 0
            /** Â£∞Êúõ */
            repute = 0
            /** Âπ∏Á¶è */
            happy = 0
            /** Ë°åÂä®Áä∂ÊÄÅ */
            actionState = PlayerActionEnum.NONE
        }

        class ChanceCard {
            id = '';
            name = ''
            description = ''
            passive = false;
            type = ChanceCardType.CHANCE;
            useDice = false;
            /** ÂÖçÁñ´ */
            immunity = PositionTypeEnum.AGRICULTURE
            /** @param {Player} player */
            /** @param {Player[]} rival */
            use = (player, rival) => { }
            /**
             * @param {ChanceCard} card
             */
            constructor(card) {
                for (const key in card) {
                    this[key] = card[key]
                }
            }
        }

        class SceneStation {
            /** @type {Player} */
            curPlayer = null
            /** @type {Player[]} */
            allPlayers = []
            dicePoints = 0
        }

        class Station {
            /** @type {string} */
            id = ""
            /** @type {string} */
            left = ""
            /** @type {string} */
            top = ""
            /** @type {string} */
            width = ""
            /** @type {string} */
            height = ""
            /** @type {string} */
            name = ""
            /** @type {string} */
            description = ""
            /** @type {HTMLDivElement} */
            dom = null
            /**
             * ÁªèËøá
             * @param {SceneStation} scene
             */
            via‚Äå = (scene) => { }
            /**
             * ÂÅúÊ≠¢
             * @param {SceneStation} scene
             */
            stop = (scene) => { }
            /**
             * Á¶ªÂºÄ
             * @param {SceneStation} scene
             */
            leave
            /**
             * @param {Station} station
             */
            constructor(station) {
                for (const key in station) {
                    this[key] = station[key]
                }
            }
        }




        /** Êó•ÂøóÊéß‰ª∂ Â∑¶‰∏ãËßí
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const logContainer = function () {
            const fragment = templateLoad('#log-template')
            const closeDom = fragment.shadowRoot.querySelector('.log-icon-close')
            const bodyDom = fragment.shadowRoot.querySelector('.log-body')
            closeDom.addEventListener('click', () => fragment.classList.toggle('close'))
            /** Á™óÂè£Êó•ÂøóÊâìÂç∞
             * @param {string} str
             */
            const log = (str) => {
                bodyDom.innerHTML += `<div class="log-item">${str}</div>`
                bodyDom.scrollTop = Number.MAX_SAFE_INTEGER;
            }
            return {
                fragment,
                log
            }
        }();

        /** Áé©ÂÆ∂Êéß‰ª∂ Âè≥‰∏äËßí
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const playerContainer = function () {
            const fragment = templateLoad("#player-template")
            fragment.classList.add('close');

            /**
             * Ê£ÄÊü•ÂÆåÊàêÂ∫¶ 
             * @param {Player} player
             */
            let checkCompletion = player => {
                let richeCompletion = player.riches / 1000 / (player.targetRiches || 1)
                let happyCompletion = player.happy / (player.targetHapply || 1);
                let reputeCompletion = player.repute / (player.targetRepute || 1)

                richeCompletion = Math.min(1, richeCompletion)
                happyCompletion = Math.min(1, happyCompletion)
                reputeCompletion = Math.min(1, reputeCompletion)

                return {
                    player,
                    completion: richeCompletion * happyCompletion * reputeCompletion,
                    richeCompletion,
                    happyCompletion,
                    reputeCompletion
                }
            }


            /**
             * Ê£ÄÊü•Áé©ÂÆ∂Á†¥‰∫ß
             * @param {Player} player
             */
            let checkBankruptcy = async player => {
                if (player.riches < 0) {
                    player.riches = 0;
                    upd([player])
                    logContainer.log(`Áé©ÂÆ∂[${player.name}]Á†¥‰∫ß‰∫ÜÔºåÁßªÂä®Âà∞ÂÖ¨Âõ≠`)
                    await dialogContainer.open({
                        title: 'Á†¥‰∫ß',
                        content: `<img src="./assets/monopoly-life/bankruptcy.jpeg"/>`,
                        options: ['ÂÖ≥Èó≠']
                    })
                    await mapContainer.flash(player, "LOOP", 24)
                }
            }


            /**
             * Ê£ÄÊü•Áé©ÂÆ∂ÊòØÂê¶ËÉúÂà©
             * @param {Player[]} allPlayers
             */
            let checkWin = async allPlayers => {
                let completionList = allPlayers.map(p => checkCompletion(p))
                // ÂÆåÊàêÂ∫¶Â§ß‰∫é‰∏Ä Ê∏∏ÊàèÁªìÊùü
                if (completionList.some(c => c.completion == 1)) {
                    completionList.sort((a, b) => b.completion - a.completion)

                    const firstPlayer = completionList[0].player
                    logContainer.log(`Áé©ÂÆ∂[${firstPlayer.name}]ÁéáÂÖàËææÊàêÁõÆÊ†áÔºåÊ∏∏ÊàèÁªìÊùü`)
                    let rankDom = templateLoad('#dialog-template-rank-internal', true).querySelector(".rank")
                    let rankItemList = rankDom.querySelectorAll('.rank-item')

                    rankItemList.forEach((rankItem, index) => {
                        let completion = completionList[index]
                        if (completion) {
                            let playerAvatarDom = rankItem.querySelector('.player-avatar')
                            let playerNameDom = rankItem.querySelector('.player-name')
                            let completionDom = rankItem.querySelector('.rank-item-completion')
                            playerAvatarDom.setAttribute('src', completion.player.avatar)
                            playerNameDom.textContent = completion.player.name
                            completionDom.textContent = `ÁõÆÊ†áÂÆåÊàêÂ∫¶Ôºö${(completion.completion * 100).toFixed(2)}%`
                        }
                        else rankItem.classList.add('hidden')
                    })
                    let selected = await dialogContainer.open({
                        title: 'ÊéíË°åÊ¶ú',
                        content: rankDom.outerHTML,
                        options: ["ÈáçÊñ∞ÂºÄÂßã"]
                    })

                    // ÈáçÊñ∞ÂºÄÂßãÂà∑Êñ∞È°µÈù¢
                    if (selected == 0) {
                        location.reload()
                    }
                }
            }


            /**
             * Áé©ÂÆ∂Âä†ÂÖ•
             * @param {Player[]} players
             */
            let join = async (players) => {
                for (const player of players) {
                    let playerItemDom = templateLoad('#player-template-player-item-internal', true).querySelector('.player-item')
                    playerItemDom.setAttribute('data-id', player.id)
                    playerItemDom.querySelector('.player-avatar').setAttribute('style', `background-image:url(${player.avatar})`)
                    playerItemDom.querySelector('.player-riches .player-value').textContent = player.riches
                    playerItemDom.querySelector('.player-salary .player-value').textContent = player.salary
                    playerItemDom.querySelector('.player-repute .player-value').textContent = player.repute
                    playerItemDom.querySelector('.player-happy .player-value').textContent = player.happy
                    playerItemDom.querySelector('.target-riches .player-value').textContent = player.targetRiches * 1000
                    playerItemDom.querySelector('.target-repute .player-value').textContent = player.targetRepute
                    playerItemDom.querySelector('.target-happy .player-value').textContent = player.targetHapply
                    fragment.shadowRoot.appendChild(playerItemDom)
                }
                fragment.classList.remove('close')
            }

            /**
             * Áé©ÂÆ∂Êõ¥Êñ∞
             * @param {Player[]} players
             */
            let upd = async (players) => {

                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    let dom = fragment.shadowRoot.querySelector(`.player-item[data-id="${player.id}"]`)
                    dom.querySelector('.player-riches .player-value').textContent = player.riches
                    dom.querySelector('.player-salary .player-value').textContent = player.salary
                    dom.querySelector('.player-repute .player-value').textContent = player.repute
                    dom.querySelector('.player-happy .player-value').textContent = player.happy
                    dom.querySelector('.player-chance .player-value').textContent = player.cardHolder.filter(c => c.type === ChanceCardType.CHANCE).length
                    dom.querySelector('.player-experience .player-value').textContent = player.cardHolder.filter(c => c.type === ChanceCardType.EXPERIENCE).length


                    let playerCreBodyDom = dom.querySelector('.player-cre-body')
                    let playerExpBodyDom = dom.querySelector('.player-exp-body')

                    playerCreBodyDom.innerHTML = ``;
                    player.credentials.forEach(c => {
                        playerCreBodyDom.innerHTML += `<div class="player-icon" title="${c.name}">${c.name[0]}</div>`
                    })
                    if (!playerCreBodyDom.innerHTML) playerCreBodyDom.innerHTML = `<div class="player-icon none">Êó†</div>`

                    playerExpBodyDom.innerHTML = ``;
                    console.log(player.experiences);
                    player.experiences.forEach(c => {
                        playerExpBodyDom.innerHTML += `<div class="player-icon" title="${c.name}">${c.name[0]}</div>`
                    })
                    if (!playerExpBodyDom.innerHTML) playerExpBodyDom.innerHTML = `<div class="player-icon none">Êó†</div>`

                }
            }

            /**
             * ‰∏ã‰∏Ä‰∏™Áé©ÂÆ∂
             * @param {Player} player
             */
            let next = async (player) => {
                let lastDom = fragment.shadowRoot.querySelector('.player-item.active');
                let currDom = fragment.shadowRoot.querySelector(`.player-item[data-id="${player.id}"]`);
                if (lastDom) lastDom.classList.remove('active')
                currDom.classList.add('active')
            }

            return {
                fragment,
                join,
                upd,
                next,
                checkBankruptcy,
                checkWin
            }
        }();

        /** È™∞Â≠êÊéß‰ª∂ ÂºπÁ™ó
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const diceContainer = await async function () {
            const fragment = templateLoad('#dice-template')
            fragment.classList.add('close')

            const diceImages = await Promise.all([
                './assets/monopoly/1.png',
                './assets/monopoly/2.png',
                './assets/monopoly/3.png',
                './assets/monopoly/4.png',
                './assets/monopoly/5.png',
                './assets/monopoly/6.png',
            ].map(u => loadImage(u)))
            /** @type {HTMLDivElement} */
            const diceItemContainerDom = fragment.shadowRoot.querySelector('.dice-item-container')
            /** @type {HTMLDivElement} */
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            /**
             * @param {HTMLImageElement} dom
             */
            const roll = async (dom) => {
                let result = 0;
                for (let i = 0; i < 15; i++) {
                    await wait(100);
                    const val = Randoms.int(0, 6)
                    dom.setAttribute('src', `${diceImages[val].src}`)
                    result = val + 1
                }
                return result;
            }
            /** 
             * @param {number} count
             * @return {Promise<number>}
             */
            const open = (count) => {
                return new Promise((resolve) => {
                    for (let i = 0; i < diceItemContainerDom.children.length; i++) {
                        const dom = diceItemContainerDom.children.item(i)
                        dom.classList.add('hidden')
                    }
                    for (let i = 0; i < count; i++) {
                        /** @type {HTMLDivElement} */
                        const dom = diceItemContainerDom.children.item(i)
                        dom.classList.remove('hidden')
                        dom.setAttribute('src', `${diceImages[0].src}`)
                    }
                    fragment.classList.remove('close')

                    const confirmFunc = async function () {
                        // ÊâßË°åüé≤
                        const diceItemDomList = diceItemContainerDom.querySelectorAll('.dice-item:not(.hidden)')
                        // Âæ™ÁéØ15Ê¨°Á∫¶Á≠â‰∫é1.5s
                        const allRoll = []
                        // Âæ™ÁéØÂä†ÂÖ•
                        diceItemDomList.forEach(item => allRoll.push(roll(item)))
                        const total = Maths.sum(await Promise.all(allRoll))
                        await wait(500)
                        fragment.classList.add('close')
                        resolve(total)
                    }
                    confirmDom.removeEventListener("click", confirmFunc)
                    confirmDom.addEventListener("click", confirmFunc)
                })
            }
            return {
                fragment,
                open,
                roll
            }
        }()


        /**
         * ËßíËâ≤Êéß‰ª∂ ÂºπÁ™ó
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const roleContainer = await async function () {
            const roleList = [
                new Role({
                    name: 'Â∞èÈªë',
                    avatar: './assets/monopoly/black.jpg',
                    color: 'black'
                }),
                new Role({
                    name: 'Â∞èÁ∫¢',
                    avatar: './assets/monopoly/red.jpg',
                    color: 'red'
                }),
                new Role({
                    name: 'Â∞èÈªÑ',
                    avatar: './assets/monopoly/yellow.jpg',
                    color: 'yellow'
                }),
                new Role({
                    name: 'Â∞èËìù',
                    avatar: './assets/monopoly/blue.jpg',
                    color: 'blue'
                })
            ]
            let roleItemHtml = ``
            let targetItemHtml = ``
            for (let i = 0; i < roleList.length; i++) {
                const role = roleList[i];
                roleItemHtml += `
                    <div class="role-item active">
                        <div class="role-item-avatar" style="background-image:url(${role.avatar})"></div>
                        <div class="role-item-name">${role.name}</div>
                    </div> 
                `
                targetItemHtml += `
                    <div class="target-item">
                        <div class="target-item-content">
                            ${ICON_CONFIG.RICHES}
                            <input type="number" placeholder="Ë¥¢ÂØå" max="60" min="0" step="1"/>
                        </div>
                        <div class="target-item-content">
                            ${ICON_CONFIG.REPUTE}  
                            <input type="number" placeholder="ÂêçË™â" max="60" min="0" step="1"/>
                        </div>
                        <div class="target-item-content">
                            ${ICON_CONFIG.HAPPY}
                            <input type="number" placeholder="Âø´‰πê" max="60" min="0" step="1"/>
                        </div>
                    </div>
                `
            }
            const fragment = templateLoad("#role-template")
            fragment.classList.add('close')
            const roleItemContainerDom = fragment.shadowRoot.querySelector('.role-item-container')
            const targetItemContainerDom = fragment.shadowRoot.querySelector('.target-item-container')
            roleItemContainerDom.innerHTML = roleItemHtml
            targetItemContainerDom.innerHTML = targetItemHtml
            roleItemContainerDom.querySelectorAll('.role-item').forEach((dom) => {
                dom.addEventListener('click', function () {
                    if (dom.classList.contains('active')) {
                        if (roleItemContainerDom.querySelectorAll('.role-item.active').length < 3) return
                        dom.classList.remove('active')
                    }
                    else {
                        dom.classList.add('active')
                    }
                })
            })
            /** @type {HTMLDivElement} */
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            /**
             * @return {Promise<roles[]>}
             */
            const open = () => {
                fragment.classList.remove('close')
                logContainer.log('ËØ∑ÈÄâÊã©ËßíËâ≤Â°´ÂÜôÂêÑËá™ÁöÑÁõÆÊ†áÂÄº')
                return new Promise((resolve) => {
                    confirmDom.addEventListener("click", () => {
                        let selected = []
                        let roles = roleItemContainerDom.querySelectorAll('.role-item')
                        let targets = targetItemContainerDom.querySelectorAll('.target-item')
                        let valid = true
                        roles.forEach((role, roleIndex) => {
                            let target = targets.item(roleIndex)
                            target.classList.remove('error')
                            target.classList.remove('valid')
                            if (role.classList.contains('active')) {
                                let inputs = target.querySelectorAll('input')
                                let targetRiches = +inputs.item(0).value
                                let targetRepute = +inputs.item(1).value
                                let targetHapply = +inputs.item(2).value
                                selected.push(new Role({
                                    ...roleList[roleIndex],
                                    targetRiches,
                                    targetRepute,
                                    targetHapply
                                }))
                                if (targetRiches + targetRepute + targetHapply != 60) {
                                    target.classList.add('error')
                                    valid = false;
                                }
                                else {
                                    target.classList.add('valid')
                                    valid = true
                                }
                            }
                        })

                        if (valid) {
                            fragment.classList.add('close')
                            resolve(selected);
                        }
                    })

                })
            }
            return {
                fragment,
                open
            }
        }()


        /**
         * ÊàòÊñóÊéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const fightContainer = await async function () {
            const open = () => {
                // p1 vs p2

                // Êé∑È™∞Â≠ê

                // ÁªìÊûú
            }

            return {
                open
            }
        }()


        /**
         * Ëé∑ÂèñÊú∫‰ºö[ÁªèÈ™å]Âç°Êéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const chanceContainer = await async function () {
            const fragment = templateLoad('#chance-template')
            fragment.classList.add('close')
            /**
             * @type {ChanceCard[]}
             */
            let changeList = [
                {
                    id: "1",
                    name: "Ëà™Êµ∑",
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞Ëà™Êµ∑ÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 14)
                },
                {
                    id: "2",
                    name: "Â§ßÂ≠¶Ëøõ‰øÆ",
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞Â§ßÂ≠¶ÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 7)
                },
                {
                    id: '3',
                    name: 'ÁîµÂΩ±ÊãçÊëÑ',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞ÁîµÂΩ±ÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 22)
                },
                {
                    id: '4',
                    name: '‰∏â‰∫öÂ∫¶ÂÅá',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞‰∏â‰∫öÂ∫¶ÂÅá„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 16)
                },
                {
                    id: '5',
                    name: 'Â∞ñÁ´ØÁßëÊäÄ',
                    description: 'Âú®Â§™Á©∫Êé¢Èô©ËÅå‰∏öÈÅìË∑Ø‰∏≠ÔºåËã•ÈÅáÂà∞‰ªª‰ΩïÊçüÂ§±ÊïàÊûúÔºåÂ±ïÁ§∫Ê≠§Âç°Â∞±ÁÆóÊó†‰∫ã„ÄÇÔºàÂèØÈáçÂ§ç‰ΩøÁî®Ôºâ',
                    passive: true,
                    immunity: PositionTypeEnum.SPACE
                },
                {
                    id: '6',
                    name: 'ÈááÁüøÂºÄÂèë',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞ÈááÁüøÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 27)

                },
                {
                    id: '7',
                    name: 'Êìç‰ΩúÁÜüÁªÉ',
                    description: 'Âú®ÈááÁüøÂºÄÂèëËÅå‰∏öÈÅìË∑Ø‰∏≠ÔºåËã•ÈÅáÂà∞‰ªª‰ΩïÊçüÂ§±ÊïàÊûúÔºåÂ±ïÁ§∫Ê≠§Âç°Â∞±ÁÆóÊó†‰∫ã„ÄÇÔºàÂèØÈáçÂ§ç‰ΩøÁî®Ôºâ',
                    passive: true,
                    immunity: PositionTypeEnum.MINING

                },
                {
                    id: '8',
                    name: 'Ë∂ÖÁ∫ß‰∫∫Êâç',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞‰ªª‰ΩïËÅå‰∏öÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => {
                        let options = [
                            {
                                name: 'Ëà™Êµ∑',
                                func: async () => await mapContainer.flash(player, "LOOP", 14)
                            },
                            {
                                name: 'ÈááÁüøÂºÄÂèë',
                                func: async () => await mapContainer.flash(player, "LOOP", 27)
                            },
                            {
                                name: 'ÁîµÂΩ±ÊãçÊëÑ',
                                func: async () => await mapContainer.flash(player, "LOOP", 22)
                            },
                            {
                                name: 'Â§ßÂ≠¶Ëøõ‰øÆ',
                                func: async () => await mapContainer.flash(player, "LOOP", 7)
                            },
                            {
                                name: 'ÂÖ¨Áõä‰∫ã‰∏ö',
                                func: async () => await mapContainer.flash(player, "LOOP", 19)
                            },
                            {
                                name: 'ÂÜú‰∏öÂºÄÂû¶',
                                func: async () => await mapContainer.flash(player, "LOOP", 4)
                            },
                            {
                                name: 'Â§™Á©∫Êé¢Èô©',
                                func: async () => await mapContainer.flash(player, "LOOP", 30)
                            },
                            {
                                name: '‰ºÅ‰∏öÁªèËê•',
                                func: async () => await mapContainer.flash(player, "LOOP", 11)
                            }
                        ]

                        let selected = await dialogContainer.open({
                            title: 'ËΩ¨Êç¢Ë∑ëÈÅì',
                            content: 'ÈÄâÊã©‰∏Ä‰∏™Áé©ÂÆ∂ËøõË°åÊäΩÂèñ',
                            options: options.map(a => a.name)
                        })
                        await options[selected].func()
                    }
                },
                {
                    id: '9',
                    name: 'ÂÖ¨Áõä‰∫ã‰∏ö',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞ÂÖ¨ÁõäÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 19)
                },
                {
                    id: '10',
                    name: 'ÂÜú‰∏öÂºÄÂû¶',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞ÂÜú‰∏öÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 4)
                },
                {
                    id: '11',
                    name: 'Â§™Á©∫Êé¢Èô©',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞Â§™Á©∫ÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 30)
                },
                {
                    id: '12',
                    name: 'ËΩ¨Êç¢Ë∑ëÈÅì',
                    description: '‰ªéÂà´‰∫∫Êâã‰∏äÊäΩËµ∞‰∏ÄÂº†Êú∫‰ºöÂç°ÊàñÁªèÈ™åÂç°ÔºåÁÑ∂ÂêéÊé∑È™∞ÂâçËøõ',
                    useDice: true,
                    /**
                     * @param {Player} player
                     * @param {Player[]} rival
                     */
                    use: async (player, rival) => {

                        const hasCardRival = rival.filter(a => a.cardHolder.length)
                        const options = hasCardRival.map(r => r.name)
                        options.push('ÂèñÊ∂à')

                        let selected = await dialogContainer.open({
                            title: 'ËΩ¨Êç¢Ë∑ëÈÅì',
                            content: 'ÈÄâÊã©‰∏Ä‰∏™Áé©ÂÆ∂ËøõË°åÊäΩÂèñ',
                            options
                        })

                        let selectedOption = options[selected]

                        if (selectedOption === 'ÂèñÊ∂à') {
                            logContainer.log(`Áé©ÂÆ∂[${player.name}]ÂèñÊ∂à‰ΩøÁî®ÈÅìÂÖ∑Âç°`)
                        }
                        else {
                            logContainer.log(`Áé©ÂÆ∂[${player.name}]‰ΩøÁî®ÈÅìÂÖ∑Âç°`)
                            let rivalItem = hasCardRival.find(r => r.name === selectedOption)
                            let randomCardIndex = Randoms.int(0, rivalItem.cardHolder.length)
                            let card = rivalItem.cardHolder.splice(randomCardIndex, 1)[0]
                            player.cardHolder.push(card)
                            playerContainer.upd([player, rivalItem])
                            logContainer.log(`Áé©ÂÆ∂[${rivalItem.name}]Â§±ÂéªÈÅìÂÖ∑Âç°[${card.name}]`)
                            logContainer.log(`Áé©ÂÆ∂[${player.name}]ÂæóÂà∞ÈÅìÂÖ∑Âç°[${card.name}]`)
                        }
                    }
                },
                {
                    id: '13',
                    name: '‰ºÅ‰∏öÁªèËê•',
                    description: '‰∏çÊé∑È™∞ÔºåÁõ¥Êé•ÁßªÂä®Âà∞‰ºÅ‰∏öÂÖ•Âè£„ÄÇËã•Á¨¶ÂêàÊù°‰ª∂Ôºå‰∏ãÂõûÂêàÂèØËøõÂÖ•ËÅå‰∏öÈÅìË∑Ø„ÄÇ',
                    use: async (player) => await mapContainer.flash(player, "LOOP", 11)
                },
                {
                    id: '14',
                    name: 'ÊâãËÖïÈ´òÊòé',
                    description: 'Âú®ÁîµÂΩ±ÊãçÊëÑËÅå‰∏öÈÅìË∑Ø‰∏≠ÔºåËã•ÈÅáÂà∞‰ªª‰ΩïÊçüÂ§±ÊïàÊûúÔºåÂ±ïÁ§∫Ê≠§Âç°Â∞±ÁÆóÊó†‰∫ã„ÄÇÔºàÂèØÈáçÂ§ç‰ΩøÁî®Ôºâ',
                    passive: true,
                    immunity: PositionTypeEnum.MOVIES
                },
                {
                    id: '15',
                    name: 'ÁúºÂÖâÁ≤æÂáÜ',
                    description: 'Âú®‰ºÅ‰∏öÁªèËê•ËÅå‰∏öÈÅìË∑Ø‰∏≠ÔºåËã•ÈÅáÂà∞‰ªª‰ΩïÊçüÂ§±ÊïàÊûúÔºåÂ±ïÁ§∫Ê≠§Âç°Â∞±ÁÆóÊó†‰∫ã„ÄÇÔºàÂèØÈáçÂ§ç‰ΩøÁî®Ôºâ',
                    passive: true,
                    immunity: PositionTypeEnum.ENTERPRISE
                },
            ].map(c => new ChanceCard(c))

            let experienceList = [
                {
                    id: '16',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∏ÄÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 1)
                },
                {
                    id: '17',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∏ÄÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 1)
                },
                {
                    id: '18',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∏ÄÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 1)
                },
                {
                    id: '19',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∫åÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 2)
                },
                {
                    id: '20',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∫åÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 2)

                },
                {
                    id: '21',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∫åÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 2)
                },
                {
                    id: '22',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∏âÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 3)
                },
                {
                    id: '23',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∏âÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 3)
                },
                {
                    id: '24',
                    description: '‰∏çÊé∑È™∞ÔºåÂêëÂâçÁßªÂä®‰∏âÊ†º„ÄÇ',
                    use: async (player) => await mapContainer.move(player, 3)
                }
            ].map(c => new ChanceCard({ ...c, type: ChanceCardType.EXPERIENCE }))

            /**
             * ÊâìÂºÄËé∑Âèñ
             * @param {Player} player
             * @param {string} type
             * @param {number} count
             */
            const open = async (player, type, count) => {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    const titleDom = fragment.shadowRoot.querySelector('.chance-header-title')
                    const cardList = cloneDeep(type == ChanceCardType.CHANCE ? changeList : experienceList)
                    const cardIcon = type == ChanceCardType.CHANCE ? ICON_CONFIG.CHANCE : ICON_CONFIG.EXPERIENCE
                    titleDom.textContent = type == ChanceCardType.CHANCE ? 'Êú∫‰ºö' : 'ÁªèÈ™å'
                    const cardListDom = fragment.shadowRoot.querySelector(".chance-body-card-list")
                    const closeDom = fragment.shadowRoot.querySelector(".game-btn-confirm")
                    cardListDom.innerHTML = ''
                    const resultList = Randoms.confusion(cardList).slice(0, count)

                    // Ê∏∏ÊàèÊó•Âøó

                    player.cardHolder.push(...resultList)
                    playerContainer.upd([player])

                    resultList.forEach((card) => {
                        const cardDom = document.createElement('div')
                        const cardTxtDom = document.createElement('div')
                        cardDom.innerHTML = cardIcon
                        cardTxtDom.textContent = card.description;
                        cardDom.classList.add('chance-body-card')
                        cardDom.appendChild(cardTxtDom)
                        cardListDom.appendChild(cardDom)
                    })
                    const closeFunc = () => {
                        fragment.classList.add('close')
                        resolve(resultList)
                    }
                    closeDom.removeEventListener('click', closeFunc)
                    closeDom.addEventListener('click', closeFunc)
                })
            }

            return {
                fragment,
                open
            }
        }()


        /**
         * Âç°ÂåÖÊéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const cardHolderContainer = await async function () {
            const fragment = templateLoad('#card-holder-template')
            fragment.classList.add('close')
            /**
             * ÊâìÂºÄËé∑Âèñ
             * @param {Player} player
             * @param {Player[]} rival ÂØπÊâã
             * @returns {Promise<{useDice:boolean}>}
             */
            const open = function (player, rival) {
                return new Promise((resolve) => {
                    fragment.classList.remove('close')
                    let cardListDom = fragment.shadowRoot.querySelector('.card-holder-body-card-list')
                    let closeDom = fragment.shadowRoot.querySelector('.card-holder-footer .game-btn-confirm')
                    cardListDom.innerHTML = ''
                    player.cardHolder.forEach(function (card) {
                        let cardDom = document.createElement('div')
                        let textDom = document.createElement('div')
                        cardDom.classList.add('card-holder-body-card')
                        textDom.textContent = card.description
                        cardDom.innerHTML = card.type == ChanceCardType.CHANCE ? ICON_CONFIG.CHANCE : ICON_CONFIG.EXPERIENCE
                        cardDom.appendChild(textDom)
                        cardListDom.appendChild(cardDom)

                        if (!card.passive) {
                            let btnDom = document.createElement('div')
                            btnDom.classList.add('game-btn-confirm')
                            btnDom.textContent = '‰ΩøÁî®'
                            btnDom.addEventListener('click', async () => {
                                fragment.classList.add('close')
                                await card?.use(player, rival)
                                player.cardHolder.remove(card)
                                resolve({ useDice: card.useDice })
                            })
                            cardDom.appendChild(btnDom)
                        }
                    })

                    let closeFunc = () => {
                        fragment.classList.add('close')
                        resolve({ useDice: true })
                    }
                    closeDom.removeEventListener('click', closeFunc)
                    closeDom.addEventListener('click', closeFunc)
                })
            }

            return {
                fragment,
                open
            }
        }()



        /**
         * ÂåªÈô¢Êéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-12-12
         */
        const hospitalContainer = await async function () {
            const fragment = templateLoad('#hospital-template')
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            /**
             * @return {Promise<number>}
             */
            const open = function () {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    const confirmFunc = async function () {
                        // ÊâßË°åüé≤
                        /** @type {HTMLImageElement} */
                        const diceItemDom = fragment.shadowRoot.querySelector('.hospital-dice img')
                        // ÁªìÊûú
                        let total = await diceContainer.roll(diceItemDom)
                        await wait(500)
                        fragment.classList.add('close')
                        resolve(total)
                    }
                    confirmDom.removeEventListener("click", confirmFunc)
                    confirmDom.addEventListener("click", confirmFunc)
                })
            }

            return {
                fragment,
                open
            }
        }()

        /**
         * ÂÖ¨Âõ≠Êéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-12-12
         */
        const parkContainer = await async function () {
            const fragment = templateLoad("#park-template")
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            /**
             * @return {Promise<number>}
             */
            const open = function () {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    const confirmFunc = async function () {
                        // ÊâßË°åüé≤
                        /** @type {HTMLImageElement} */
                        const diceItemDom = fragment.shadowRoot.querySelector('.park-dice img')
                        // ÁªìÊûú
                        let total = await diceContainer.roll(diceItemDom)
                        await wait(500)
                        fragment.classList.add('close')
                        resolve(total)
                    }
                    confirmDom.removeEventListener("click", confirmFunc)
                    confirmDom.addEventListener("click", confirmFunc)
                })
            }

            return {
                fragment,
                open
            }
        }()


        /**
         * ÂΩ©Á•®Â∫óÊéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-12-16
         */
        const lotteryContainer = await async function () {
            const fragment = templateLoad("#lottery-template")
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            const lotteryPlayerListDom = fragment.shadowRoot.querySelector('.lottery-player-list')

            /**
             * @param {Player[]} players
             * @return {Promise<number>}
             */
            const open = function (players) {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    let resultProxy = observeVariable(async (result) => {
                        if (Object.keys(result).length === players.length) {
                            await wait(500);
                            fragment.classList.add('close')
                            await wait(500);
                            resolve(Object.values(result))
                        }
                    })
                    lotteryPlayerListDom.innerHTML = ''
                    players.forEach(function (player, index) {
                        let playerFragment = templateLoad('#lottery-template-player-operate-internal', true)
                        let playerOperateDom = playerFragment.querySelector('.player-operate')
                        playerOperateDom.querySelector('.player-avatar').setAttribute('style', `background-image:url(${player.avatar});border-color:${player.color}`)
                        playerOperateDom.querySelector('.player-name').textContent = player.name

                        let operateItemDom = playerOperateDom.querySelector('.operate-item')
                        let confirmListDom = playerOperateDom.querySelectorAll('.game-btn-confirm')
                        let buyDom = confirmListDom.item(0);
                        let abandonDom = confirmListDom.item(1)
                        lotteryPlayerListDom.appendChild(playerFragment)
                        const buyFunc = async () => {
                            let operateDiceDom = operateItemDom.querySelector('.operate-dice img')
                            buyDom.remove();
                            abandonDom.remove()
                            let total = await diceContainer.roll(operateDiceDom)


                            if (total > 4) {
                                let riches = 5000;
                                operateItemDom.innerHTML = `${ICON_CONFIG.RICHES}<span style="color:green">+${riches}ÂÖÉ</span>`
                                resultProxy[index] = riches
                            }
                            else {
                                let riches = -1000;
                                operateItemDom.innerHTML = `${ICON_CONFIG.RICHES}<span style="color:red">${riches}ÂÖÉ</span>`
                                resultProxy[index] = riches
                            }
                        }
                        buyDom.addEventListener("click", buyFunc)
                        const abandonFunc = () => {
                            operateItemDom.innerHTML = `ÊîæÂºÉ`
                            resultProxy[index] = 0
                        }
                        abandonDom.addEventListener("click", abandonFunc)
                    })
                })
            }

            return {
                fragment,
                open
            }
        }()

        /**
         * ËÇ°Á•®Â∏ÇÂú∫
         * @author 	 linyisonger
         * @date 	 2024-12-12
         */
        const stockContainer = await async function () {
            const fragment = templateLoad("#stock-template")
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            const stockPlayerListDom = fragment.shadowRoot.querySelector('.stock-player-list')

            /**
             * @param {Player[]} players
             * @return {Promise<number>}
             */
            const open = function (players) {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    let resultProxy = observeVariable(async (result) => {
                        if (Object.keys(result).length === players.length) {
                            await wait(500);
                            fragment.classList.add('close')
                            await wait(500);
                            resolve(Object.values(result))
                        }
                    })

                    stockPlayerListDom.innerHTML = ''
                    players.forEach(function (player, index) {
                        let playerFragment = templateLoad('#stock-template-player-operate-internal', true)
                        let playerOperateDom = playerFragment.querySelector('.player-operate')
                        playerOperateDom.querySelector('.player-avatar').setAttribute('style', `background-image:url(${player.avatar});border-color:${player.color}`)
                        playerOperateDom.querySelector('.player-name').textContent = player.name

                        let operateItemDom = playerOperateDom.querySelector('.operate-item')
                        let confirmListDom = playerOperateDom.querySelectorAll('.game-btn-confirm')
                        let buyDom = confirmListDom.item(0);
                        let abandonDom = confirmListDom.item(1)
                        stockPlayerListDom.appendChild(playerFragment)
                        const buyFunc = async () => {
                            let operateDiceDom = operateItemDom.querySelector('.operate-dice img')
                            buyDom.remove();
                            abandonDom.remove()
                            let total = await diceContainer.roll(operateDiceDom)
                            resultProxy[index] = -2000 + total * 1000
                            if (resultProxy[index] > 0) {
                                operateItemDom.innerHTML = `${ICON_CONFIG.RICHES}<span style="color:green">+${resultProxy[index]}ÂÖÉ</span>`
                            }
                            else if (resultProxy[index] < 0) {
                                operateItemDom.innerHTML = `${ICON_CONFIG.RICHES}<span style="color:red">${resultProxy[index]}ÂÖÉ</span>`
                            }
                            else {
                                operateItemDom.innerHTML = `Êó†ÂèòÂåñ`
                            }
                        }
                        buyDom.addEventListener("click", buyFunc)
                        const abandonFunc = () => {
                            operateItemDom.innerHTML = `ÊîæÂºÉ`
                            resultProxy[index] = 0
                        }
                        abandonDom.addEventListener("click", abandonFunc)

                    })
                })
            }

            return {
                fragment,
                open
            }
        }();


        /**
         * ÂïÜÂú∫
         * @author 	 linyisonger
         * @date 	 2024-12-12
         */
        const mallContainer = await async function () {
            const fragment = templateLoad("#mall-template")
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            const mallPlayerListDom = fragment.shadowRoot.querySelector('.mall-player-list')

            /**
             * @param {Player[]} players
             * @return {Promise<number>}
             */
            const open = function (players) {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    let resultProxy = observeVariable(async (result) => {
                        if (Object.keys(result).length === players.length) {
                            await wait(500);
                            fragment.classList.add('close')
                            await wait(500);
                            resolve(Object.values(result))
                        }
                    })

                    mallPlayerListDom.innerHTML = ''
                    players.forEach(function (player, index) {
                        let playerFragment = templateLoad('#mall-template-player-operate-internal', true)
                        let playerOperateDom = playerFragment.querySelector('.player-operate')
                        playerOperateDom.querySelector('.player-avatar').setAttribute('style', `background-image:url(${player.avatar});border-color:${player.color}`)
                        playerOperateDom.querySelector('.player-name').textContent = player.name

                        let operateItemDom = playerOperateDom.querySelector('.operate-item')
                        let confirmListDom = playerOperateDom.querySelectorAll('.game-btn-confirm')
                        let buyDom = confirmListDom.item(0);
                        mallPlayerListDom.appendChild(playerFragment)
                        const buyFunc = async () => {
                            let operateDiceDom = operateItemDom.querySelector('.operate-dice img')
                            buyDom.remove();
                            let total = await diceContainer.roll(operateDiceDom)
                            resultProxy[index] = -total * 300
                            operateItemDom.innerHTML = `${ICON_CONFIG.RICHES}<span style="color:red">${resultProxy[index]}ÂÖÉ</span>`
                        }
                        buyDom.addEventListener("click", buyFunc)
                    })
                })
            }

            return {
                fragment,
                open
            }
        }();


        /**
         * ÁîªÂªä
         * @author 	 linyisonger
         * @date 	 2024-12-12
         */
        const galleryContainer = await async function () {
            const fragment = templateLoad("#gallery-template")
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            const mallPlayerListDom = fragment.shadowRoot.querySelector('.gallery-player-list')

            /**
             * @param {Player[]} players
             * @return {Promise<{ player: Player, changed:PlayerChanged }[]>}
             */
            const open = function (players) {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    /** @type {{[key:string]:{player: Player, changed:PlayerChanged}}} */
                    let resultProxy = observeVariable(async (result) => {
                        if (Object.keys(result).length === players.length) {
                            await wait(500);
                            fragment.classList.add('close')
                            await wait(500);
                            resolve(Object.values(result))
                        }
                    })

                    mallPlayerListDom.innerHTML = ''
                    players.forEach(function (player, index) {
                        let playerFragment = templateLoad('#gallery-template-player-operate-internal', true)
                        let playerOperateDom = playerFragment.querySelector('.player-operate')
                        playerOperateDom.querySelector('.player-avatar').setAttribute('style', `background-image:url(${player.avatar});border-color:${player.color}`)
                        playerOperateDom.querySelector('.player-name').textContent = player.name

                        let operateItemDom = playerOperateDom.querySelector('.operate-item')
                        let confirmListDom = playerOperateDom.querySelectorAll('.game-btn-confirm')
                        let buyDom = confirmListDom.item(0);
                        let abandonDom = confirmListDom.item(1);
                        mallPlayerListDom.appendChild(playerFragment)
                        const buyFunc = async () => {
                            let operateDiceDom = operateItemDom.querySelector('.operate-dice img')
                            buyDom.remove();
                            let total = await diceContainer.roll(operateDiceDom)
                            resultProxy[index] = {
                                player,
                                changed: {
                                    riches: - 3000,
                                    happy: +total
                                }
                            }
                            operateItemDom.innerHTML = `<span style="color:red">+${+total}</span>${ICON_CONFIG.HAPPY}`
                        }
                        buyDom.addEventListener("click", buyFunc)
                        const abandonFunc = () => {
                            operateItemDom.innerHTML = `ÊîæÂºÉ`
                            resultProxy[index] = null
                        }
                        abandonDom.addEventListener("click", abandonFunc)
                    })
                })
            }

            return {
                fragment,
                open
            }
        }();

        /**
         * ÂØπËØùÊ°ÜÊéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-12-03
         */
        const dialogContainer = function () {
            const fragment = templateLoad('#dialog-template')
            fragment.classList.add('close')

            class DialogOpenConfig {
                title = ''
                content = ''
                options = []
            }

            /**
             * ÊâìÂºÄÂºπÁ™ó
             * @param {DialogOpenConfig} config
             */
            const open = function (config) {
                return new Promise((resolve) => {
                    fragment.classList.remove('close')
                    const titleDom = fragment.shadowRoot.querySelector('.dialog-header-title')
                    const contentDom = fragment.shadowRoot.querySelector('.dialog-body-content')
                    const optionsDom = fragment.shadowRoot.querySelector('.dialog-body-options')
                    titleDom.textContent = config.title;
                    contentDom.innerHTML = config.content
                    optionsDom.innerHTML = '';
                    for (let i = 0; i < config.options.length; i++) {
                        const option = config.options[i];
                        const optionDom = document.createElement('div')
                        optionDom.classList.add('dialog-body-option')
                        optionDom.innerHTML = option
                        optionDom.addEventListener("click", function () {
                            fragment.classList.add('close')
                            resolve(i)
                        })
                        optionsDom.appendChild(optionDom)
                    }
                })

            }

            return {
                fragment,
                open
            }
        }()

        /**
         * Âú∞ÂõæÊéß‰ª∂
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        const mapContainer = await async function () {
            let fragment = templateLoad('#map-template')
            let screenWidth = document.body.clientWidth
            let screenHeight = document.body.clientHeight

            // Âä†ËΩΩÂõæÁâáËÉåÊôØ
            let mapImage = await loadImage('./assets/monopoly-life/map.jpg')
            fragment.style.backgroundImage = `url(${mapImage.src})`
            fragment.style.width = mapImage.width / 2 + 'px'
            fragment.style.height = mapImage.height / 2 + 'px'
            // Ê∫¢Âá∫Ë∑ùÁ¶ª
            let overflowDistance = 100
            let { lookAt } = dragging(fragment, { minX: -mapImage.width / 2 + screenWidth - overflowDistance, maxX: 0 + overflowDistance, minY: -mapImage.height / 2 + screenHeight - overflowDistance, maxY: 0 + overflowDistance })

            class EmploymentEntranceCondition {
                /** Ë¥¢ÂØå */
                riches = 0
            }

            /**
             * Êï∞ÂÄºÂèòÂåñ
             * @param {Player} player
             * @param {PlayerChanged} changed
             */
            async function playerChange(player, changed) {
                if (Maths.sum(Object.values(changed)) == 0) {
                    logContainer.log(`Áé©ÂÆ∂[${player.name}]Ê≤°Êúâ‰ªª‰ΩïÂèòÂåñ`)
                    return
                }; // Ê≤°ÊúâÂèëÁîüÊîπÂèò
                let str = `<div class="flex-row-center">Áé©ÂÆ∂[${player.name}]`
                if (changed.riches) {
                    str += `${ICON_CONFIG.RICHES}`
                    if (changed.riches > 0) str += `<span style="color:green">+${changed.riches}ÂÖÉ</span>`
                    else str += `<span style="color:red">${changed.riches}ÂÖÉ</span>`
                    player.riches += changed.riches
                }
                if (changed.salary) {
                    str += `${ICON_CONFIG.SALARY}`
                    if (changed.salary > 0) str += `<span style="color:green">+${changed.salary}ÂÖÉ</span>`
                    else str += `<span style="color:red">${changed.salary}ÂÖÉ</span>`
                    player.salary += changed.salary
                }
                if (changed.happy) {
                    if (changed.happy > 0) str += `<span style="color:green">+${changed.happy}</span>`
                    else str += `<span style="color:red">${changed.happy}</span>`
                    str += `${ICON_CONFIG.HAPPY}`
                    player.happy += changed.happy
                }
                if (changed.repute) {
                    if (changed.repute > 0) str += `<span style="color:green">+${changed.repute}</span>`
                    else str += `<span style="color:red">${changed.repute}</span>`
                    str += `${ICON_CONFIG.REPUTE}`
                    player.repute += changed.repute
                }
                if (changed.actionState === PlayerActionEnum.AGAIN) str += '<span style="color:green">ÂÜçÊù•‰∏ÄÊ¨°</span>'
                if (changed.actionState === PlayerActionEnum.PAUSE) str += '<span style="color:red">ÊöÇÂÅú‰∏ÄÊ¨°</span>'
                str += '</div>'
                logContainer.log(str)
                await playerContainer.upd([player])
            }

            /**
             * Ë°®Ê†ºÂ±ïÁ§∫
             * @param {SceneStation} scene 
             */
            function table(scene) {
                // ÊòØÂê¶Á∫ØÊñáÊú¨
                let isText = !/<td.*?>/.test(this.description);
                let description = this.description;
                if (isText) description = description && `<tr><td>${description}</td></tr>`
                const table = `
                    <table class="log-item-table">
                        <tbody>
                            <tr>
                                <td colspan="${isText ? 1 : 2}">${this.name}</td>
                            </tr>
                            ${description}
                        </tbody>
                    </table>
                `

                console.log(table);
                logContainer.log(`Áé©ÂÆ∂[${scene.curPlayer.name}]Ëß¶Âèë‰∫ã‰ª∂${table}`)
            }

            /**
             * È¢ÜÂèñÂ∑•ËµÑ
             * @param {SceneStation} scene 
             */
            async function salaryCollection(scene) {
                table.call(this, scene)
                await playerChange(scene.curPlayer, { riches: scene.curPlayer.salary })
            }

            /**
             * ‰ªòÊâÄÂæóÁ®é
             * @param {SceneStation} scene 
             */
            async function payIncomeTax(scene) {
                table.call(this, scene)
                const players = [scene.curPlayer, ...scene.allPlayers]
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    let tax = 0
                    if (player.salary < 3000) tax = -150;
                    else if (player.salary < 6000) tax = -1500
                    else tax = -3000;
                    await playerChange(player, { riches: tax })
                }
            }

            /**
             * ‰ªòÂ®±‰πêÁ®é
             * @param {SceneStation} scene 
             */
            async function payEntertainmentTax(scene) {
                table.call(this, scene)
                const players = [scene.curPlayer, ...scene.allPlayers]
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    let tax = 0
                    if (player.happy > 20) tax = -1000;
                    else if (player.happy > 5) tax = -2000;
                    else if (player.happy > 1) tax = -3000;
                    await playerChange(player, { riches: tax })
                }
            }

            /**
            * Â∞±‰∏öÂÖ•Âè£
            * @param {keyof PositionTypeEnum} type 
            */
            function employmentEntrance(type) {
                /** Â∞±‰∏öË¥πÁî® */
                const employmentExpense = {
                    [PositionTypeEnum.AGRICULTURE]: {
                        riches: -500
                    },
                    [PositionTypeEnum.UNIVERSITY]: {
                        riches: -500
                    },
                    [PositionTypeEnum.MINING]: {
                        riches: -5000
                    },
                    [PositionTypeEnum.SPACE]: {
                        riches: -5000
                    },
                    [PositionTypeEnum.MOVIES]: {
                        riches: -1000
                    },
                    [PositionTypeEnum.WELFARE]: {
                        riches: -2000
                    },
                    [PositionTypeEnum.ENTERPRISE]: {
                        riches: -5000
                    },
                    [PositionTypeEnum.VOYAGE]: {
                        riches: -1000
                    }
                }

                /** ÁªèÈ™åÂàóË°® */
                let experienceList = [
                    new Experience({
                        name: 'ÂÜú‰∏öÁªèÈ™å',
                        type: ExperienceType.AGRICULTURE
                    }),
                    new Experience({
                        name: '‰ºÅ‰∏öÁªèÈ™å',
                        type: ExperienceType.ENTERPRISE
                    }),
                    new Experience({
                        name: 'Ëà™Êµ∑ÁªèÈ™å',
                        type: ExperienceType.VOYAGE
                    }),
                    new Experience({
                        name: 'ÂÖ¨ÁõäÁªèÈ™å',
                        type: ExperienceType.WELFARE
                    }),
                    new Experience({
                        name: 'ÁîµÂΩ±ÁªèÈ™å',
                        type: ExperienceType.MOVIES
                    }),
                    new Experience({
                        name: 'ÈááÁüøÁªèÈ™å',
                        type: ExperienceType.MINING
                    }),
                    new Experience({
                        name: 'Â§™Á©∫ÁªèÈ™å',
                        type: ExperienceType.SPACE
                    }),
                ]


                /** ËØÅ‰π¶ÂàóË°® */
                let credentialList = [
                    new Credential({
                        name: 'ÊôÆÈÄöÂ≠¶‰Ωç',
                        type: CredentialType.NORMAL
                    }),
                    new Credential({
                        name: 'ÂåªÂ≠¶Â≠¶‰Ωç',
                        type: CredentialType.MEDICINE
                    }),
                    new Credential({
                        name: 'Ê≥ïÂæãÂ≠¶‰Ωç',
                        type: CredentialType.LAW
                    }),
                    new Credential({
                        name: 'Â∑•Á®ãÂ≠¶‰Ωç',
                        type: CredentialType.ENGINEERING
                    }),
                    new Credential({
                        name: 'ÁßëÂ≠¶Â≠¶‰Ωç',
                        type: CredentialType.SCIENCE
                    }),
                ]

                /**
                * Â∞±‰∏öÂÖ•Âè£
                * @param {SceneStation} scene 
                */
                return async function (scene) {
                    table.call(this, scene)
                    let positionType = PositionTypeEnum[type];
                    // Ê£ÄÊü•ÊòØÂê¶ÊúâÁªèÈ™å 
                    let player = scene.curPlayer
                    let isUniversity = type === "UNIVERSITY";
                    let isHasExp = player.experiences.includes(ex => ex.type == positionType)
                    let isHasCre = player.credentials.includes(cr => CredentialToExperience[cr.type] == positionType)
                    let options = []

                    if (isHasExp || isHasCre) options.push('ËøõÂÖ•ÈÅìË∑Ø')
                    else {
                        let needRiches = employmentExpense[positionType].riches
                        if (player.riches + needRiches < 0) {
                            logContainer.log('Èí±‰∏çÂ§üÊó†Ê≥ïËøõÂÖ•ÈÅìË∑Ø')
                            return
                        }
                        options.push(`ËøõÂÖ•ÈÅìË∑Ø(${needRiches}ÂÖÉ)`)
                    }
                    options.push('‰∏çËøõÂÖ•')

                    let selected = await dialogContainer.open({
                        title: this.name,
                        content: this.description,
                        options
                    })

                    if (options[selected].includes('ËøõÂÖ•ÈÅìË∑Ø')) {
                        player.positionType = positionType
                        player.position = -1;
                        if (!isHasExp) {
                            let experience = experienceList.find(a => a.type == ExperienceType[type])
                            if (experience) player.experiences.push(experience)
                        }

                        logContainer.log(`Áé©ÂÆ∂[${player.name}]ÈÄâÊã©ËøõÂÖ•ÈÅìË∑Ø`)

                        if (isUniversity) {
                            let selectedCredentialList = Maths.complementarySet(player.credentials.filter(c => c.type != CredentialType.NORMAL), credentialList)
                            selected = await dialogContainer.open({
                                title: 'Â§ßÂ≠¶Ëøõ‰øÆ',
                                content: 'ËØ∑ÈÄâÊã©Â§ßÂ≠¶Ëøõ‰øÆÊñπÂêë',
                                options: selectedCredentialList.map(c => c.name)
                            })
                            if (selected == 0) {
                                logContainer.log('ÈÄâÊã©[ÊôÆÈÄöÂ≠¶‰Ωç]Ëñ™ËµÑ+2000ÂÖÉ')
                                await playerChange(player, { salary: 2000 })
                            }
                            logContainer.log(`Áé©ÂÆ∂[${player.name}]ÈÄâÊã©Ëøõ‰øÆ[${selectedCredentialList[selected].name}]`)
                            player.credentials.push(selectedCredentialList[selected])
                        }

                        await playerChange(player, employmentExpense[positionType])
                        await playerContainer.upd([player])
                    }
                    else {
                        logContainer.log(`Áé©ÂÆ∂[${player.name}]ÈÄâÊã©‰∏çËøõÂÖ•ÈÅìË∑Ø`)
                    }
                }
            }


            /**
             * ÊôÆÈÄö‰∫ã‰ª∂
             * @param {(scene:SceneStation)=>PlayerChanged} func
             */
            function ordinaryEvents(func) {
                /**
                 * @param {SceneStation} scene 
                 */
                return async function (scene) {
                    table.call(this, scene)
                    // Â≠òÂú®Âç°Áâá Â§ÑÁêÜÂÖçÁñ´Ë¥üÈù¢‰∫ã‰ª∂ 
                    let playerChanged = func(scene);
                    // ÂÖçÁñ´Âç°Áâá
                    let immunityCard = scene.curPlayer.cardHolder.find(c => c.immunity == scene.curPlayer.positionType)
                    // Ë¥üÈù¢‰∫ã‰ª∂
                    let negativeEvent = playerChanged.actionState === PlayerActionEnum.PAUSE || playerChanged.happy < 0 || playerChanged.repute < 0 || playerChanged.riches < 0 || playerChanged.salary < 0
                    if (immunityCard && negativeEvent) {
                        logContainer.log(`Áé©ÂÆ∂[${scene.curPlayer.name}]‰ΩøÁî®Âç°Áâá[${immunityCard.name}]ÂÖçÁñ´Ë¥üÈù¢‰∫ã‰ª∂`)
                        return
                    }
                    await playerChange(scene.curPlayer, playerChanged)
                }
            }


            /**
             * ÁßªÂä®‰∫ã‰ª∂
             * @param {keyof PositionTypeEnum} type
             * @param {number} index
             */
            function moveStation(type, index) {
                /**
                 * @param {SceneStation} scene 
                 */
                return async function (scene) {

                    let station = null;
                    let player = scene.curPlayer;

                    player.positionType = PositionTypeEnum[type]
                    player.position = index;

                    // ËøõÂÖ•Â§ñÂúà
                    if (player.positionType == PositionTypeEnum.LOOP) {
                        station = loopStations[player.position % loopStations.length]; // Â§ñÂúàÁ´ôÁÇπ
                    }

                    let currDom = fragment.shadowRoot.querySelector(`.player-item[data-id="${player.id}"]`);
                    station.dom.appendChild(currDom)
                    lookAt(currDom.parentNode)

                    logContainer.log(`Áé©ÂÆ∂[${scene.curPlayer.name}]ÁßªÂä®Âà∞[${station.name}]`)
                    await station.stop?.(scene)
                }
            }

            /**
             * Âá∫Èô¢ÂêçÂçï 
             */
            let dischargeList = []
            /**
             * Á¶ªÂºÄÂåªÈô¢
             * @param {SceneStation} scene 
             */
            async function leaveHospital(scene) {
                let dischargeIndex = dischargeList.findIndex(d => d === scene.curPlayer)
                // Âá∫Èô¢
                if (dischargeIndex > -1) {
                    dischargeList.splice(dischargeIndex, 1)
                    return true;
                }
                let diceTotal = await hospitalContainer.open()
                // ÂÜç‰Ωè‰∏ÄÂõûÂêà
                if (diceTotal == 1 || diceTotal == 2) return false;
                // Êâ£Èí±‰∏ãÂõûÂêàÂá∫Èô¢
                const player = scene.curPlayer;
                const allPlayers = [player, ...scene.allPlayers]
                // ÊúâÂåªÂ≠¶Â≠¶‰ΩçÁöÑ‰∫∫
                const hasCrePlayers = allPlayers.filter(p => p.credentials.includes(c => c.type == CredentialType.MEDICINE))
                // Ëñ™ËµÑÁöÑ‰∏ÄÂçä
                const halfSalary = ~~(player.salary / 2)
                // ÁªôÊúâÂåªÂ≠¶Â≠¶‰ΩçÁöÑ‰∫∫
                await playerChange(player, { riches: -halfSalary })


                for (let i = 0; i < hasCrePlayers.length; i++) {
                    const crePlayer = hasCrePlayers[i];
                    await playerChange(player, { riches: ~~(halfSalary / hasCrePlayers.length) })
                }
                dischargeList.push(scene.curPlayer)
                return false;
            }

            /**
             * ÂÅúÁïôÂ∫¶ÂÅáÊùë
             * @param {SceneStation} scene 
             */
            async function stopVacational(scene) {
                table.call(this, scene)
                await playerChange(scene.curPlayer, { happy: 2 })

                let options = [
                    `‰∏ãÂõûÂêàÂ§öÂÅúÁïô‰∏ÄÊ¨° +3${ICON_CONFIG.HAPPY}`,
                    '‰∏ãÂõûÂêàÁ¶ªÂºÄ'
                ]

                let selected = await dialogContainer.open({
                    title: this.name,
                    content: 'ËØ∑ÈÄâÊã©‰ª•‰∏ãÈÄâÈ°π',
                    options
                })

                if (selected == 0) {
                    scene.curPlayer.actionState = PlayerActionEnum.PAUSE
                    await playerChange(scene.curPlayer, { happy: 3 })
                }
            }

            // Á¶ªÂºÄÂÖ¨Âõ≠‰∫∫ÂëòÂàóË°®
            let exitParkList = []
            /**
             * ÂÅúÁïôÂÖ¨Âõ≠
             * @param {SceneStation} scene 
             */
            async function leaveOrStopPark() {
                let exitIndex = exitParkList.findIndex(d => d === scene.curPlayer)
                // Á¶ªÂºÄ
                if (exitIndex > -1) {
                    exitParkList.splice(exitIndex, 1)
                    return true;
                }
                let diceTotal = await parkContainer.open()

                // ÂÅ∂Êï∞Á¶ªÂºÄ
                if (diceTotal % 2 == 0) {
                    exitParkList.push(scene.curPlayer)
                }

                return false
            }



            /**
             * ÂÅúÁïôÂΩ©Á•®Â∫ó
             * @param {SceneStation} scene 
             */
            async function stopLottery(scene) {
                table.call(this, scene)
                let players = [scene.curPlayer, ...scene.allPlayers];
                let result = await lotteryContainer.open(players)
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    result[i] && await playerChange(player, { riches: result[i] })
                }
            }


            /**
             * ÂÅúÁïôËØÅÂà∏Â∏ÇÂú∫
             * @param {SceneStation} scene 
             */
            async function stopStock(scene) {
                table.call(this, scene)
                let players = [scene.curPlayer, ...scene.allPlayers];
                let result = await stockContainer.open(players)
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    result[i] && await playerChange(player, { riches: result[i] })
                }
            }

            /**
             * ÂÅúÁïôÂïÜÂú∫
             * @param {SceneStation} scene 
             */
            async function stopMall(scene) {
                table.call(this, scene)
                let players = [scene.curPlayer, ...scene.allPlayers];
                let result = await mallContainer.open(players)
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    result[i] && await playerChange(player, { riches: result[i] })
                }
            }

            /**
             * ÂÅúÁïôÁîªÂªä
             * @param {SceneStation} scene 
             */
            async function stopGallery(scene) {
                table.call(this, scene)
                let players = [scene.curPlayer, ...scene.allPlayers];
                let result = await galleryContainer.open(players)
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    result[i] && await playerChange(result[i].player, result[i].changed)
                }
            }

            /**
             * ÂÅúÁïôËÆ∏ÊÑø‰∫ï
             * @param {SceneStation} scene 
             */
            async function stopWishing(scene) {
                table.call(this, scene)
                let players = [scene.curPlayer, ...scene.allPlayers];
                let result = await wishingContainer.open(players)
                for (let i = 0; i < players.length; i++) {
                    const player = players[i];
                    result[i] && await playerChange(result[i].player, result[i].changed)
                }
            }



            /**
             * ÂÅúÁïôËØ∫Ë¥ùÂ∞îÂ•ñ
             * @param {SceneStation} scene 
             */
            async function stopNobelPrize(scene) {
                table.call(this, scene)
                const player = scene.curPlayer;
                let happy = 0;
                if (player.repute > 20) happy = +8;
                else if (player.happy > 10) happy = +5;
                else happy = +3;
                await playerChange(player, { happy })
            }


            /**
             * ÂÅúÁïôÂ±ïÈîÄ‰ºö
             * @param {SceneStation} scene 
             */
            async function stopSalesExhibition(scene) {
                table.call(this, scene)
                const player = scene.curPlayer;
                let selected = await dialogContainer.open({
                    title: "Ê±ΩËΩ¶Â±ïÈîÄ‰ºö",
                    content: "‰Ω†ÈÄâÊã©ÊâßË°å‰ª•‰∏ãÂÖ∂‰∏≠‰∏ÄÈ°πÔºö",
                    options: [
                        `<div style="color:red">-2000ÂÖÉ</div>Âπ∂‰∏î<div class="flex-row-center" style="color:green">+5${ICON_CONFIG.REPUTE}</div>`,
                        `<div class="flex-row-center" style="color:red">-2${ICON_CONFIG.REPUTE}</div>`,
                    ]

                })
                if (selected == 0) await playerChange(player, { riches: -2000, repute: 5 })
                if (selected == 1) await playerChange(player, { repute: -2 })
            }

            /**
             * ÂÅúÁïôÊú∫‰ºö
             * @param {string} type
             * @param {number} count
             */
            function stopChance(type, count) {
                /**
                 * @param {SceneStation} scene 
                 */
                return async function (scene) {
                    table.call(this, scene)
                    const player = scene.curPlayer;
                    await chanceContainer.open(player, type, count)
                }

            }

            /**
             * Â§ñÂúà
             * @type {Station[]}
             * @author 	 linyisonger
             * @date 	 2024-12-02
             */
            let loopStations = [
                {
                    id: "1",
                    left: "83.3%",
                    top: "83.3%",
                    width: "15.34%",
                    height: "15.34%",
                    name: 'ÂèëËñ™Êó•',
                    description: "ÁªèËøáÊàñËÄÖÂÅúÁïôÊ≠§Â§ÑÔºåÂèØÈ¢ÜÂèñ‰∏éÂΩìÂâçËñ™Á∫ßÁõ∏ÂΩìÁöÑËñ™Ê∞¥",
                    via‚Äå: salaryCollection,
                    stop: salaryCollection
                },
                {
                    id: "2",
                    left: "73.7%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "3",
                    left: "64.1%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'ÊâÄÊúâ‰∫∫‰ªòÊâÄÂæóÁ®é',
                    description: ` 
                        <tr>
                            <td>Ëñ™Á∫ß</td>
                            <td>ÈúÄ‰ªòÁ®éÊ¨æ</td>
                        </tr>
                        <tr>
                            <td>3ÂçÉ‰ª•‰∏ã</td>
                            <td>200ÂÖÉ</td>
                        </tr>
                        <tr>
                            <td>4ÂçÉÂà∞6ÂçÉ</td>
                            <td>1500ÂÖÉ</td>
                        </tr>
                        <tr>
                            <td>6ÂçÉÂÖÉ‰ª•‰∏ä</td>
                            <td>3000ÂÖÉ</td>
                        </tr>
                    `,
                    stop: payIncomeTax
                },
                {
                    id: "4",
                    left: "54.6%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "5",
                    left: "45.1%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'ÂÜú‰∏öÂºÄËçíÂ∞±‰∏öÂÖ•Âè£',
                    description: "Â∞±‰∏öÊù°‰ª∂Ôºö‰ªò500ÂÖÉÂä°ÂÜúËµÑÊú¨ÊàñÂ∑≤ÊúâÂÜú‰∏öÁªèÈ™å",
                    stop: employmentEntrance("AGRICULTURE")
                },
                {
                    id: "6",
                    left: "35.5%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "7",
                    left: "26%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'Ë¥≠‰π∞ÂΩ©Á•®',
                    description: "ÊØè‰∫∫ÂèØËΩÆÊµÅÈÄâÊã©ÊòØÂê¶ÊâßË°å‰ª•‰∏ãÂä®‰ΩúÔºöÊé∑‰∏ÄÈ¢óÈ™∞Âπ∂Ê†πÊçÆÊé∑Âá∫ÁÇπÊï∞Â§±ÂéªÊàñËé∑ÂæóÈáëÈí±",
                    stop: stopLottery
                },
                {
                    id: "8",
                    left: "16.4%",
                    top: "83.3%",
                    width: "9.5%",
                    height: "15.34%",
                    name: 'Â§ßÂ≠¶Ëøõ‰øÆÂ∞±‰∏öÂÖ•Âè£',
                    description: "ÂÖ•Â≠¶Êù°‰ª∂Ôºö‰ªò500ÂÖÉÂ≠¶Ë¥π",
                    stop: employmentEntrance("UNIVERSITY")
                },
                {
                    id: "9",
                    left: "1%",
                    top: "83.3%",
                    width: "15.34%",
                    height: "15.34%",
                    name: 'ÂåªÈô¢',
                    description: "",
                    leave: leaveHospital
                },
                {
                    id: "10",
                    left: "1%",
                    top: "73.6%",
                    width: "15.34%",
                    height: "9.5%",
                    name: 'ÊâÄÊúâ‰∫∫‰ªòÂ®±‰πêË¥π',
                    description: `
                        <tr>
                            <td><div class="flex-row-center">ÊâÄÊåÅÊúâ${ICON_CONFIG.HAPPY}</div></td>
                            <td>ÈúÄ‰ªòÊ¨æ</td>
                        </tr>
                        <tr>
                            <td><div class="flex-row-center">1~5${ICON_CONFIG.HAPPY}</div></td>
                            <td>3000ÂÖÉ</td>
                        </tr>
                        <tr>
                            <td><div class="flex-row-center">6~20${ICON_CONFIG.HAPPY}</div></td>
                            <td>2000ÂÖÉ</td>
                        </tr>
                        <tr>
                            <td><div class="flex-row-center">21${ICON_CONFIG.HAPPY}‰ª•‰∏ä</div></td>
                            <td>1000ÂÖÉ</td>
                        </tr>
                    `,
                    stop: payEntertainmentTax
                },
                {
                    id: "11",
                    left: "1%",
                    top: "64%",
                    width: "15.34%",
                    height: "9.5%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "12",
                    left: "1%",
                    top: "54.7%",
                    width: "15.34%",
                    height: "9.2%",
                    name: '‰ºÅ‰∏öÁªèËê•Â∞±‰∏öÂÖ•Âè£',
                    description: "Â∞±‰∏öÊù°‰ª∂Ôºö‰ªò5000ÂÖÉÈõá‰Ω£ÂëòÂ∑•ÊàñÂ∑≤ÊúâÊôÆÈÄöÂ≠¶‰ΩçÊàñÂ∑≤Êúâ‰ºÅ‰∏öÁªèÈ™å",
                    stop: employmentEntrance("ENTERPRISE")
                },
                {
                    id: "13",
                    left: "1%",
                    top: "45.2%",
                    width: "15.34%",
                    height: "9.4%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "14",
                    left: "1%",
                    top: "35.6%",
                    width: "15.34%",
                    height: "9.5%",
                    name: 'ÁîªÂªä',
                    description: "",
                    stop: stopGallery
                },
                {
                    id: "15",
                    left: "1%",
                    top: "26.2%",
                    width: "15.34%",
                    height: "9.4%",
                    name: 'Ëà™Êµ∑Â∞±‰∏öÂÖ•Âè£',
                    description: ``,
                    stop: employmentEntrance("VOYAGE")
                },
                {
                    id: "16",
                    left: "1%",
                    top: "16.6%",
                    width: "15.34%",
                    height: "9.4%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "17",
                    left: "1%",
                    top: "1.2%",
                    width: "15.34%",
                    height: "15.34%",
                    name: '‰∏â‰∫öÂ∫¶ÂÅá',
                    description: `
                        <tr>
                            <td>ÂÅúÁïôÊ≠§Â§Ñ+2${ICON_CONFIG.HAPPY}</td>
                        </tr>
                        <tr>
                            <td>ÂèØÈÄâÊã©‰∏ãÂõûÂêàÂ§öÂÅúÁïô‰∏ÄÊ¨°+3${ICON_CONFIG.HAPPY}(ÈôêÈ¢ùÂ§ñÂÅúÁïô‰∏ÄÊ¨°)</td>
                        </tr>
                    `,
                    stop: stopVacational
                },
                {
                    id: "18",
                    left: "16.5%",
                    top: "1.2%",
                    width: "9.4%",
                    height: "15.34%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "19",
                    left: "26%",
                    top: "1.2%",
                    width: "9.4%",
                    height: "15.34%",
                    name: 'Ê±ΩËΩ¶Â±ïÈîÄ‰ºö',
                    description: "",
                    stop: stopSalesExhibition
                },
                {
                    id: "20",
                    left: "35.5%",
                    top: "1.2%",
                    width: "9.4%",
                    height: "15.34%",
                    name: 'ÂÖ¨Áõä‰∫ã‰∏öÂ∞±‰∏öÂÖ•Âè£',
                    description: "",
                    stop: employmentEntrance("WELFARE")
                },
                {
                    id: "21",
                    left: "45%",
                    top: "1.2%",
                    width: "9.6%",
                    height: "15.34%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "22",
                    left: "54.7%",
                    top: "1.2%",
                    width: "9.4%",
                    height: "15.34%",
                    name: 'ÂïÜÂú∫',
                    description: "",
                    stop: stopMall
                },
                {
                    id: "23",
                    left: "64.2%",
                    top: "1.2%",
                    width: "9.4%",
                    height: "15.34%",
                    name: 'ÁîµÂΩ±ÊãçÊëÑÂ∞±‰∏öÂÖ•Âè£',
                    description: "",
                    stop: employmentEntrance("MOVIES")
                },
                {
                    id: "24",
                    left: "73.7%",
                    top: "1.2%",
                    width: "9.4%",
                    height: "15.34%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "25",
                    left: "83.2%",
                    top: "1.2%",
                    width: "15.44%",
                    height: "15.34%",
                    name: 'ÂÖ¨Âõ≠ÊùøÂá≥',
                    description: "‰∏çÂèØ‰ΩøÁî®Êú∫‰ºöÂç°ÊàñÁªèÈ™åÂç°Á¶ªÂºÄÊ≠§Ê†ºÔºåÊäïÊé∑‰∏ÄÈ™∞ÔºåËã•ÁÇπÊï∞‰∏∫ÂèåÊï∞Ôºå‰∏ãÂõûÂêàÂç≥ÂèØÁ¶ªÂºÄ",
                    stop: leaveOrStopPark,
                    leave: leaveOrStopPark
                },
                {
                    id: "26",
                    left: "83.2%",
                    top: "16.6%",
                    width: "15.44%",
                    height: "9.5%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "27",
                    left: "83.2%",
                    top: "26.2%",
                    width: "15.44%",
                    height: "9.5%",
                    name: 'ËÇ°Á•®Â∏ÇÂú∫',
                    description: "",
                    stop: stopStock
                },
                {
                    id: "28",
                    left: "83.2%",
                    top: "35.8%",
                    width: "15.44%",
                    height: "9.4%",
                    name: 'ÈááÁüøÂºÄÂèëÂ∞±‰∏öÂÖ•Âè£',
                    description: "",
                    stop: employmentEntrance("MINING")

                },
                {
                    id: "29",
                    left: "83.2%",
                    top: "45.3%",
                    width: "15.44%",
                    height: "9.4%",
                    name: 'Êú∫‰ºö',
                    description: "",
                    stop: stopChance(ChanceCardType.CHANCE, 1)
                },
                {
                    id: "30",
                    left: "83.2%",
                    top: "54.8%",
                    width: "15.44%",
                    height: "9.4%",
                    name: 'ËÆ∏ÊÑø‰∫ï',
                    description: "",
                    stop: stopWishing
                },
                {
                    id: "31",
                    left: "83.2%",
                    top: "64.3%",
                    width: "15.44%",
                    height: "9.4%",
                    name: 'Â§™Á©∫Êé¢Èô©Â∞±‰∏öÂÖ•Âè£',
                    description: "",
                    stop: employmentEntrance("SPACE")
                },
                {
                    id: "32",
                    left: "83.2%",
                    top: "73.8%",
                    width: "15.44%",
                    height: "9.4%",
                    name: 'Ëé∑ËØ∫Ë¥ùÂ∞îÂ•ñ',
                    description: `
                        <tr>
                            <td><div class="flex-row-center">Êã•ÊúâÁöÑ${ICON_CONFIG.REPUTE}</div></td>
                            <td>Ëé∑Âæó</td>
                        </tr>
                        <tr>
                            <td><div class="flex-row-center">10‰∏™‰ª•‰∏ã</div></td>
                            <td>+3${ICON_CONFIG.HAPPY}</td>
                        </tr>
                        <tr>
                            <td><div class="flex-row-center">11Âà∞20‰∏™</div></td>
                            <td>+5${ICON_CONFIG.HAPPY}</td>
                        </tr>
                        <tr>
                            <td><div class="flex-row-center">21‰∏™‰ª•‰∏ä</div></td>
                            <td>+8${ICON_CONFIG.HAPPY}</td>
                        </tr>
                    `,
                    stop: stopNobelPrize
                }
            ].map((item) => new Station(item))

            /**
             * ÂÜÖÂúà
             * @type {{ [x: number]: Station[];}}
             * @author 	 linyisonger
             * @date 	 2024-11-30
             */
            let insideStations = {
                // ÂÜú‰∏ö
                [PositionTypeEnum.AGRICULTURE]: [
                    {
                        id: "1",
                        left: "45.1%",
                        top: "78.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂúüÂú∞ËÇ•Ê≤ÉÈÄÇÂêàËÄïÁßç',
                        description: `+2${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 2 } })
                    },
                    {
                        id: "2",
                        left: "45.1%",
                        top: "73.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Á†îÂèëÊñ∞ÁßçÊîπËâØ‰ΩúÁâ©',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "3",
                        left: "45.1%",
                        top: "69.01%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÂ±ïÁéØ‰øùÂÜú‰∏ö',
                        description: `+5${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 5 } })
                    },
                    {
                        id: "4",
                        left: "45.1%",
                        top: "64.31%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Â§èÂ≠£Êî∂Êàê',
                        description: "+üé≤√ó1000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: scene.dicePoints * 1000 } })
                    },
                    {
                        id: "5",
                        left: "40.4%",
                        top: "64.31%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊúâÊú∫È•≤ÊñôÂÆ∂ÁïúÂÅ•Â∫∑',
                        description: `+2${ICON_CONFIG.REPUTE}4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 4, repute: 2 } })
                    },
                    {
                        id: "6",
                        left: "35.6%",
                        top: "64.31%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁîüÂÆ∂Áïú‰º†ÊüìÁóÖ',
                        description: "-3000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: -3000 } })
                    },
                    {
                        id: "7",
                        left: "35.6%",
                        top: "69.11%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁßãÂ≠£Â§ß‰∏∞Êî∂',
                        description: "+5000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 5000 } })
                    },
                    {
                        id: "8",
                        left: "35.6%",
                        top: "73.86%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Â§ßÈõ™ÂØºËá¥ÂÆ∂Á¶ΩÂÜªÊ≠ª',
                        description: `-${ICON_CONFIG.HAPPY}/2`,
                        stop: ordinaryEvents((scene) => { return { happy: ~~(-scene.curPlayer.happy / 2) } })
                    },
                    {
                        id: "9",
                        left: "35.6%",
                        top: "78.56%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊàêÁ´ãÁîüÊäÄÂÆûÈ™åÂÆ§',
                        description: "Âä†‰∏ÄÂçÉÂÖÉËñ™Á∫ßÂà´",
                        stop: ordinaryEvents((scene) => { return { salary: 1000 } })
                    }
                ].map((item) => new Station(item)),
                // Â§ßÂ≠¶
                [PositionTypeEnum.UNIVERSITY]: [
                    {
                        id: "1",
                        left: "21.2%",
                        top: "78.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁªìËØÜÂêåÂ≠¶',
                        description: `+4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 4 } })
                    },
                    {
                        id: "2",
                        left: "21.2%",
                        top: "73.65%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Êúü‰∏≠ËÄÉÁù°ËøáÂ§¥',
                        description: "ÊöÇÂÅú‰∏ÄÊ¨°",
                        stop: ordinaryEvents((scene) => { return { actionState: PlayerActionEnum.PAUSE } })
                    },
                    {
                        id: "3",
                        left: "26.0%",
                        top: "73.65%",
                        width: "4.7%",
                        height: "4.7%",
                        name: '‰ª£Ë°®Â≠¶Ê†°ÂèÇÂä†ÊØîËµõ',
                        description: `+2${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 2 } })
                    },
                    {
                        id: "4",
                        left: "26.0%",
                        top: "68.85%",
                        width: "4.7%",
                        height: "4.7%",
                        name: '‰∫§ÈîôÊä•Âëä',
                        description: `-üé≤√ó${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: -scene.dicePoints } })
                    },
                    {
                        id: "5",
                        left: "26.0%",
                        top: "64.15%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊàêÁª©‰ºòÂºÇËé∑Â•ñÂ≠¶Èáë',
                        description: "+1000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 1000 } })
                    },
                    {
                        id: "6",
                        left: "21.2%",
                        top: "64.15%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ëé∑ÈÄâ‰∏∫Â≠¶Áîü‰ºöÈïø',
                        description: `+6${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6 } })
                    },
                    {
                        id: "7",
                        left: "16.5%",
                        top: "64.15%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊØï‰∏öÊóÖË°å',
                        description: "ÊäΩ‰∏§Âº†Êú∫‰ºöÂç°",
                        stop: stopChance(ChanceCardType.CHANCE, 2)
                    },
                ].map((item) => new Station(item)),
                // ‰ºÅ‰∏ö
                [PositionTypeEnum.ENTERPRISE]: [
                    {
                        id: "1",
                        left: "16.5%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÈÄöËøáÂÆû‰π†',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "2",
                        left: "21.2%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁÆÄÊä•‰ºòÂºÇ',
                        description: `+4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 4 } })
                    },
                    {
                        id: "3",
                        left: "26%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂÖ®Âã§Â•ñÈáë',
                        description: "+3000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 3000 } })
                    },
                    {
                        id: "4",
                        left: "30.8%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ËØØ‰ºöÂÆ¢Êà∑Â§±ÂéªÂêàÁ∫¶',
                        description: "ÊöÇÂÅú‰∏ÄÊ¨°",
                        stop: ordinaryEvents((scene) => { return { actionState: PlayerActionEnum.PAUSE } })
                    },
                    {
                        id: "5",
                        left: "30.8%",
                        top: "50%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Á†îÂèëÊñ∞ÂìÅÂ§áÂèóÁû©ÁõÆ',
                        description: `+6${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6 } })
                    },
                    {
                        id: "6",
                        left: "30.8%",
                        top: "45.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊàêÂäüÊâ©Â±ïÁΩëÂ∫óÂïÜÂú∫',
                        description: "+8000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 8000 } })
                    },
                    {
                        id: "7",
                        left: "30.8%",
                        top: "40.4%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊäïËµÑÂáÜÁ°Æ',
                        description: "+4000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 4000 } })
                    },
                    {
                        id: "8",
                        left: "26.1%",
                        top: "40.4%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ë°®Áé∞Á™ÅÂá∫ÊãÖ‰ªªÁªèÁêÜ',
                        description: `+2${ICON_CONFIG.REPUTE}4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { repute: 2, happy: 4 } })
                    },
                    {
                        id: "9",
                        left: "21.4%",
                        top: "40.4%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÈáëËûçÈ£éÊö¥Âë®ËΩ¨Â§±ÁÅµ',
                        description: "È©¨‰∏äÁßªÂà∞ÂÖ¨Âõ≠",
                        stop: moveStation("LOOP", 24)
                    },
                    {
                        id: "10",
                        left: "21.4%",
                        top: "45.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂìÅÁÆ°‰∏çÂë®ÂÆ¢Êà∑ÈÄÄË¥ß',
                        description: `-${ICON_CONFIG.RICHES}/2`,
                        stop: ordinaryEvents((scene) => { return { riches: ~~(-scene.curPlayer.riches / 2) } })
                    },
                    {
                        id: "11",
                        left: "16.55%",
                        top: "45.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Âπ¥ÁªàÂ•ñÈáë',
                        description: "+6000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 6000 } })
                    },
                ].map((item) => new Station(item)),
                // Ëà™Êµ∑
                [PositionTypeEnum.VOYAGE]: [
                    {
                        id: "1",
                        left: "16.5%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: '‰∏•ÈáçÊôïËàπ',
                        description: "È©¨‰∏äÁßªÂà∞ÂåªÈô¢",
                        stop: moveStation("LOOP", 8)
                    },
                    {
                        id: "2",
                        left: "21.25%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: '‰∏éÊµ∑Ë±ö‰∏ÄÂêåÁé©‰πê',
                        description: `+2${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 2 } })
                    },
                    {
                        id: "3",
                        left: "26%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁé∞Á•ûÁßòÊµ∑Â≤õ',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "4",
                        left: "30.7%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÈÅ≠ÈÅáÊö¥È£éÈõ®',
                        description: `-üé≤√ó${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: -scene.dicePoints } })
                    },
                    {
                        id: "5",
                        left: "30.8%",
                        top: "26.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂáªÈÄÄÊµ∑ÁõóÊïëÂõûÂêå‰º¥',
                        description: `+6${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6 } })
                    },
                    {
                        id: "6",
                        left: "30.8%",
                        top: "21.45%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ëç£ÂçáÂ§ßÂâØ',
                        description: `+6${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6 } })
                    },
                    {
                        id: "7",
                        left: "26%",
                        top: "21.45%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊâìÊçûÊ∑±Êµ∑ÂÆùËóè',
                        description: "+üé≤√ó1000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: scene.dicePoints * 1000 } })
                    },
                    {
                        id: "8",
                        left: "21.3%",
                        top: "21.45%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Èõæ‰∏≠Ëø∑Ëà™È°∫Âà©ËÑ±Èô©',
                        description: `+2${ICON_CONFIG.REPUTE}4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { repute: 2, happy: 4 } })
                    },
                    {
                        id: "9",
                        left: "21.3%",
                        top: "16.75%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Âπ≥ÂÆâËøî‰π°',
                        description: "Âä†‰∏ÄÂçÉÂÖÉËñ™Á∫ß",
                        stop: ordinaryEvents((scene) => { return { salary: 1000 } })
                    },
                ].map((item) => new Station(item)),
                // ÂÖ¨Áõä
                [PositionTypeEnum.WELFARE]: [
                    {
                        id: "1",
                        left: "40.3%",
                        top: "16.75%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ê∏ÖÊâ´Ë°óÈÅìÁæéÂåñÂ∏ÇÂÆπ',
                        description: `+2${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 2 } })
                    },
                    {
                        id: "2",
                        left: "40.3%",
                        top: "21.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ê§çÊ†ëÈÄ†Êûó',
                        description: `+üé≤√ó${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: scene.dicePoints } })
                    },
                    {
                        id: "3",
                        left: "40.3%",
                        top: "26.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂÄ°ÂØºÁéØ‰øù',
                        description: `+üé≤√ó${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: scene.dicePoints } })
                    },
                    {
                        id: "4",
                        left: "40.3%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂçèÂä©ÂåªÂ∏à‰∏ã‰π°‰πâËØä',
                        description: `+4${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 4 } })
                    },
                    {
                        id: "5",
                        left: "45%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁÉ≠ÂøÉËøáÂ∫¶‰ΩìÂäõ‰∏çÊîØ',
                        description: "È©¨‰∏äÁßªÂà∞ÂåªÈô¢",
                        stop: moveStation("LOOP", 8)
                    },
                    {
                        id: "6",
                        left: "49.8%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Âª∫ËÆæÂÜúÊùëÁîµÂäõÁÆ°Á∫ø',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "7",
                        left: "54.6%",
                        top: "30.9%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊçêÊ¨æÂä©Â≠¶',
                        description: "+üé≤√ó1000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: scene.dicePoints * 1000 } })
                    },
                    {
                        id: "8",
                        left: "54.6%",
                        top: "26.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Áà±ÂøÉÊçêËµ†Âº±ÂäøÁæ§‰Ωì',
                        description: `+6${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6 } })
                    },
                    {
                        id: "9",
                        left: "54.6%",
                        top: "21.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÈÅ≠ÈÅáÂ§©ÁÅæ',
                        description: "È©¨‰∏äÁßªÂà∞ÂÖ¨Âõ≠",
                        stop: moveStation("LOOP", 24)
                    },
                    {
                        id: "10",
                        left: "49.8%",
                        top: "21.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ê∑±ÂÖ•ÁÅæÂå∫ÊïëÂä©ÈöæÊ∞ë',
                        description: `+10${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 10 } })
                    },
                    {
                        id: "11",
                        left: "49.8%",
                        top: "16.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÈÄ†Ê°•Èì∫Ë∑Ø',
                        description: `+3${ICON_CONFIG.HAPPY}3${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { happy: 3, repute: 3 } })
                    },
                ].map((item) => new Station(item)),
                // ÁîµÂΩ±
                [PositionTypeEnum.MOVIES]: [
                    {
                        id: "1",
                        left: "64.2%",
                        top: "16.75%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèÇÂä†ËÄÉËØï',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "2",
                        left: "64.2%",
                        top: "21.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂπøÂëäÂá∫ÈÅì‰∏ÄÈ∏£ÊÉä‰∫∫',
                        description: `+4${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 4 } })
                    },
                    {
                        id: "3",
                        left: "64.2%",
                        top: "26.3%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ëé∑ÂæóÁîµÂΩ±ÊºîÂá∫Êú∫‰ºö',
                        description: "+üé≤√ó1000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: scene.dicePoints * 1000 } })
                    },
                    {
                        id: "4",
                        left: "64.2%",
                        top: "31%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁªØÈóªÊõùÂÖâ',
                        description: `-${ICON_CONFIG.HAPPY}/2`,
                        stop: ordinaryEvents((scene) => { return { happy: ~~(-scene.curPlayer.happy / 2) } })
                    },
                    {
                        id: "5",
                        left: "68.9%",
                        top: "31%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Á≤â‰∏ùÊàêÁ´ãÂêéÊè¥‰ºö',
                        description: `+3${ICON_CONFIG.REPUTE}3${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 3, repute: 3 } })
                    },
                    {
                        id: "6",
                        left: "73.6%",
                        top: "31%",
                        width: "4.7%",
                        height: "4.7%",
                        name: '‰∏çÂÆûÊä•ÈÅì‰∏ëÂåñÂΩ¢Ë±°',
                        description: `-${ICON_CONFIG.REPUTE}/2`,
                        stop: ordinaryEvents((scene) => { return { repute: ~~(-scene.curPlayer.repute / 2) } })
                    },
                    {
                        id: "7",
                        left: "73.6%",
                        top: "26.3%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁîµÂΩ±‰∏äÊò†Â§ßÂèóÊ¨¢Ëøé',
                        description: "Âä†‰∏ÄÂçÉÂÖÉËñ™Á∫ß",
                        stop: ordinaryEvents((scene) => { return { salary: 1000 } })
                    },
                    {
                        id: "8",
                        left: "73.6%",
                        top: "21.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Êàê‰∏∫ÊùÇÂøóÂ∞ÅÈù¢‰∫∫Áâ©',
                        description: "+6000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 6000 } })
                    },
                    {
                        id: "9",
                        left: "78.4%",
                        top: "21.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ëç£Ëé∑ÈáëÈ©¨Â•ñ',
                        description: `+4${ICON_CONFIG.REPUTE}4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 4, repute: 4 } })
                    },
                ].map((item) => new Station(item)),
                // ÈááÁüø
                [PositionTypeEnum.MINING]: [
                    {
                        id: "1",
                        left: "78.4%",
                        top: "40.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁüøÂå∫ÈááÊ†∑',
                        description: "-2000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: -2000 } })
                    },
                    {
                        id: "2",
                        left: "73.6%",
                        top: "40.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂùëÈÅìÊï¥È°ø',
                        description: "ÂÜçË°åÂä®‰∏ÄÊ¨°",
                        stop: ordinaryEvents((scene) => { return { actionState: PlayerActionEnum.AGAIN } })
                    },
                    {
                        id: "3",
                        left: "68.8%",
                        top: "40.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Â±±Â¥©',
                        description: "ÊöÇÂÆö‰∏ÄÊ¨°",
                        stop: ordinaryEvents((scene) => { return { actionState: PlayerActionEnum.PAUSE } })
                    },
                    {
                        id: "4",
                        left: "64.1%",
                        top: "40.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁé∞ÈªÑÈáë',
                        description: `+2${ICON_CONFIG.REPUTE}4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 4, repute: 2 } })
                    },
                    {
                        id: "5",
                        left: "64.1%",
                        top: "45.3%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Âú∞Ë¥®ÂàÜÊûê',
                        description: "-üé≤√ó1000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: -scene.dicePoints * 1000 } })
                    },
                    {
                        id: "6",
                        left: "64.1%",
                        top: "50%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊÑèÂ§ñÂèëÁé∞ÊñáÊòéÈÅóËøπ',
                        description: `+10${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 10 } })
                    },
                    {
                        id: "7",
                        left: "64.1%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂºïÂèëÂ∞òÊö¥',
                        description: "È©¨‰∏äÁßªÂà∞ÂåªÈô¢",
                        stop: moveStation("LOOP", 8)
                    },
                    {
                        id: "8",
                        left: "68.8%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁé∞Áü≥Ê≤π',
                        description: "+8000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 8000 } })
                    },
                    {
                        id: "9",
                        left: "73.6%",
                        top: "54.7%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Á†îÂèëÁßòÂØÜËæìÈÄÅÁÆ°Á∫ø',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "10",
                        left: "73.6%",
                        top: "50%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁé∞ÈíªÁü≥',
                        description: "+6000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 6000 } })
                    },
                    {
                        id: "11",
                        left: "78.4%",
                        top: "50%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊàêÁ´ãË∑®ÂõΩÈááÁüøÈõÜÂõ¢',
                        description: "+10000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 10000 } })
                    },
                ].map((item) => new Station(item)),
                // Ëà™Â§©
                [PositionTypeEnum.SPACE]: [
                    {
                        id: "1",
                        left: "78.4%",
                        top: "64.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂçèÂä©Âª∫ÈÄ†Ëà™Â§©È£ûÊú∫',
                        description: `+6${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 6 } })
                    },
                    {
                        id: "2",
                        left: "73.6%",
                        top: "64.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊàêÂäüÂèëÂ∞ÑËà™Â§©È£ûÊú∫',
                        description: "ÊäΩ‰∏§Âº†ÁªèÈ™åÂç°",
                        stop: stopChance(ChanceCardType.EXPERIENCE, 2)
                    },
                    {
                        id: "3",
                        left: "68.9%",
                        top: "64.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂéãÂäõ‰∏çÈÄÇÂØºËá¥ÂëïÂêê',
                        description: `-4${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: -4 } })
                    },
                    {
                        id: "4",
                        left: "64.2%",
                        top: "64.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÈÄöËÆØÊïÖÈöú',
                        description: "-3000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: -3000 } })
                    },
                    {
                        id: "5",
                        left: "59.5%",
                        top: "64.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Á¥ßÊÄ•Êä¢‰øÆ',
                        description: `+2${ICON_CONFIG.REPUTE}4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { repute: 2, happy: 4 } })
                    },
                    {
                        id: "6",
                        left: "54.7%",
                        top: "64.2%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Èó™ÈÅøÈô®Áü≥',
                        description: `+6${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6 } })
                    },
                    {
                        id: "7",
                        left: "54.7%",
                        top: "69%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÁôªÈôÜÁÅ´Êòü',
                        description: `+üé≤√ó${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: scene.dicePoints } })
                    },
                    {
                        id: "8",
                        left: "54.7%",
                        top: "73.8%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁé∞ÁÅ´ÊòüÁâπÊúâÁªÜËèå',
                        description: "+4000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 4000 } })
                    },
                    {
                        id: "9",
                        left: "59.5%",
                        top: "73.8%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÊµãÈáèÂú∞ÂΩ¢',
                        description: `+10${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { happy: 10 } })
                    },
                    {
                        id: "10",
                        left: "64.2%",
                        top: "73.8%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ÂèëÁé∞Á•ûÁßòÊñáÊòéÈÅóËøπ',
                        description: `+10${ICON_CONFIG.REPUTE}`,
                        stop: ordinaryEvents((scene) => { return { repute: 10 } })
                    },
                    {
                        id: "11",
                        left: "68.9%",
                        top: "73.8%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Ëà™Â§©ÊúçÁ†¥Ë£Ç',
                        description: "È©¨‰∏äÁßªÂà∞ÂåªÈô¢",
                        stop: moveStation("LOOP", 8)
                    },
                    {
                        id: "12",
                        left: "73.6%",
                        top: "73.8%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'ËøîËà™Âú∞ÁêÉ',
                        description: `+6${ICON_CONFIG.REPUTE}+4${ICON_CONFIG.HAPPY}`,
                        stop: ordinaryEvents((scene) => { return { repute: 6, happy: 4 } })

                    },
                    {
                        id: "13",
                        left: "73.6%",
                        top: "78.5%",
                        width: "4.7%",
                        height: "4.7%",
                        name: 'Â∞ÜÁªèÂéÜÂÜôÊàêÂ∞èËØ¥',
                        description: "+6000ÂÖÉ",
                        stop: ordinaryEvents((scene) => { return { riches: 6000 } })

                    },
                ].map((item) => new Station(item)),
            }

            /**
             * Á¶ªÂºÄÂÜÖÂúàÂà∞ËææÂ§ñÂúàÁöÑ‰ΩçÁΩÆ
             */
            let exitInsidePosition = {
                // ÂÜú‰∏ö
                [PositionTypeEnum.AGRICULTURE]: 5,
                // Â§ßÂ≠¶
                [PositionTypeEnum.UNIVERSITY]: 10,
                // ‰ºÅ‰∏ö
                [PositionTypeEnum.ENTERPRISE]: 12,
                // Ëà™Êµ∑
                [PositionTypeEnum.VOYAGE]: 17,
                // ÂÖ¨Áõä
                [PositionTypeEnum.WELFARE]: 20,
                // ÁîµÂΩ±
                [PositionTypeEnum.MOVIES]: 25,
                // ÈááÁüø 
                [PositionTypeEnum.MINING]: 28,
                // Ëà™Â§©
                [PositionTypeEnum.SPACE]: 1
            }

            let scene = new SceneStation();

            for (const station of [...loopStations, ...Object.values(insideStations).flat()]) {
                let stationDom = document.createElement('div');
                stationDom.classList.add('station-item')
                stationDom.style.left = station.left
                stationDom.style.top = station.top
                stationDom.style.width = station.width
                stationDom.style.height = station.height
                fragment.shadowRoot.appendChild(stationDom)
                station.dom = stationDom
            }

            /**
             * Áé©ÂÆ∂Âä†ÂÖ•
             * @param {Player[]} players
             */
            let join = async (players) => {
                scene.allPlayers = players;
                for (const player of players) {
                    // Ëµ∑ÁÇπÂá∫Âèë
                    loopStations[0].dom.innerHTML += `
                        <div class="player-item" data-id="${player.id}">
                            <div class="player-avatar" style="background-image:url(${player.avatar});border-color:${player.color}"></div>
                        </div>
                    `
                }
            }
            /**
             * Áé©ÂÆ∂ÁßªÂä®
             * @param {Player} player
             * @param {number} count
             */
            let move = async (player, count) => {
                // count = 7 
                scene.curPlayer = player;
                scene.dicePoints = count;
                let currDom = fragment.shadowRoot.querySelector(`.player-item[data-id="${player.id}"]`);
                for (let i = 0; i < count; i++) {
                    let isExitInsideStation = false // ÊòØÂê¶Á¶ªÂºÄÂÜÖÁéØË∑Ø
                    await wait(500); // ÊµãËØïÂä†ÈÄü 
                    player.position++
                    let station = null
                    let insideStation = insideStations[player.positionType]
                    // ËøõÂÖ•ÂÜÖÂúà
                    if (insideStation) {
                        if (player.position < insideStation.length) { // Âú®ÂÜÖÂúàËΩ¨Âä®
                            station = insideStation[player.position]  // ÂÜÖÂúàÁ´ôÁÇπ
                        }
                        else {
                            player.position = exitInsidePosition[player.positionType] // ÂàùÂßãÂåñËøõÂÖ•Â§ñÂúàÁöÑ‰ΩçÁΩÆ
                            player.positionType = PositionTypeEnum.LOOP // ÂàáÊç¢Â§ñÂúàÁ±ªÂûã
                            isExitInsideStation = true; // Á¶ªÂºÄÂÜÖÁéØË∑Ø
                        }
                    }

                    // ËøõÂÖ•Â§ñÂúà
                    if (player.positionType == PositionTypeEnum.LOOP) {
                        station = loopStations[player.position % loopStations.length]; // Â§ñÂúàÁ´ôÁÇπ
                    }

                    station.dom.appendChild(currDom)

                    // Á¶ªÂºÄÂÜÖÁéØË∑Ø
                    if (isExitInsideStation && station.name == 'Êú∫‰ºö') {
                        await stopChance(ChanceCardType.EXPERIENCE, 1).call(station, scene)
                    }

                    if (count - i > 1) await station.via‚Äå?.(scene) // ÁªèËøá
                    else await station.stop?.(scene)  // ÂÅúÁïô 
                    lookAt(currDom.parentNode) // ÈïúÂ§¥Ë∑üÈöè
                }
                await wait(1000);
            }


            /**
             * Áé©ÂÆ∂Á¶ªÂºÄ
             * @param {Player} player
             */
            let leave = async (player) => {
                // ËøõÂÖ•Â§ñÂúà
                if (player.positionType == PositionTypeEnum.LOOP) {
                    let station = loopStations[player.position % loopStations.length]; // Â§ñÂúàÁ´ôÁÇπ
                    scene.curPlayer = player;
                    if (station.leave === undefined) return true;
                    return await station.leave(scene)
                }
                return true;
            }



            /**
             * ‰∏ã‰∏Ä‰∏™Áé©ÂÆ∂
             * @param {Player} player 
             */
            let next = async (player) => {
                let lastDom = fragment.shadowRoot.querySelector('.player-item.active');
                let currDom = fragment.shadowRoot.querySelector(`.player-item[data-id="${player.id}"]`);
                if (lastDom) lastDom.classList.remove('active')
                currDom.classList.add('active')
                lookAt(currDom.parentNode) // ÈïúÂ§¥Ë∑üÈöè
            }


            /**
             * Èó™Áé∞‰∫ã‰ª∂
             * @param {Player} player
             * @param {keyof PositionTypeEnum} type
             * @param {number} index
             */
            let flash = async (player, type, index) => {
                scene.curPlayer = player;
                await moveStation(type, index)(scene)
            }


            return {
                fragment,
                join,
                move,
                next,
                leave,
                flash
            }
        }()

        /**
         * ËÆ∏ÊÑø‰∫ï
         * @author 	 linyisonger
         * @date 	 2024-12-12
         */
        const wishingContainer = await async function () {
            const fragment = templateLoad("#wishing-template")
            fragment.classList.add('close')
            const confirmDom = fragment.shadowRoot.querySelector('.game-btn-confirm')
            const playerListDom = fragment.shadowRoot.querySelector('.wishing-player-list')

            /**
             * @param {Player[]} players
             * @return {Promise<{ player: Player, changed:PlayerChanged }[]>}
             */
            const open = function (players) {
                fragment.classList.remove('close')
                return new Promise((resolve) => {
                    /** @type {{[key:string]:{player: Player, changed:PlayerChanged}}} */
                    let resultProxy = observeVariable(async (result) => {
                        if (Object.keys(result).length === players.length) {
                            await wait(500);
                            fragment.classList.add('close')
                            await wait(500);
                            resolve(Object.values(result))
                        }
                    })

                    playerListDom.innerHTML = ''
                    players.forEach(function (player, index) {
                        let playerFragment = templateLoad('#wishing-template-player-operate-internal', true)
                        let playerOperateDom = playerFragment.querySelector('.player-operate')
                        playerOperateDom.querySelector('.player-avatar').setAttribute('style', `background-image:url(${player.avatar});border-color:${player.color}`)
                        playerOperateDom.querySelector('.player-name').textContent = player.name

                        let operateItemDom = playerOperateDom.querySelector('.operate-item')
                        let confirmListDom = playerOperateDom.querySelectorAll('.game-btn-confirm')
                        let leftSelectedListDom = playerOperateDom.querySelectorAll('.select-item.left')
                        let rightSelectedListDom = playerOperateDom.querySelectorAll('.select-item.right')

                        leftSelectedListDom.forEach(function (selectedDom) {
                            selectedDom.addEventListener("click", (ev) => {
                                leftSelectedListDom.forEach(item => item.classList.remove('active'))
                                selectedDom.classList.add('active')
                            })
                        })
                        rightSelectedListDom.forEach(function (selectedDom) {
                            selectedDom.addEventListener("click", (ev) => {
                                rightSelectedListDom.forEach(item => item.classList.remove('active'))
                                selectedDom.classList.add('active')
                            })
                        })

                        let buyDom = confirmListDom.item(0);
                        let abandonDom = confirmListDom.item(1);
                        playerListDom.appendChild(playerFragment)
                        const buyFunc = async () => {
                            let selectedItem = playerOperateDom.querySelectorAll('.select-item.active')
                            let riches = 0;
                            let happy = 0;
                            let repute = 0;


                            selectedItem.forEach(selected => {
                                riches += selected.hasAttribute('data-riches') ? +selected.getAttribute('data-riches') : 0;
                                happy += selected.hasAttribute('data-happy') ? +selected.getAttribute('data-happy') : 0;
                                repute += selected.hasAttribute('data-repute') ? +selected.getAttribute('data-repute') : 0;
                            })

                            resultProxy[index] = {
                                player,
                                changed: {
                                    riches,
                                    happy,
                                    repute
                                }
                            }
                            playerOperateDom.querySelectorAll('.select-item:not(.active)').forEach(selectedDom => selectedDom.remove())
                            operateItemDom.innerHTML = `ËÆ∏ÊÑø`
                        }
                        buyDom.addEventListener("click", buyFunc)
                        const abandonFunc = () => {
                            operateItemDom.innerHTML = `ÊîæÂºÉ`
                            resultProxy[index] = null
                        }
                        abandonDom.addEventListener("click", abandonFunc)
                    })
                })
            }

            return {
                fragment,
                open
            }
        }();


        /**
         * Âá∫Ë°åÊñπÂºè
         * @author 	 linyisonger
         * @date 	 2024-12-26
         */
        const travelModeContainer = await async function () {
            const fragment = templateLoad("#travel-mode-template")
            const travelModeBtnList = fragment.shadowRoot.querySelectorAll('.travel-mode-btn')
            const diceModeBtn = travelModeBtnList.item(0)
            const cardModeBtn = travelModeBtnList.item(1)
            fragment.classList.add('close')
            const open = function () {
                return new Promise((resolve) => {
                    fragment.classList.remove('close')
                    const useDiceFunc = function () {
                        fragment.classList.add('close')
                        resolve(false)
                    }
                    const useCardFunc = function () {
                        fragment.classList.add('close')
                        resolve(true)
                    }
                    diceModeBtn.removeEventListener("click", useDiceFunc)
                    cardModeBtn.removeEventListener("click", useCardFunc)
                    diceModeBtn.addEventListener("click", useDiceFunc)
                    cardModeBtn.addEventListener("click", useCardFunc)
                })

            }

            return {
                fragment,
                open
            }
        }()


        /**
         * ÂàùÂßãÂåñÊ∏∏ÊàèÂÜÖÂÆπ
         * @author 	 linyisonger
         * @date 	 2024-11-29
         */
        async function initGame() {
            let gameContainerDom = document.body.querySelector('.game-container')
            gameContainerDom.appendChild(mapContainer.fragment)
            gameContainerDom.appendChild(logContainer.fragment)
            gameContainerDom.appendChild(dialogContainer.fragment)
            gameContainerDom.appendChild(diceContainer.fragment)
            gameContainerDom.appendChild(roleContainer.fragment)
            gameContainerDom.appendChild(playerContainer.fragment)
            gameContainerDom.appendChild(hospitalContainer.fragment)
            gameContainerDom.appendChild(parkContainer.fragment)
            gameContainerDom.appendChild(lotteryContainer.fragment)
            gameContainerDom.appendChild(stockContainer.fragment)
            gameContainerDom.appendChild(mallContainer.fragment)
            gameContainerDom.appendChild(galleryContainer.fragment)
            gameContainerDom.appendChild(wishingContainer.fragment)
            gameContainerDom.appendChild(chanceContainer.fragment)
            gameContainerDom.appendChild(cardHolderContainer.fragment)
            gameContainerDom.appendChild(travelModeContainer.fragment)


            document.body.appendChild(gameContainerDom)
            let selecedRoles = await roleContainer.open()
            // ÈÄâ‰∏≠ÁöÑËßíËâ≤
            // let selecedRoles = [
            //     {
            //         "name": "Â∞èÈªë",
            //         "avatar": "./assets/monopoly/black.jpg",
            //         "color": "black",
            //         "targetRiches": 60,
            //         "targetRepute": 0,
            //         "targetHapply": 0
            //     },
            //     {
            //         "name": "Â∞èÁ∫¢",
            //         "avatar": "./assets/monopoly/red.jpg",
            //         "color": "red",
            //         "targetRiches": 60,
            //         "targetRepute": 0,
            //         "targetHapply": 0
            //     }
            // ]
            let players = selecedRoles.map(r => new Player(r))
            // Êé∑È™∞Â≠ê
            // let diceTotal = await diceContainer.open(1)

            // ÈÄâÊã©ËßíËâ≤
            // let selecedRoles = await roleContainer.open()

            // ÂåªÈô¢ÊµãËØï
            // let dictTotal = await hospitalContainer.open()

            // ÂÖ¨Âõ≠ÊµãËØï
            // let parkTotal = await parkContainer.open()

            // ÂΩ©Á•®ÊµãËØï
            // let lotteryResult = await lotteryContainer.open(players)

            // ËØÅÂà∏Â∏ÇÂú∫
            // let stockResult = await stockContainer.open(players)

            // ÂïÜÂú∫
            // let mallResult = await mallContainer.open(players)
            // console.log(mallResult);

            // ÁîªÂªä
            // let galleryResult = await galleryContainer.open(players)
            // console.log(galleryResult);

            // Êú∫‰ºö
            // let chanceResult = await chanceContainer.open(players[0], ChanceCardType.CHANCE, 2)
            // console.log(chanceResult);

            // ËÆ∏ÊÑø‰∫ï
            // let wishingResult = await wishingContainer.open(players)
            // console.log(wishingResult);

            // Âç°ÂåÖ
            // let cardHolderResult = await cardHolderContainer.open(players[0])
            // console.log(cardHolderResult);


            // Âá∫Ë°åÊñπÂºè
            // let travelModeResult = await travelModeContainer.open();
            // console.log(travelModeResult);


            // ÂºπÁ™ó
            // let selected = await dialogContainer.open({
            //     title: 'ÊèêÁ§∫',
            //     content: 'ËØ∑ÈÄâÊã©ÊÉ≥Ë¶ÅÁöÑÈÄâÈ°π',
            //     options: ["A", "B", "C"]
            // })
            // console.log(selected);

            // ÈòüÂàó
            const queue = {
                players: [], // Áé©ÂÆ∂ÂàóË°®
                join: function (players) {
                    this.players = players;
                    playerContainer.join(players)
                    mapContainer.join(players)
                    return this;
                },
                next: async function () {
                    /** @type {Player} */
                    let player = this.players.shift()

                    // ÊöÇÂÅú‰∏ÄËΩÆ
                    if (player.actionState == PlayerActionEnum.PAUSE) {
                        player.actionState = PlayerActionEnum.NONE;
                        this.players.push(player)
                        this.next();
                        return;
                    }

                    mapContainer.next(player)
                    playerContainer.next(player)

                    // Âà§Êñ≠ÂΩìÂâçÁé©ÂÆ∂ÊòØÂê¶ÂèØ‰ª•ÁßªÂä®  ‰æãÂ¶ÇÁâπÂÆöÂú∫Âú∞
                    let allowMove = await mapContainer.leave(player)
                    if (allowMove) {
                        console.log(player);
                        // ‰ΩøÁî®Âç°ÁâáËøòÊòØÊäïÊé∑È™∞Â≠ê
                        let hasCard = player.cardHolder.find(card => !card.passive)
                        let useCard = hasCard && await travelModeContainer.open();
                        let useDice = true;

                        if (useCard) {
                            let cardHolderResult = await cardHolderContainer.open(player, players)
                            useDice = cardHolderResult.useDice
                        }

                        if (useDice) {
                            logContainer.log(`Áé©ÂÆ∂[${player.name}]ÂºÄÂßãÊé∑È™∞Â≠êüé≤`)
                            let dictCount = player.positionType == PositionTypeEnum.LOOP ? 2 : 1; // È™∞Â≠êÊï∞Èáè
                            let dictTotal = await diceContainer.open(dictCount);
                            logContainer.log(`Áé©ÂÆ∂[${player.name}]ÊäïÊé∑Êï∞‰∏∫[${dictTotal}]`)
                            await mapContainer.move(player, dictTotal)
                        }
                    }

                    // Ê£ÄÊü•Áé©ÂÆ∂Á†¥‰∫ßÂíåËÉúÂà©
                    let allPlayers = [player, ...players]
                    for (let i = 0; i < allPlayers.length; i++) {
                        await playerContainer.checkBankruptcy(allPlayers[i])
                    }

                    // Ê£ÄÊü•Áé©ÂÆ∂ÊòØÂê¶ËÉúÂà©
                    await playerContainer.checkWin(allPlayers)
                    // ÂÜçÊù•‰∏ÄÊ¨°
                    if (player.actionState === PlayerActionEnum.AGAIN) {
                        player.actionState = PlayerActionEnum.NONE;
                        this.players.unshift(player)
                    }
                    else this.players.push(player);
                    this.next()
                },
            }

            queue.join(players).next()
        }

        initGame();

    </script>
</body>

</html>